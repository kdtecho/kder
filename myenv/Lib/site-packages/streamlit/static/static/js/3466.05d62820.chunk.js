/*! For license information please see 3466.05d62820.chunk.js.LICENSE.txt */
(self.webpackChunk_streamlit_app=self.webpackChunk_streamlit_app||[]).push([[3466],{12879:(t,e,n)=>{"use strict";n.r(e),n.d(e,{AGGREGATION_OPERATION:()=>y,CPUGridLayer:()=>Jt,ContourLayer:()=>nn,GPUGridLayer:()=>dn,GridLayer:()=>An,HeatmapLayer:()=>Bn,HexagonLayer:()=>te,ScreenGridLayer:()=>kt,_AggregationLayer:()=>ot,_BinSorter:()=>wt,_CPUAggregator:()=>jt,_GPUGridAggregator:()=>V});var i=n(64649),r=n(21970),o=n(70353),s=n(12308),a=n(28007),l=n(56474),c=n(94557),u=n(17225);function h(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=Math.fround(t),r=t-i;return e[n]=i,e[n+1]=r,e}function d(t){return t-Math.fround(t)}function f(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let i=0;i<4;++i){const r=4*n+i;h(t[4*i+n],e,2*r)}return e}const A={ONE:1};const p={name:"fp64-arithmetic",vs:"uniform float ONE;\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\n    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",fs:null,getUniforms:function(){return A},fp64ify:h,fp64LowPart:d,fp64ifyMatrix4:f};var g=n(46802),m=n(2123);const y={SUM:1,MEAN:2,MIN:3,MAX:4};function v(t,e){return t+e}function _(t,e){return e>t?e:t}function b(t,e){return e<t?e:t}function x(t,e,n){const i=y[t]||y.SUM;switch(e=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Number.isFinite(t))return t;return n=>(e.index=n.index,t(n.source,e))}(e,n),i){case y.MIN:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(b,1/0):null}(t,e);case y.SUM:return t=>function(t,e){if(Number.isFinite(e))return t.length?t.length*e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(v,0):null}(t,e);case y.MEAN:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(v,0)/n.length:null}(t,e);case y.MAX:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(_,-1/0):null}(t,e);default:return null}}function w(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n=>(e.indices=n.map((t=>t.index)),t(n.map((t=>t.source)),e))}const C={projectPoints:!1,viewport:null,createBufferObjects:!0,moduleSettings:{}},B=3402823466e29,E=[32775,32774],T=[32776,32774],S=[32776,32775],M={[y.SUM]:32774,[y.MEAN]:32774,[y.MIN]:E,[y.MAX]:T},I={size:1,operation:y.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},P="#define SHADER_NAME gpu-aggregation-to-grid-vs\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute vec3 weights;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform bool projectPoints;\nuniform vec2 translation;\nuniform vec3 scaling;\n\nvarying vec3 vWeights;\n\nvec2 project_to_pixel(vec4 pos) {\n  vec4 result;\n  pos.xy = pos.xy/pos.w;\n  result = pos + vec4(translation, 0., 0.);\n  result.xy = scaling.z > 0. ? result.xy * scaling.xy : result.xy;\n  return result.xy;\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec4 windowPos = vec4(positions, 1.);\n  if (projectPoints) {\n    windowPos = project_position_to_clipspace(positions, positions64Low, vec3(0));\n  }\n\n  vec2 pos = project_to_pixel(windowPos);\n\n  vec2 pixelXY64[2];\n  pixelXY64[0] = vec2(pos.x, 0.);\n  pixelXY64[1] = vec2(pos.y, 0.);\n  vec2 gridXY64[2];\n  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));\n  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));\n  float x = floor(gridXY64[0].x);\n  float y = floor(gridXY64[1].x);\n  pos = vec2(x, y);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n  gl_PointSize = 1.0;\n}\n",D="#define SHADER_NAME gpu-aggregation-to-grid-fs\n\nprecision highp float;\n\nvarying vec3 vWeights;\n\nvoid main(void) {\n  gl_FragColor = vec4(vWeights, 1.0);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",F="#version 300 es\n#define SHADER_NAME gpu-aggregation-all-vs-64\n\nin vec2 position;\nuniform ivec2 gridSize;\nout vec2 vTextureCoord;\n\nvoid main(void) {\n  vec2 pos = vec2(-1.0, -1.0);\n  vec2 offset = 1.0 / vec2(gridSize);\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  int yIndex = gl_InstanceID / gridSize[0];\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 yIndexFP64 = vec2(float(yIndex), 0.);\n  vec2 xIndexFP64 = vec2(float(xIndex), 0.);\n  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);\n  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);\n\n  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);\n  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);\n\n  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);\n  gl_PointSize = 1.0;\n}\n",L="#version 300 es\n#define SHADER_NAME gpu-aggregation-all-fs\n\nprecision highp float;\n\nin vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool combineMaxMin;\nout vec4 fragColor;\nvoid main(void) {\n  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n  if (textureColor.a == 0.) {\n    discard;\n  }\n  fragColor.rgb = textureColor.rgb;\n  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;\n}\n",O="#define SHADER_NAME gpu-aggregation-transform-mean-vs\nattribute vec4 aggregationValues;\nvarying vec4 meanValues;\n\nvoid main()\n{\n  bool isCellValid = bool(aggregationValues.w > 0.);\n  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);\n  meanValues.w = aggregationValues.w;\n  gl_PointSize = 1.0;\n}\n";var R=n(58300),k=n(79078);const U={10240:9728,10241:9728};function z(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{width:n=1,height:i=1,data:r=null,unpackFlipY:o=!0,parameters:s=U}=e;return new R.Z(t,{data:r,format:(0,a.D0)(t)?34836:6408,type:5126,border:0,mipmaps:!1,parameters:s,dataFormat:6408,width:n,height:i,unpackFlipY:o})}function G(t,e){const{id:n,width:i=1,height:r=1,texture:o}=e;return new k.Z(t,{id:n,width:i,height:r,attachments:{36064:o}})}const N=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],Z={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},j=[o.h.WEBGL2,o.h.COLOR_ATTACHMENT_RGBA32F,o.h.BLEND_EQUATION_MINMAX,o.h.FLOAT_BLEND,o.h.TEXTURE_FLOAT];class V{static getAggregationData(t){let{aggregationData:e,maxData:n,minData:i,maxMinData:r,pixelIndex:o}=t;const s=4*o,a={};return e&&(a.cellCount=e[s+3],a.cellWeight=e[s]),r?(a.maxCellWieght=r[0],a.minCellWeight=r[3]):(n&&(a.maxCellWieght=n[0],a.totalCount=n[3]),i&&(a.minCellWeight=i[0],a.totalCount=n[3])),a}static getCellData(t){let{countsData:e,size:n=1}=t;const i=e.length/4,r=new Float32Array(i*n),o=new Uint32Array(i);for(let s=0;s<i;s++){for(let t=0;t<n;t++)r[s*n+t]=e[4*s+t];o[s]=e[4*s+3]}return{cellCounts:o,cellWeights:r}}static isSupported(t){return(0,s.ag)(t,j)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=e.id||"gpu-grid-aggregator",this.gl=t,this.state={weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=(0,a.D0)(t)&&(0,s.ag)(this.gl,o.h.BLEND_EQUATION_MINMAX,o.h.COLOR_ATTACHMENT_RGBA32F,o.h.TEXTURE_FLOAT),this._hasGPUSupport&&this._setupModels()}delete(){const{gridAggregationModel:t,allAggregationModel:e,meanTransform:n}=this,{textures:i,framebuffers:r,maxMinFramebuffers:o,minFramebuffers:s,maxFramebuffers:a,meanTextures:l,resources:c}=this.state;null===t||void 0===t||t.delete(),null===e||void 0===e||e.delete(),null===n||void 0===n||n.delete(),function(t){t=Array.isArray(t)?t:[t],t.forEach((t=>{for(const e in t)t[e].delete()}))}([r,i,o,s,a,l,c])}run(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setState({results:{}});const e=this._normalizeAggregationParams(t);return this._hasGPUSupport||r.Z.log(1,"GPUGridAggregator: not supported")(),this._runAggregation(e)}getData(t){const e={},n=this.state.results;n[t].aggregationData||(n[t].aggregationData=n[t].aggregationBuffer.getData()),e.aggregationData=n[t].aggregationData;for(const i in Z){const r=Z[i];(n[t][i]||n[t][r])&&(n[t][i]=n[t][i]||n[t][r].getData(),e[i]=n[t][i])}return e}updateShaders(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setState({shaderOptions:t,modelDirty:!0})}_normalizeAggregationParams(t){const e={...C,...t},{weights:n}=e;return n&&(e.weights=function(t){const e={};for(const n in t)e[n]={...I,...t[n]};return e}(n)),e}setState(t){Object.assign(this.state,t)}_getAggregateData(t){const e={},{textures:n,framebuffers:i,maxMinFramebuffers:r,minFramebuffers:o,maxFramebuffers:s,resources:a}=this.state,{weights:c}=t;for(const u in c){e[u]={};const{needMin:t,needMax:h,combineMaxMin:d}=c[u];e[u].aggregationTexture=n[u],e[u].aggregationBuffer=(0,l.Jb)(i[u],{target:c[u].aggregationBuffer,sourceType:5126}),t&&h&&d?(e[u].maxMinBuffer=(0,l.Jb)(r[u],{target:c[u].maxMinBuffer,sourceType:5126}),e[u].maxMinTexture=a["".concat(u,"-maxMinTexture")]):(t&&(e[u].minBuffer=(0,l.Jb)(o[u],{target:c[u].minBuffer,sourceType:5126}),e[u].minTexture=a["".concat(u,"-minTexture")]),h&&(e[u].maxBuffer=(0,l.Jb)(s[u],{target:c[u].maxBuffer,sourceType:5126}),e[u].maxTexture=a["".concat(u,"-maxTexture")]))}return this._trackGPUResultBuffers(e,c),e}_renderAggregateData(t){const{cellSize:e,projectPoints:n,attributes:i,moduleSettings:r,numCol:o,numRow:s,weights:a,translation:l,scaling:c}=t,{maxMinFramebuffers:u,minFramebuffers:h,maxFramebuffers:d}=this.state,f=[o,s],A={blend:!0,depthTest:!1,blendFunc:[1,1]},p={cellSize:e,gridSize:f,projectPoints:n,translation:l,scaling:c};for(const g in a){const{needMin:t,needMax:e}=a[g],n=t&&e&&a[g].combineMaxMin;this._renderToWeightsTexture({id:g,parameters:A,moduleSettings:r,uniforms:p,gridSize:f,attributes:i,weights:a}),n?this._renderToMaxMinTexture({id:g,parameters:{...A,blendEquation:S},gridSize:f,minOrMaxFb:u[g],clearParams:{clearColor:[0,0,0,B]},combineMaxMin:n}):(t&&this._renderToMaxMinTexture({id:g,parameters:{...A,blendEquation:E},gridSize:f,minOrMaxFb:h[g],clearParams:{clearColor:[B,B,B,0]},combineMaxMin:n}),e&&this._renderToMaxMinTexture({id:g,parameters:{...A,blendEquation:T},gridSize:f,minOrMaxFb:d[g],clearParams:{clearColor:[0,0,0,0]},combineMaxMin:n}))}}_renderToMaxMinTexture(t){const{id:e,parameters:n,gridSize:i,minOrMaxFb:r,combineMaxMin:o,clearParams:s={}}=t,{framebuffers:l}=this.state,{gl:c,allAggregationModel:u}=this;(0,a.s8)(c,{...s,framebuffer:r,viewport:[0,0,i[0],i[1]]},(()=>{c.clear(16384),u.draw({parameters:n,uniforms:{uSampler:l[e].texture,gridSize:i,combineMaxMin:o}})}))}_renderToWeightsTexture(t){const{id:e,parameters:n,moduleSettings:i,uniforms:r,gridSize:o,weights:s}=t,{framebuffers:l,equations:c,weightAttributes:h}=this.state,{gl:d,gridAggregationModel:f}=this,{operation:A}=s[e],p=A===y.MIN?[B,B,B,0]:[0,0,0,0];if((0,a.s8)(d,{framebuffer:l[e],viewport:[0,0,o[0],o[1]],clearColor:p},(()=>{d.clear(16384);const t={weights:h[e]};f.draw({parameters:{...n,blendEquation:c[e]},moduleSettings:i,uniforms:r,attributes:t})})),A===y.MEAN){const{meanTextures:t,textures:n}=this.state,i={_sourceTextures:{aggregationValues:t[e]},_targetTexture:n[e],elementCount:n[e].width*n[e].height};this.meanTransform?this.meanTransform.update(i):this.meanTransform=function(t,e){return new u.Z(t,{vs:O,_targetTextureVarying:"meanValues",...e})}(d,i),this.meanTransform.run({parameters:{blend:!1,depthTest:!1}}),l[e].attach({36064:n[e]})}}_runAggregation(t){this._updateModels(t),this._setupFramebuffers(t),this._renderAggregateData(t);const e=this._getAggregateData(t);return this.setState({results:e}),e}_setupFramebuffers(t){const{textures:e,framebuffers:n,maxMinFramebuffers:i,minFramebuffers:r,maxFramebuffers:o,meanTextures:s,equations:a}=this.state,{weights:l}=t,{numCol:c,numRow:u}=t,h={width:c,height:u};for(const d in l){const{needMin:t,needMax:f,combineMaxMin:A,operation:p}=l[d];e[d]=l[d].aggregationTexture||e[d]||z(this.gl,{id:"".concat(d,"-texture"),width:c,height:u}),e[d].resize(h);let g=e[d];p===y.MEAN&&(s[d]=s[d]||z(this.gl,{id:"".concat(d,"-mean-texture"),width:c,height:u}),s[d].resize(h),g=s[d]),n[d]?n[d].attach({36064:g}):n[d]=G(this.gl,{id:"".concat(d,"-fb"),width:c,height:u,texture:g}),n[d].resize(h),a[d]=M[p]||M.SUM,(t||f)&&(t&&f&&A?i[d]||(g=l[d].maxMinTexture||this._getMinMaxTexture("".concat(d,"-maxMinTexture")),i[d]=G(this.gl,{id:"".concat(d,"-maxMinFb"),texture:g})):(t&&(r[d]||(g=l[d].minTexture||this._getMinMaxTexture("".concat(d,"-minTexture")),r[d]=G(this.gl,{id:"".concat(d,"-minFb"),texture:g}))),f&&(o[d]||(g=l[d].maxTexture||this._getMinMaxTexture("".concat(d,"-maxTexture")),o[d]=G(this.gl,{id:"".concat(d,"-maxFb"),texture:g})))))}}_getMinMaxTexture(t){const{resources:e}=this.state;return e[t]||(e[t]=z(this.gl,{id:"resourceName"})),e[t]}_setupModels(){let{numCol:t=0,numRow:e=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var n;const{gl:i}=this,{shaderOptions:r}=this.state;if(null===(n=this.gridAggregationModel)||void 0===n||n.delete(),this.gridAggregationModel=function(t,e){const n=(0,g.l)({vs:P,fs:D,modules:[p,m.Z]},e);return new c.Z(t,{id:"Gird-Aggregation-Model",vertexCount:1,drawMode:0,...n})}(i,r),!this.allAggregationModel){const n=t*e;this.allAggregationModel=function(t,e){return new c.Z(t,{id:"All-Aggregation-Model",vs:F,fs:L,modules:[p],vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:e,attributes:{position:[0,0]}})}(i,n)}}_setupWeightAttributes(t){const{weightAttributes:e}=this.state,{weights:n}=t;for(const i in n)e[i]=t.attributes[i]}_trackGPUResultBuffers(t,e){const{resources:n}=this.state;for(const i in t)if(t[i])for(const r of N)if(t[i][r]&&e[i][r]!==t[i][r]){const e="gpu-result-".concat(i,"-").concat(r);n[e]&&n[e].delete(),n[e]=t[i][r]}}_updateModels(t){const{vertexCount:e,attributes:n,numCol:i,numRow:r}=t,{modelDirty:o}=this.state;o&&(this._setupModels(t),this.setState({modelDirty:!1})),this._setupWeightAttributes(t),this.gridAggregationModel.setVertexCount(e),this.gridAggregationModel.setAttributes(n),this.allAggregationModel.setInstanceCount(i*r)}}var H=n(69296),J=n(90031),W=n(2578);const Q=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function K(t){let e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float32Array;if(Number.isFinite(t[0]))e=new i(t);else{e=new i(4*t.length);let n=0;for(let i=0;i<t.length;i++){const r=t[i];e[n++]=r[0],e[n++]=r[1],e[n++]=r[2],e[n++]=Number.isFinite(r[3])?r[3]:255}}if(n)for(let r=0;r<e.length;r++)e[r]/=255;return e}const q=[0,0,0,0],X=[0,255,0,255],Y=["minColor","maxColor","colorRange","colorDomain"],$={cellSizePixels:{value:100,min:1},cellMarginPixels:{value:2,min:0,max:5},colorDomain:null,colorRange:Q};class tt extends J.Z{constructor(){super(...arguments),(0,i.Z)(this,"state",void 0)}static isSupported(t){return(0,s.ag)(t,[o.h.TEXTURE_FLOAT])}getShaders(){return{vs:"#define SHADER_NAME screen-grid-layer-vertex-shader\n#define RANGE_COUNT 6\n\nattribute vec3 positions;\nattribute vec3 instancePositions;\nattribute vec4 instanceCounts;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\nuniform sampler2D maxTexture;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r;\n  float maxWeight = texture2D(maxTexture, vec2(0.5)).r;\n\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n",fs:"#define SHADER_NAME screen-grid-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[W.Z]}}initializeState(){const{gl:t}=this.context;this.getAttributeManager().addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,noAlloc:!0}}),this.setState({model:this._getModel(t)})}shouldUpdateState(t){let{changeFlags:e}=t;return e.somethingChanged}updateState(t){super.updateState(t);const{oldProps:e,props:n,changeFlags:i}=t,r=this.getAttributeManager();n.numInstances!==e.numInstances?r.invalidateAll():e.cellSizePixels!==n.cellSizePixels&&r.invalidate("instancePositions"),this._updateUniforms(e,n,i)}draw(t){let{uniforms:e}=t;const{parameters:n,maxTexture:i}=this.props,r=this.props.minColor||q,o=this.props.maxColor||X,s=this.props.colorDomain||[1,0],{model:a}=this.state;a.setUniforms(e).setUniforms({minColor:r,maxColor:o,maxTexture:i,colorDomain:s}).draw({parameters:{depthTest:!1,depthMask:!1,...n}})}calculateInstancePositions(t,e){let{numInstances:n}=e;const{width:i,height:r}=this.context.viewport,{cellSizePixels:o}=this.props,s=Math.ceil(i/o),{value:a,size:l}=t;for(let c=0;c<n;c++){const t=c%s,e=Math.floor(c/s);a[c*l+0]=t*o/i*2-1,a[c*l+1]=1-e*o/r*2,a[c*l+2]=0}}_getModel(t){return new c.Z(t,{...this.getShaders(),id:this.props.id,geometry:new H.Z({drawMode:6,attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}}),isInstanced:!0})}_shouldUseMinMax(){const{minColor:t,maxColor:e,colorDomain:n,colorRange:i}=this.props;return t||e?(r.Z.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!n&&!i}_updateUniforms(t,e,n){const{model:i}=this.state;if(Y.some((n=>t[n]!==e[n]))&&i.setUniforms({shouldUseMinMax:this._shouldUseMinMax()}),t.colorRange!==e.colorRange&&i.setUniforms({colorRange:K(e.colorRange)}),t.cellMarginPixels!==e.cellMarginPixels||t.cellSizePixels!==e.cellSizePixels||n.viewportChanged){const{width:t,height:e}=this.context.viewport,{cellSizePixels:n,cellMarginPixels:r}=this.props,o=n>r?r:0,s=new Float32Array([(n-o)/t*2,-(n-o)/e*2,1]);i.setUniforms({cellScale:s})}}}(0,i.Z)(tt,"layerName","ScreenGridCellLayer"),(0,i.Z)(tt,"defaultProps",$);var et=n(79366),nt=n(49473),it=n(96684);function rt(t,e){const n={};for(const i in t)e.includes(i)||(n[i]=t[i]);return n}class ot extends et.Z{constructor(){super(...arguments),(0,i.Z)(this,"state",void 0)}initializeAggregationLayer(t){super.initializeState(this.context),this.setState({ignoreProps:rt(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);const{changeFlags:e}=t;if(e.extensionsChanged){const t=this.getShaders({});t&&t.defines&&(t.defines.NON_INSTANCED_MODEL=1),this.updateShaders(t)}this._updateAttributes()}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:t,mousePosition:e,gl:n}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:e,pickingActive:0,devicePixelRatio:(0,a.w)(n)})}updateShaders(t){}isAggregationDirty(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{props:n,oldProps:i,changeFlags:r}=t,{compareAll:o=!1,dimension:s}=e,{ignoreProps:a}=this.state,{props:l,accessors:c=[]}=s,{updateTriggersChanged:u}=r;if(r.dataChanged)return!0;if(u){if(u.all)return!0;for(const t of c)if(u[t])return!0}if(o)return!!r.extensionsChanged||(0,nt.tg)({oldProps:i,newProps:n,ignoreProps:a,propTypes:this.constructor._propTypes});for(const h of l)if(n[h]!==i[h])return!0;return!1}isAttributeChanged(t){const{changedAttributes:e}=this.state;return t?e&&void 0!==e[t]:!function(t){let e=!0;for(const n in t){e=!1;break}return e}(e)}_getAttributeManager(){return new it.Z(this.context.gl,{id:this.props.id,stats:this.context.stats})}}(0,i.Z)(ot,"layerName","AggregationLayer");var st=n(33839);function at(t,e,n){const i=n;return i.domain=()=>t,i.range=()=>e,i}function lt(t,e){return at(t,e,(n=>function(t,e,n){const i=t[1]-t[0];if(i<=0)return r.Z.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];const o=i/e.length,s=Math.floor((n-t[0])/o),a=Math.max(Math.min(s,e.length-1),0);return e[a]}(t,e,n)))}function ct(t,e){return at(t,e,(n=>function(t,e,n){return(n-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]}(t,e,n)))}function ut(t,e){const n=t.sort(ht);let i=0;const r=Math.max(1,e.length),o=new Array(r-1);for(;++i<r;)o[i-1]=dt(n,i/r);const s=t=>function(t,e,n){return e[function(t,e){let n=0,i=t.length;for(;n<i;){const r=n+i>>>1;ht(t[r],e)>0?i=r:n=r+1}return n}(t,n)]}(o,e,t);return s.thresholds=()=>o,at(t,e,s)}function ht(t,e){return t-e}function dt(t,e){const n=t.length;if(e<=0||n<2)return t[0];if(e>=1)return t[n-1];const i=(n-1)*e,r=Math.floor(i),o=t[r];return o+(t[r+1]-o)*(i-r)}function ft(t,e){const n=new Map,i=[];for(const r of t){const t="".concat(r);n.has(t)||n.set(t,i.push(r))}return at(t,e,(t=>function(t,e,n,i){const r="".concat(i);let o=e.get(r);return void 0===o&&(o=t.push(i),e.set(r,o)),n[(o-1)%n.length]}(i,n,e,t)))}function At(t){return void 0!==t&&null!==t}function pt(t,e){return("function"===typeof e?t.map(e):t).filter(At)}function gt(t,e){return pt(t,e)}function mt(t,e){return function(t){const e=[];return t.forEach((t=>{!e.includes(t)&&At(t)&&e.push(t)})),e}(pt(t,e))}const yt=t=>t.length,vt=t=>t.points,_t=t=>t.index,bt=(t,e)=>t<e?-1:t>e?1:t>=e?0:NaN,xt={getValue:yt,getPoints:vt,getIndex:_t,filterData:null};class wt{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xt;(0,i.Z)(this,"maxCount",void 0),(0,i.Z)(this,"maxValue",void 0),(0,i.Z)(this,"minValue",void 0),(0,i.Z)(this,"totalCount",void 0),(0,i.Z)(this,"aggregatedBins",void 0),(0,i.Z)(this,"sortedBins",void 0),(0,i.Z)(this,"binMap",void 0),this.aggregatedBins=this.getAggregatedBins(t,e),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(t,e){const{getValue:n=yt,getPoints:i=vt,getIndex:r=_t,filterData:o}=e,s="function"===typeof o,a=t.length,l=[];let c=0;for(let u=0;u<a;u++){const e=t[u],a=i(e),h=r(e),d=s?a.filter(o):a;e.filteredPoints=s?d:null;const f=d.length?n(d):null;null!==f&&void 0!==f&&(l[c]={i:Number.isFinite(h)?h:u,value:f,counts:d.length},c++)}return l}_percentileToIndex(t){const e=this.sortedBins.length;if(e<2)return[0,0];const[n,i]=t.map((t=>{return e=t,n=0,i=100,Math.max(n,Math.min(i,e));var e,n,i}));return[Math.ceil(n/100*(e-1)),Math.floor(i/100*(e-1))]}getBinMap(){const t={};for(const e of this.aggregatedBins)t[e.i]=e;return t}_updateMinMaxValues(){let t=0,e=0,n=3402823466e29,i=0;for(const r of this.aggregatedBins)t=t>r.counts?t:r.counts,e=e>r.value?e:r.value,n=n<r.value?n:r.value,i+=r.counts;this.maxCount=t,this.maxValue=e,this.minValue=n,this.totalCount=i}getValueRange(t){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort(((t,e)=>bt(t.value,e.value)))),!this.sortedBins.length)return[];let e=0,n=this.sortedBins.length-1;if(Array.isArray(t)){const i=this._percentileToIndex(t);e=i[0],n=i[1]}return[this.sortedBins[e].value,this.sortedBins[n].value]}getValueDomainByScale(t){let[e=0,n=100]=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort(((t,e)=>bt(t.value,e.value)))),!this.sortedBins.length)return[];const i=this._percentileToIndex([e,n]);return this._getScaleDomain(t,i)}_getScaleDomain(t,e){let[n,i]=e;const r=this.sortedBins;switch(t){case"quantize":case"linear":default:return[r[n].value,r[i].value];case"quantile":return gt(r.slice(n,i+1),(t=>t.value));case"ordinal":return mt(r,(t=>t.value))}}}var Ct=n(73115),Bt=n(18252);const Et=6378e3;function Tt(t){return Number.isFinite(t)?t:0}function St(t,e){const n=t.positions.value;let i,r,o=1/0,s=-1/0,a=1/0,l=-1/0;for(let c=0;c<e;c++)r=n[3*c],i=n[3*c+1],o=i<o?i:o,s=i>s?i:s,a=r<a?r:a,l=r>l?r:l;return{xMin:Tt(a),xMax:Tt(l),yMin:Tt(o),yMax:Tt(s)}}function Mt(t,e){const n=t<0?-1:1;let i=n<0?Math.abs(t)+e:Math.abs(t);return i=Math.floor(i/e)*e,i*n}function It(t,e){if(!(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]))return{xOffset:e,yOffset:e};const{yMin:n,yMax:i}=t;return function(t,e){const n=(s=t,s/Et*(180/Math.PI)),i=(r=e,o=t,o/Et*(180/Math.PI)/Math.cos(r*Math.PI/180));var r,o;var s;return{yOffset:n,xOffset:i}}(e,(n+i)/2)}function Pt(t,e,n,i){const o=It(t,e,i!==Bt.Df.CARTESIAN),s=function(t,e,n,i){const{width:o,height:s}=i,a=n===Bt.Df.CARTESIAN?[-o/2,-s/2]:[-180,-90];r.Z.assert(n===Bt.Df.CARTESIAN||n===Bt.Df.LNGLAT||n===Bt.Df.DEFAULT);const{xMin:l,yMin:c}=t;return[-1*(Mt(l-a[0],e.xOffset)+a[0]),-1*(Mt(c-a[1],e.yOffset)+a[1])]}(t,o,i,n),{xMin:a,yMin:l,xMax:c,yMax:u}=t,h=c-a+o.xOffset,d=u-l+o.yOffset;return{gridOffset:o,translation:s,width:h,height:d,numCol:Math.ceil(h/o.xOffset),numRow:Math.ceil(d/o.yOffset)}}function Dt(t,e){const n=function(t,e){const{data:n=[],cellSize:i}=t,{attributes:r,viewport:o,projectPoints:s,numInstances:a}=e,l=r.positions.value,{size:c}=r.positions.getAccessor(),u=e.boundingBox||function(t,e){const n=t.value,{size:i}=t.getAccessor();let r,o,s=1/0,a=-1/0,l=1/0,c=-1/0;for(let u=0;u<e;u++)o=n[u*i],r=n[u*i+1],Number.isFinite(o)&&Number.isFinite(r)&&(s=r<s?r:s,a=r>a?r:a,l=o<l?o:l,c=o>c?o:c);return{xMin:l,xMax:c,yMin:s,yMax:a}}(r.positions,a),h=e.posOffset||[180,90],d=e.gridOffset||It(u,i);if(d.xOffset<=0||d.yOffset<=0)return{gridHash:{},gridOffset:d};const{width:f,height:A}=o,p=Math.ceil(f/d.xOffset),g=Math.ceil(A/d.yOffset),m={},{iterable:y,objectInfo:v}=(0,Ct.jB)(n),_=new Array(3);for(const b of y){v.index++,_[0]=l[v.index*c],_[1]=l[v.index*c+1],_[2]=c>=3?l[v.index*c+2]:0;const[t,e]=s?o.project(_):_;if(Number.isFinite(t)&&Number.isFinite(e)){const n=Math.floor((e+h[1])/d.yOffset),i=Math.floor((t+h[0])/d.xOffset);if(!s||i>=0&&i<p&&n>=0&&n<g){const t="".concat(n,"-").concat(i);m[t]=m[t]||{count:0,points:[],lonIdx:i,latIdx:n},m[t].count+=1,m[t].points.push({source:b,index:v.index})}}}return{gridHash:m,gridOffset:d,offsets:[-1*h[0],-1*h[1]]}}(t,e),i=function(t){let{gridHash:e,gridOffset:n,offsets:i}=t;const r=new Array(Object.keys(e).length);let o=0;for(const s in e){const t=s.split("-"),a=parseInt(t[0],10),l=parseInt(t[1],10),c=o++;r[c]={index:c,position:[i[0]+n.xOffset*l,i[1]+n.yOffset*a],...e[s]}}return r}(n);return{gridHash:n.gridHash,gridOffset:n.gridOffset,data:i}}class Ft extends ot{constructor(){super(...arguments),(0,i.Z)(this,"state",void 0)}initializeAggregationLayer(t){let{dimensions:e}=t;const{gl:n}=this.context;super.initializeAggregationLayer(e),this.setState({layerData:{},gpuGridAggregator:new V(n,{id:"".concat(this.id,"-gpu-aggregator")}),cpuGridAggregator:Dt})}updateState(t){super.updateState(t),this.updateAggregationState(t);const{aggregationDataDirty:e,aggregationWeightsDirty:n,gpuAggregation:i}=this.state;if(this.getNumInstances()<=0)return;let r=!1;(e||i&&n)&&(this._updateAggregation(t),r=!0),i||!e&&!n||(this._updateWeightBins(),this._uploadAggregationResults(),r=!0),this.setState({aggregationDirty:r})}finalizeState(t){var e;const{count:n}=this.state.weights;n&&n.aggregationBuffer&&n.aggregationBuffer.delete(),null===(e=this.state.gpuGridAggregator)||void 0===e||e.delete(),super.finalizeState(t)}updateShaders(t){this.state.gpuAggregation&&this.state.gpuGridAggregator.updateShaders(t)}updateAggregationState(t){r.Z.assert(!1)}allocateResources(t,e){if(this.state.numRow!==t||this.state.numCol!==e){const n=e*t*4*4,i=this.context.gl,{weights:r}=this.state;for(const t in r){const e=r[t];e.aggregationBuffer&&e.aggregationBuffer.delete(),e.aggregationBuffer=new st.Z(i,{byteLength:n,accessor:{size:4,type:5126,divisor:1}})}}}updateResults(t){let{aggregationData:e,maxMinData:n,maxData:i,minData:r}=t;const{count:o}=this.state.weights;o&&(o.aggregationData=e,o.maxMinData=n,o.maxData=i,o.minData=r)}_updateAggregation(t){const{cpuGridAggregator:e,gpuGridAggregator:n,gridOffset:i,posOffset:r,translation:o=[0,0],scaling:s=[0,0,0],boundingBox:a,projectPoints:l,gpuAggregation:c,numCol:u,numRow:h}=this.state,{props:d}=t,{viewport:f}=this.context,A=this.getAttributes(),p=this.getNumInstances();if(c){const{weights:t}=this.state;n.run({weights:t,cellSize:[i.xOffset,i.yOffset],numCol:u,numRow:h,translation:o,scaling:s,vertexCount:p,projectPoints:l,attributes:A,moduleSettings:this.getModuleSettings()})}else{const t=e(d,{gridOffset:i,projectPoints:l,attributes:A,viewport:f,posOffset:r,boundingBox:a});this.setState({layerData:t})}}_updateWeightBins(){const{getValue:t}=this.state,e=new wt(this.state.layerData.data||[],{getValue:t});this.setState({sortedBins:e})}_uploadAggregationResults(){const{numCol:t,numRow:e}=this.state,{data:n}=this.state.layerData,{aggregatedBins:i,minValue:r,maxValue:o,totalCount:s}=this.state.sortedBins,a=new Float32Array(t*e*4).fill(0);for(const h of i){const{lonIdx:e,latIdx:i}=n[h.i],{value:r,counts:o}=h,s=4*(e+i*t);a[s]=r,a[s+4-1]=o}const l=new Float32Array([o,0,0,r]),c=new Float32Array([o,0,0,s]),u=new Float32Array([r,0,0,s]);this.updateResults({aggregationData:a,maxMinData:l,maxData:c,minData:u})}}(0,i.Z)(Ft,"layerName","GridAggregationLayer");const Lt={...tt.defaultProps,getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"},Ot="positions",Rt={data:{props:["cellSizePixels"]},weights:{props:["aggregation"],accessors:["getWeight"]}};class kt extends Ft{constructor(){super(...arguments),(0,i.Z)(this,"state",void 0)}initializeState(){const{gl:t}=this.context;if(!tt.isSupported(t))return this.setState({supported:!1}),void r.Z.error("ScreenGridLayer: ".concat(this.id," is not supported on this browser"))();super.initializeAggregationLayer({dimensions:Rt,getCellSize:t=>t.cellSizePixels});const e={count:{size:1,operation:y.SUM,needMax:!0,maxTexture:z(t,{id:"".concat(this.id,"-max-texture")})}};this.setState({supported:!0,projectPoints:!0,weights:e,subLayerData:{attributes:{}},maxTexture:e.count.maxTexture,positionAttributeName:"positions",posOffset:[0,0],translation:[1,-1]});this.getAttributeManager().add({[Ot]:{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}shouldUpdateState(t){let{changeFlags:e}=t;return this.state.supported&&e.somethingChanged}updateState(t){super.updateState(t)}renderLayers(){if(!this.state.supported)return[];const{maxTexture:t,numRow:e,numCol:n,weights:i}=this.state,{updateTriggers:r}=this.props,{aggregationBuffer:o}=i.count;return new(this.getSubLayerClass("cells",tt))(this.props,this.getSubLayerProps({id:"cell-layer",updateTriggers:r}),{data:{attributes:{instanceCounts:o}},maxTexture:t,numInstances:e*n})}finalizeState(t){super.finalizeState(t);const{aggregationBuffer:e,maxBuffer:n,maxTexture:i}=this.state;null===e||void 0===e||e.delete(),null===n||void 0===n||n.delete(),null===i||void 0===i||i.delete()}getPickingInfo(t){let{info:e}=t;const{index:n}=e;if(n>=0){const{gpuGridAggregator:t,gpuAggregation:i,weights:r}=this.state,o=i?t.getData("count"):r.count;e.object=V.getAggregationData({pixelIndex:n,...o})}return e}updateResults(t){let{aggregationData:e,maxData:n}=t;const{count:i}=this.state.weights;i.aggregationData=e,i.aggregationBuffer.setData({data:e}),i.maxData=n,i.maxTexture.setImageData({data:n})}updateAggregationState(t){const e=t.props.cellSizePixels,n=t.oldProps.cellSizePixels!==e,{viewportChanged:i}=t.changeFlags;let o=t.props.gpuAggregation;this.state.gpuAggregation!==t.props.gpuAggregation&&o&&!V.isSupported(this.context.gl)&&(r.Z.warn("GPU Grid Aggregation not supported, falling back to CPU")(),o=!1);const s=o!==this.state.gpuAggregation;this.setState({gpuAggregation:o});const a=this.isAttributeChanged(Ot),{dimensions:l}=this.state,{data:c,weights:u}=l,h=a||s||i||this.isAggregationDirty(t,{compareAll:o,dimension:c}),d=this.isAggregationDirty(t,{dimension:u});this.setState({aggregationDataDirty:h,aggregationWeightsDirty:d});const{viewport:f}=this.context;if(i||n){const{width:t,height:n}=f,i=Math.ceil(t/e),r=Math.ceil(n/e);this.allocateResources(r,i),this.setState({scaling:[t/2,-n/2,1],gridOffset:{xOffset:e,yOffset:e},width:t,height:n,numCol:i,numRow:r})}d&&this._updateAccessors(t),(h||d)&&this._resetResults()}_updateAccessors(t){const{getWeight:e,aggregation:n,data:i}=t.props,{count:r}=this.state.weights;r&&(r.getWeight=e,r.operation=y[n]),this.setState({getValue:x(n,e,{data:i})})}_resetResults(){const{count:t}=this.state.weights;t&&(t.aggregationData=null)}}(0,i.Z)(kt,"layerName","ScreenGridLayer"),(0,i.Z)(kt,"defaultProps",Lt);var Ut=n(90555);function zt(){}const Gt=["getBins","getDomain","getScaleFunc"],Nt=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],Zt=t=>t.cellSize;class jt{constructor(t){this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=t.getCellSize||Zt,this._getAggregator=t.getAggregator,this._addDimension(t.dimensions||Nt)}static defaultDimensions(){return Nt}updateState(t,e){const{oldProps:n,props:i,changeFlags:r}=t;this.updateGetValueFuncs(n,i,r);const o=this.needsReProjectPoints(n,i,r);let s=!1;if(r.dataChanged||o)this.getAggregatedData(i,e),s=!0;else{(this.getDimensionChanges(n,i,r)||[]).forEach((t=>"function"===typeof t&&t())),s=!0}return this.setState({aggregationDirty:s}),this.state}setState(t){this.state={...this.state,...t}}setDimensionState(t,e){this.setState({dimensions:{...this.state.dimensions,[t]:{...this.state.dimensions[t],...e}}})}normalizeResult(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.hexagons?{data:t.hexagons,...t}:t.layerData?{data:t.layerData,...t}:t}getAggregatedData(t,e){const n=this._getAggregator(t)(t,e);this.setState({layerData:this.normalizeResult(n)}),this.changeFlags={layerData:!0},this.getSortedBins(t)}updateGetValueFuncs(t,e,n){for(const i in this.dimensionUpdaters){const{value:r,weight:o,aggregation:s}=this.dimensionUpdaters[i].getBins.triggers;let a=e[r.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[i].getBins,t,e,n)&&(a=a?w(a,{data:e.data}):x(e[s.prop],e[o.prop],{data:e.data})),a&&this.setDimensionState(i,{getValue:a})}}needsReProjectPoints(t,e,n){return this._getCellSize(t)!==this._getCellSize(e)||this._getAggregator(t)!==this._getAggregator(e)||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}addDimension(t){this._addDimension(t)}_addDimension(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>{const{key:e}=t;this.dimensionUpdaters[e]=this.getDimensionUpdaters(t),this.state.dimensions[e]={getValue:null,domain:null,sortedBins:null,scaleFunc:zt}}))}getDimensionUpdaters(t){let{key:e,accessor:n,pickingInfo:i,getBins:r,getDomain:o,getScaleFunc:s,nullValue:a}=t;return{key:e,accessor:n,pickingInfo:i,getBins:{updater:this.getDimensionSortedBins,...r},getDomain:{updater:this.getDimensionValueDomain,...o},getScaleFunc:{updater:this.getDimensionScale,...s},attributeAccessor:this.getSubLayerDimensionAttribute(e,a)}}needUpdateDimensionStep(t,e,n,i){return Object.values(t.triggers).some((t=>t.updateTrigger?i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged[t.updateTrigger]):e[t.prop]!==n[t.prop]))}getDimensionChanges(t,e,n){const i=[];for(const r in this.dimensionUpdaters){const o=Gt.find((i=>this.needUpdateDimensionStep(this.dimensionUpdaters[r][i],t,e,n)));o&&i.push(this.dimensionUpdaters[r][o].updater.bind(this,e,this.dimensionUpdaters[r]))}return i.length?i:null}getUpdateTriggers(t){const e=t.updateTriggers||{},n={};for(const i in this.dimensionUpdaters){const{accessor:r}=this.dimensionUpdaters[i];n[r]={},Gt.forEach((o=>{Object.values(this.dimensionUpdaters[i][o].triggers).forEach((i=>{let{prop:o,updateTrigger:s}=i;if(s){const t=e[s];"object"!==typeof t||Array.isArray(t)?void 0!==t&&(n[r][o]=t):Object.assign(n[r],t)}else n[r][o]=t[o]}))}))}return n}getSortedBins(t){for(const e in this.dimensionUpdaters)this.getDimensionSortedBins(t,this.dimensionUpdaters[e])}getDimensionSortedBins(t,e){const{key:n}=e,{getValue:i}=this.state.dimensions[n],r=new wt(this.state.layerData.data||[],{getValue:i,filterData:t._filterData});this.setDimensionState(n,{sortedBins:r}),this.getDimensionValueDomain(t,e)}getDimensionValueDomain(t,e){const{getDomain:n,key:i}=e,{triggers:{lowerPercentile:r,upperPercentile:o,scaleType:s}}=n,a=this.state.dimensions[i].sortedBins.getValueDomainByScale(t[s.prop],[t[r.prop],t[o.prop]]);this.setDimensionState(i,{valueDomain:a}),this.getDimensionScale(t,e)}getDimensionScale(t,e){const{key:n,getScaleFunc:i,getDomain:r}=e,{domain:o,range:s}=i.triggers,{scaleType:a}=r.triggers,{onSet:l}=i,c=t[s.prop],u=t[o.prop]||this.state.dimensions[n].valueDomain,h=function(t){switch(t){case"quantize":default:return lt;case"linear":return ct;case"quantile":return ut;case"ordinal":return ft}}(a&&t[a.prop]),d=h(u,c);"object"===typeof l&&"function"===typeof t[l.props]&&t[l.props](d.domain()),this.setDimensionState(n,{scaleFunc:d})}getSubLayerDimensionAttribute(t,e){return n=>{const{sortedBins:i,scaleFunc:r}=this.state.dimensions[t],o=i.binMap[n.index];if(o&&0===o.counts)return e;const s=o&&o.value,a=r.domain();return s>=a[0]&&s<=a[a.length-1]?r(s):e}}getSubLayerAccessors(t){const e={};for(const n in this.dimensionUpdaters){const{accessor:i}=this.dimensionUpdaters[n];e[i]=this.getSubLayerDimensionAttribute(t,n)}return e}getPickingInfo(t){let{info:e}=t;let n=null;if(e.picked&&e.index>-1){const t=this.state.layerData.data[e.index],i={};for(const e in this.dimensionUpdaters){const{pickingInfo:n}=this.dimensionUpdaters[e],{sortedBins:r}=this.state.dimensions[e],o=r.binMap[t.index]&&r.binMap[t.index].value;i[n]=o}n=Object.assign(i,t,{points:t.filteredPoints||t.points})}return e.picked=Boolean(n),e.object=n,e}getAccessor(t){return this.dimensionUpdaters.hasOwnProperty(t)?this.dimensionUpdaters[t].attributeAccessor:zt}}function Vt(){}const Ht={colorDomain:null,colorRange:Q,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:Vt,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:Vt,gridAggregator:Dt,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},extruded:!1,material:!0,_filterData:{type:"function",value:null,optional:!0}};class Jt extends ot{initializeState(){const t=new jt({getAggregator:t=>t.gridAggregator,getCellSize:t=>t.cellSize});this.state={cpuAggregator:t,aggregatorState:t.state};this.getAttributeManager().add({positions:{size:3,type:5130,accessor:"getPosition"}})}updateState(t){super.updateState(t),this.setState({aggregatorState:this.state.cpuAggregator.updateState(t,{viewport:this.context.viewport,attributes:this.getAttributes(),numInstances:this.getNumInstances()})})}getPickingInfo(t){let{info:e}=t;return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(t){return this.state.cpuAggregator.getAccessor("fillColor")(t)}_onGetSublayerElevation(t){return this.state.cpuAggregator.getAccessor("elevation")(t)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:t,extruded:e,cellSize:n,coverage:i,material:r,transitions:o}=this.props,{cpuAggregator:s}=this.state,a=this.getSubLayerClass("grid-cell",Ut.Z),l=this._getSublayerUpdateTriggers();return new a({cellSize:n,coverage:i,material:r,elevationScale:t,extruded:e,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:l}),{data:s.state.layerData.data})}}(0,i.Z)(Jt,"layerName","CPUGridLayer"),(0,i.Z)(Jt,"defaultProps",Ht);var Wt=n(35387),Qt=Math.PI/3,Kt=[0,Qt,2*Qt,3*Qt,4*Qt,5*Qt];function qt(t){return t[0]}function Xt(t){return t[1]}function Yt(){}const $t={colorDomain:null,colorRange:Q,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:Yt,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:Yt,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(t,e){const{data:n,radius:i}=t,{viewport:o,attributes:s}=e,a=n.length?function(t,e){const{attributes:n}=e,i=n.positions.value,{size:r}=n.positions.getAccessor();let o,s=1/0,a=1/0,l=-1/0,c=-1/0;for(o=0;o<r*t.length;o+=r){const t=i[o],e=i[o+1];Number.isFinite(t)&&Number.isFinite(e)&&(s=Math.min(t,s),l=Math.max(t,l),a=Math.min(e,a),c=Math.max(e,c))}return[s,a,l,c].every(Number.isFinite)?[(s+l)/2,(a+c)/2]:null}(n,e):null,l=function(t,e,n){const{unitsPerMeter:i}=e.getDistanceScales(n);return t*i[0]}(i,o,a),c=[],{iterable:u,objectInfo:h}=(0,Ct.jB)(n),d=s.positions.value,{size:f}=s.positions.getAccessor();for(const p of u){h.index++;const t=h.index*f,e=[d[t],d[t+1]];Number.isFinite(e[0])&&Number.isFinite(e[1])?c.push({screenCoord:o.projectFlat(e),source:p,index:h.index}):r.Z.warn("HexagonLayer: invalid position")()}const A=function(){var t,e,n,i=0,r=0,o=1,s=1,a=qt,l=Xt;function c(t){var i,r={},o=[],s=t.length;for(i=0;i<s;++i)if(!isNaN(u=+a.call(null,c=t[i],i,t))&&!isNaN(h=+l.call(null,c,i,t))){var c,u,h,d=Math.round(h/=n),f=Math.round(u=u/e-(1&d)/2),A=h-d;if(3*Math.abs(A)>1){var p=u-f,g=f+(u<f?-1:1)/2,m=d+(h<d?-1:1),y=u-g,v=h-m;p*p+A*A>y*y+v*v&&(f=g+(1&d?1:-1)/2,d=m)}var _=f+"-"+d,b=r[_];b?b.push(c):(o.push(b=r[_]=[c]),b.x=(f+(1&d)/2)*e,b.y=d*n)}return o}function u(t){var e=0,n=0;return Kt.map((function(i){var r=Math.sin(i)*t,o=-Math.cos(i)*t,s=r-e,a=o-n;return e=r,n=o,[s,a]}))}return c.hexagon=function(e){return"m"+u(null==e?t:+e).join("l")+"z"},c.centers=function(){for(var a=[],l=Math.round(r/n),c=Math.round(i/e),u=l*n;u<s+t;u+=n,++l)for(var h=c*e+(1&l)*e/2;h<o+e/2;h+=e)a.push([h,u]);return a},c.mesh=function(){var e=u(t).slice(0,4).join("l");return c.centers().map((function(t){return"M"+t+"m"+e})).join("")},c.x=function(t){return arguments.length?(a=t,c):a},c.y=function(t){return arguments.length?(l=t,c):l},c.radius=function(i){return arguments.length?(e=2*(t=+i)*Math.sin(Qt),n=1.5*t,c):t},c.size=function(t){return arguments.length?(i=r=0,o=+t[0],s=+t[1],c):[o-i,s-r]},c.extent=function(t){return arguments.length?(i=+t[0][0],r=+t[0][1],o=+t[1][0],s=+t[1][1],c):[[i,r],[o,s]]},c.radius(1)}().radius(l).x((t=>t.screenCoord[0])).y((t=>t.screenCoord[1]));return{hexagons:A(c).map(((t,e)=>({position:o.unprojectFlat([t.x,t.y]),points:t,index:e}))),radiusCommon:l}},getPosition:{type:"accessor",value:t=>t.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class te extends ot{constructor(){super(...arguments),(0,i.Z)(this,"state",void 0)}initializeState(){const t=new jt({getAggregator:t=>t.hexagonAggregator,getCellSize:t=>t.radius});this.state={cpuAggregator:t,aggregatorState:t.state,vertices:null};this.getAttributeManager().add({positions:{size:3,type:5130,accessor:"getPosition"}})}updateState(t){if(super.updateState(t),t.changeFlags.propsOrDataChanged){const e=this.state.cpuAggregator.updateState(t,{viewport:this.context.viewport,attributes:this.getAttributes()});if(this.state.aggregatorState.layerData!==e.layerData){const{hexagonVertices:t}=e.layerData||{};this.setState({vertices:t&&this.convertLatLngToMeterOffset(t)})}this.setState({aggregatorState:e})}}convertLatLngToMeterOffset(t){const{viewport:e}=this.context;if(Array.isArray(t)&&6===t.length){const n=t[0],i=t[3],r=[(n[0]+i[0])/2,(n[1]+i[1])/2],o=e.projectFlat(r),{metersPerUnit:s}=e.getDistanceScales(r);return t.map((t=>{const n=e.projectFlat(t);return[(n[0]-o[0])*s[0],(n[1]-o[1])*s[1]]}))}return r.Z.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo(t){let{info:e}=t;return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(t){return this.state.cpuAggregator.getAccessor("fillColor")(t)}_onGetSublayerElevation(t){return this.state.cpuAggregator.getAccessor("elevation")(t)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:t,extruded:e,coverage:n,material:i,transitions:r}=this.props,{aggregatorState:o,vertices:s}=this.state,a=this.getSubLayerClass("hexagon-cell",Wt.Z),l=this._getSublayerUpdateTriggers();return new a({...s?{vertices:s,radius:1}:{radius:o.layerData.radiusCommon||1,radiusUnits:"common",angle:90},diskResolution:6,elevationScale:t,extruded:e,coverage:n,material:i,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:r&&{getFillColor:r.getColorValue||r.getColorWeight,getElevation:r.getElevationValue||r.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:l}),{data:o.layerData.data})}}(0,i.Z)(te,"layerName","HexagonLayer"),(0,i.Z)(te,"defaultProps",$t);var ee=n(24985),ne=n(3453);const ie=.5,re=1/6,oe={N:[0,ie],E:[ie,0],S:[0,-.5],W:[-.5,0],NE:[ie,ie],NW:[-.5,ie],SE:[ie,-.5],SW:[-.5,-.5]},se=[oe.W,oe.SW,oe.S],ae=[oe.S,oe.SE,oe.E],le=[oe.E,oe.NE,oe.N],ce=[oe.NW,oe.W,oe.N],ue=[[-.5,re],[-.5,-re],[-re,-.5],[re,-.5]],he=[[-re,-.5],[re,-.5],[ie,-re],[ie,re]],de=[[ie,-re],[ie,re],[re,ie],[-re,ie]],fe=[[-.5,re],[-.5,-re],[re,ie],[-re,ie]],Ae=[oe.W,oe.SW,oe.SE,oe.E],pe=[oe.S,oe.SE,oe.NE,oe.N],ge=[oe.NW,oe.W,oe.E,oe.NE],me=[oe.NW,oe.SW,oe.S,oe.N],ye=[[-.5,re],[-.5,-re],[ie,-re],[ie,re]],ve=[[-re,-.5],[re,-.5],[re,ie],[-re,ie]],_e=[oe.NW,oe.SW,oe.SE,oe.NE],be=[oe.NW,oe.SW,oe.SE,oe.E,oe.N],xe=[oe.W,oe.SW,oe.SE,oe.NE,oe.N],we=[oe.NW,oe.W,oe.S,oe.SE,oe.NE],Ce=[oe.NW,oe.SW,oe.S,oe.E,oe.NE],Be=[oe.NW,oe.W,[ie,-re],[ie,re],oe.N],Ee=[[-re,-.5],[re,-.5],oe.E,oe.NE,oe.N],Te=[[-.5,re],[-.5,-re],oe.S,oe.SE,oe.E],Se=[oe.W,oe.SW,oe.S,[re,ie],[-re,ie]],Me=[oe.NW,oe.W,[-re,-.5],[re,-.5],oe.N],Ie=[[-.5,re],[-.5,-re],oe.E,oe.NE,oe.N],Pe=[oe.S,oe.SE,oe.E,[re,ie],[-re,ie]],De=[oe.W,oe.SW,oe.S,[ie,-re],[ie,re]],Fe=[oe.W,oe.SW,oe.SE,oe.E,[re,ie],[-re,ie]],Le=[[-.5,re],[-.5,-re],oe.S,oe.SE,oe.NE,oe.N],Oe=[oe.NW,oe.W,[-re,-.5],[re,-.5],oe.E,oe.NE],Re=[oe.NW,oe.SW,oe.S,[ie,-re],[ie,re],oe.N],ke=[oe.W,oe.SW,oe.S,oe.E,oe.NE,oe.N],Ue=[oe.NW,oe.W,oe.S,oe.SE,oe.E,oe.N],ze=[[-.5,re],[-.5,-re],[-re,-.5],[re,-.5],oe.E,oe.NE,oe.N],Ge=[oe.W,oe.SW,oe.S,[ie,-re],[ie,re],[re,ie],[-re,ie]],Ne=[oe.NW,oe.W,[-re,-.5],[re,-.5],[ie,-re],[ie,re],oe.N],Ze=[[-.5,re],[-.5,-re],oe.S,oe.SE,oe.E,[re,ie],[-re,ie]],je=[[-.5,re],[-.5,-re],[-re,-.5],[re,-.5],[ie,-re],[ie,re],[re,ie],[-re,ie]],Ve={0:[],1:[[oe.W,oe.S]],2:[[oe.S,oe.E]],3:[[oe.W,oe.E]],4:[[oe.N,oe.E]],5:{0:[[oe.W,oe.S],[oe.N,oe.E]],1:[[oe.W,oe.N],[oe.S,oe.E]]},6:[[oe.N,oe.S]],7:[[oe.W,oe.N]],8:[[oe.W,oe.N]],9:[[oe.N,oe.S]],10:{0:[[oe.W,oe.N],[oe.S,oe.E]],1:[[oe.W,oe.S],[oe.N,oe.E]]},11:[[oe.N,oe.E]],12:[[oe.W,oe.E]],13:[[oe.S,oe.E]],14:[[oe.W,oe.S]],15:[]};function He(t){return parseInt(t,4)}const Je={[He("0000")]:[],[He("2222")]:[],[He("2221")]:[se],[He("2212")]:[ae],[He("2122")]:[le],[He("1222")]:[ce],[He("0001")]:[se],[He("0010")]:[ae],[He("0100")]:[le],[He("1000")]:[ce],[He("2220")]:[ue],[He("2202")]:[he],[He("2022")]:[de],[He("0222")]:[fe],[He("0002")]:[ue],[He("0020")]:[he],[He("0200")]:[de],[He("2000")]:[fe],[He("0011")]:[Ae],[He("0110")]:[pe],[He("1100")]:[ge],[He("1001")]:[me],[He("2211")]:[Ae],[He("2112")]:[pe],[He("1122")]:[ge],[He("1221")]:[me],[He("2200")]:[ye],[He("2002")]:[ve],[He("0022")]:[ye],[He("0220")]:[ve],[He("1111")]:[_e],[He("1211")]:[be],[He("2111")]:[xe],[He("1112")]:[we],[He("1121")]:[Ce],[He("1011")]:[be],[He("0111")]:[xe],[He("1110")]:[we],[He("1101")]:[Ce],[He("1200")]:[Be],[He("0120")]:[Ee],[He("0012")]:[Te],[He("2001")]:[Se],[He("1022")]:[Be],[He("2102")]:[Ee],[He("2210")]:[Te],[He("0221")]:[Se],[He("1002")]:[Me],[He("2100")]:[Ie],[He("0210")]:[Pe],[He("0021")]:[De],[He("1220")]:[Me],[He("0122")]:[Ie],[He("2012")]:[Pe],[He("2201")]:[De],[He("0211")]:[Fe],[He("2110")]:[Le],[He("1102")]:[Oe],[He("1021")]:[Re],[He("2011")]:[Fe],[He("0112")]:[Le],[He("1120")]:[Oe],[He("1201")]:[Re],[He("2101")]:[ke],[He("0121")]:[ke],[He("1012")]:[Ue],[He("1210")]:[Ue],[He("0101")]:{0:[se,le],1:[ke],2:[ke]},[He("1010")]:{0:[ce,ae],1:[Ue],2:[Ue]},[He("2121")]:{0:[ke],1:[ke],2:[se,le]},[He("1212")]:{0:[Ue],1:[Ue],2:[ce,ae]},[He("2120")]:{0:[ze],1:[ze],2:[ue,le]},[He("2021")]:{0:[Ge],1:[Ge],2:[se,de]},[He("1202")]:{0:[Ne],1:[Ne],2:[ce,he]},[He("0212")]:{0:[Ze],1:[Ze],2:[ae,fe]},[He("0102")]:{0:[ue,le],1:[ze],2:[ze]},[He("0201")]:{0:[se,de],1:[Ge],2:[Ge]},[He("1020")]:{0:[ce,he],1:[Ne],2:[Ne]},[He("2010")]:{0:[ae,fe],1:[Ze],2:[Ze]},[He("2020")]:{0:[fe,he],1:[je],2:[ue,de]},[He("0202")]:{0:[de,ue],1:[je],2:[fe,he]}},We={ISO_LINES:1,ISO_BANDS:2},Qe={zIndex:0,zOffset:.005};function Ke(t,e){return Array.isArray(e)?t<e[0]?0:t<e[1]?1:2:t>=e?1:0}function qe(t){const{cellWeights:e,x:n,y:i,width:o,height:s}=t;let a=t.threshold;t.thresholdValue&&(r.Z.deprecated("thresholdValue","threshold")(),a=t.thresholdValue);const l=n<0,c=n>=o-1,u=i<0,h=i>=s-1,d=l||c||u||h,f={},A={};l||h?A.top=0:(f.top=e[(i+1)*o+n],A.top=Ke(f.top,a)),c||h?A.topRight=0:(f.topRight=e[(i+1)*o+n+1],A.topRight=Ke(f.topRight,a)),c||u?A.right=0:(f.right=e[i*o+n+1],A.right=Ke(f.right,a)),l||u?A.current=0:(f.current=e[i*o+n],A.current=Ke(f.current,a));const{top:p,topRight:g,right:m,current:y}=A;let v=-1;Number.isFinite(a)&&(v=p<<3|g<<2|m<<1|y),Array.isArray(a)&&(v=p<<6|g<<4|m<<2|y);let _=0;return d||(_=Ke((f.top+f.topRight+f.right+f.current)/4,a)),{code:v,meanCode:_}}function Xe(t){const{gridOrigin:e,cellSize:n,x:i,y:r,code:o,meanCode:s,type:a=We.ISO_LINES}=t,l={...Qe,...t.thresholdData};let c=a===We.ISO_BANDS?Je[o]:Ve[o];Array.isArray(c)||(c=c[s]);const u=l.zIndex*l.zOffset,h=(i+1)*n[0],d=(r+1)*n[1],f=e[0]+h,A=e[1]+d;if(a===We.ISO_BANDS){const t=[];return c.forEach((e=>{const i=[];e.forEach((t=>{const e=f+t[0]*n[0],r=A+t[1]*n[1];i.push([e,r,u])})),t.push(i)})),t}const p=[];return c.forEach((t=>{t.forEach((t=>{const e=f+t[0]*n[0],i=A+t[1]*n[1];p.push([e,i,u])}))})),p}const Ye=[255,255,255,255],$e={cellSize:{type:"number",min:1,max:1e3,value:1e3},getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005},tn="positions",en={data:{props:["cellSize"]},weights:{props:["aggregation"],accessors:["getWeight"]}};class nn extends Ft{initializeState(){super.initializeAggregationLayer({dimensions:en}),this.setState({contourData:{},projectPoints:!1,weights:{count:{size:1,operation:y.SUM}}});this.getAttributeManager().add({[tn]:{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}updateState(t){super.updateState(t);let e=!1;const{oldProps:n,props:i}=t,{aggregationDirty:r}=this.state;n.contours===i.contours&&n.zOffset===i.zOffset||(e=!0,this._updateThresholdData(t.props)),this.getNumInstances()>0&&(r||e)&&this._generateContours()}renderLayers(){const{contourSegments:t,contourPolygons:e}=this.state.contourData,n=this.getSubLayerClass("lines",ee.Z),i=this.getSubLayerClass("bands",ne.Z);return[t&&t.length>0&&new n(this.getSubLayerProps({id:"lines"}),{data:this.state.contourData.contourSegments,getSourcePosition:t=>t.start,getTargetPosition:t=>t.end,getColor:t=>t.contour.color||Ye,getWidth:t=>t.contour.strokeWidth||1}),e&&e.length>0&&new i(this.getSubLayerProps({id:"bands"}),{data:this.state.contourData.contourPolygons,getPolygon:t=>t.vertices,getFillColor:t=>t.contour.color||Ye})]}updateAggregationState(t){const{props:e,oldProps:n}=t,{cellSize:i,coordinateSystem:o}=e,{viewport:s}=this.context,a=n.cellSize!==i;let l=e.gpuAggregation;this.state.gpuAggregation!==e.gpuAggregation&&l&&!V.isSupported(this.context.gl)&&(r.Z.warn("GPU Grid Aggregation not supported, falling back to CPU")(),l=!1);const c=l!==this.state.gpuAggregation;this.setState({gpuAggregation:l});const{dimensions:u}=this.state,h=this.isAttributeChanged(tn),{data:d,weights:f}=u;let{boundingBox:A}=this.state;if(h&&(A=St(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:A})),h||a){const{gridOffset:t,translation:e,width:n,height:r,numCol:a,numRow:l}=Pt(A,i,s,o);this.allocateResources(l,a),this.setState({gridOffset:t,boundingBox:A,translation:e,posOffset:e.slice(),gridOrigin:[-1*e[0],-1*e[1]],width:n,height:r,numCol:a,numRow:l})}const p=h||c||this.isAggregationDirty(t,{dimension:d,compareAll:l}),g=this.isAggregationDirty(t,{dimension:f});g&&this._updateAccessors(t),(p||g)&&this._resetResults(),this.setState({aggregationDataDirty:p,aggregationWeightsDirty:g})}_updateAccessors(t){const{getWeight:e,aggregation:n,data:i}=t.props,{count:r}=this.state.weights;r&&(r.getWeight=e,r.operation=y[n]),this.setState({getValue:x(n,e,{data:i})})}_resetResults(){const{count:t}=this.state.weights;t&&(t.aggregationData=null)}_generateContours(){const{numCol:t,numRow:e,gridOrigin:n,gridOffset:i,thresholdData:r}=this.state,{count:o}=this.state.weights;let{aggregationData:s}=o;s||(s=o.aggregationBuffer.getData(),o.aggregationData=s);const{cellWeights:a}=V.getCellData({countsData:s}),l=function(t){let{thresholdData:e,cellWeights:n,gridSize:i,gridOrigin:r,cellSize:o}=t;const s=[],a=[],l=i[0],c=i[1];let u=0,h=0;for(const d of e){const{contour:t}=d,{threshold:e}=t;for(let i=-1;i<l;i++)for(let f=-1;f<c;f++){const{code:A,meanCode:p}=qe({cellWeights:n,threshold:e,x:i,y:f,width:l,height:c}),g={type:We.ISO_BANDS,gridOrigin:r,cellSize:o,x:i,y:f,width:l,height:c,code:A,meanCode:p,thresholdData:d};if(Array.isArray(e)){g.type=We.ISO_BANDS;const e=Xe(g);for(const n of e)a[h++]={vertices:n,contour:t}}else{g.type=We.ISO_LINES;const e=Xe(g);for(let n=0;n<e.length;n+=2)s[u++]={start:e[n],end:e[n+1],contour:t}}}}return{contourSegments:s,contourPolygons:a}}({thresholdData:r,cellWeights:a,gridSize:[t,e],gridOrigin:n,cellSize:[i.xOffset,i.yOffset]});this.setState({contourData:l})}_updateThresholdData(t){const{contours:e,zOffset:n}=t,i=e.length,r=new Array(i);for(let o=0;o<i;o++){const t=e[o];r[o]={contour:t,zIndex:t.zIndex||o,zOffset:n}}this.setState({thresholdData:r})}}(0,i.Z)(nn,"layerName","ContourLayer"),(0,i.Z)(nn,"defaultProps",$e);var rn=n(54976),on=n(64441),sn=n(34819);const an={colorDomain:null,colorRange:Q,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",value:[1,1]},gridOrigin:{type:"array",value:[0,0]},gridOffset:{type:"array",value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,material:!0};class ln extends J.Z{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 normals;\n\nin vec4 colors;\nin vec4 elevations;\nin vec3 instancePickingColors;\nuniform vec2 offset;\nuniform bool extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\n\nuniform ivec2 gridSize;\nuniform vec2 gridOrigin;\nuniform vec2 gridOriginLow;\nuniform vec2 gridOffset;\nuniform vec2 gridOffsetLow;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 elevationRange;\nuniform vec2 colorDomain;\nuniform bool colorDomainValid;\nuniform vec2 elevationDomain;\nuniform bool elevationDomainValid;\n\nlayout(std140) uniform;\nuniform ColorData\n{\n  vec4 maxMinCount;\n} colorData;\nuniform ElevationData\n{\n  vec4 maxMinCount;\n} elevationData;\n\n#define EPSILON 0.00001\nout vec4 vColor;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  return outColor;\n}\n\nfloat linearScale(vec2 domain, vec2 range, float value) {\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;\n  }\n  return -1.;\n}\n\nvoid main(void) {\n  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);\n  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);\n\n  float elevation = 0.0;\n\n  if (extruded) {\n    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);\n    elevation = linearScale(elvDomain, elevationRange, elevations.r);\n    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;\n  }\n  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);\n  float dotRadius = cellSize / 2. * coverage * shouldRender;\n\n  int yIndex = (gl_InstanceID / gridSize[0]);\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));\n  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));\n  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));\n  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));\n\n  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);\n  vec3 centroidPosition64Low = vec3(instancePositionXFP64[1], instancePositionYFP64[1], 0.0);\n  geometry.worldPosition = centroidPosition;\n  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\n\n  vec3 normals_commonspace = project_normal(normals);\n\n   if (extruded) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.;\n  }\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vColor;\n  fragColor = picking_filterColor(fragColor);\n}\n",modules:[m.Z,rn.N,W.Z,p]})}initializeState(t){let{gl:e}=t;this.getAttributeManager().addInstanced({colors:{size:4,noAlloc:!0},elevations:{size:4,noAlloc:!0}});const n=this._getModel(e);this._setupUniformBuffer(n),this.setState({model:n})}_getModel(t){return new c.Z(t,{...this.getShaders(),id:this.props.id,geometry:new sn.Z,isInstanced:!0})}draw(t){let{uniforms:e}=t;const{cellSize:n,offset:i,extruded:r,elevationScale:o,coverage:s,gridSize:a,gridOrigin:l,gridOffset:c,elevationRange:u,colorMaxMinBuffer:h,elevationMaxMinBuffer:d}=this.props,f=[(0,on.Ks)(l[0]),(0,on.Ks)(l[1])],A=[(0,on.Ks)(c[0]),(0,on.Ks)(c[1])],p=this.getDomainUniforms(),g=K(this.props.colorRange);this.bindUniformBuffers(h,d),this.state.model.setUniforms(e).setUniforms(p).setUniforms({cellSize:n,offset:i,extruded:r,elevationScale:o,coverage:s,gridSize:a,gridOrigin:l,gridOriginLow:f,gridOffset:c,gridOffsetLow:A,colorRange:g,elevationRange:u}).draw(),this.unbindUniformBuffers(h,d)}bindUniformBuffers(t,e){t.bind({target:35345,index:0}),e.bind({target:35345,index:1})}unbindUniformBuffers(t,e){t.unbind({target:35345,index:0}),e.unbind({target:35345,index:1})}getDomainUniforms(){const{colorDomain:t,elevationDomain:e}=this.props,n={};return null!==t?(n.colorDomainValid=!0,n.colorDomain=t):n.colorDomainValid=!1,null!==e?(n.elevationDomainValid=!0,n.elevationDomain=e):n.elevationDomainValid=!1,n}_setupUniformBuffer(t){const e=this.context.gl,n=t.program.handle,i=e.getUniformBlockIndex(n,"ColorData"),r=e.getUniformBlockIndex(n,"ElevationData");e.uniformBlockBinding(n,i,0),e.uniformBlockBinding(n,r,1)}}(0,i.Z)(ln,"layerName","GPUGridCellLayer"),(0,i.Z)(ln,"defaultProps",an);const cn={colorDomain:null,colorRange:Q,getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:1,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},extruded:!1,material:!0},un={data:{props:["cellSize","colorAggregation","elevationAggregation"]}},hn="positions";class dn extends Ft{initializeState(t){let{gl:e}=t;const n=V.isSupported(e);n||r.Z.error("GPUGridLayer is not supported on this browser, use GridLayer instead")(),super.initializeAggregationLayer({dimensions:un}),this.setState({gpuAggregation:!0,projectPoints:!1,isSupported:n,weights:{color:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:new st.Z(e,{byteLength:16,accessor:{size:4,type:5126,divisor:1}})},elevation:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:new st.Z(e,{byteLength:16,accessor:{size:4,type:5126,divisor:1}})}},positionAttributeName:"positions"});this.getAttributeManager().add({[hn]:{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()},color:{size:3,accessor:"getColorWeight"},elevation:{size:3,accessor:"getElevationWeight"}})}updateState(t){if(!1===this.state.isSupported)return;super.updateState(t);const{aggregationDirty:e}=this.state;e&&this.setState({gridHash:null})}getHashKeyForIndex(t){const{numRow:e,numCol:n,boundingBox:i,gridOffset:r}=this.state,o=[n,e],s=[i.xMin,i.yMin],a=[r.xOffset,r.yOffset],l=Math.floor(t/o[0]),c=t-l*o[0],u=Math.floor((l*a[1]+s[1]+90+a[1]/2)/a[1]),h=Math.floor((c*a[0]+s[0]+180+a[0]/2)/a[0]);return"".concat(u,"-").concat(h)}getPositionForIndex(t){const{numRow:e,numCol:n,boundingBox:i,gridOffset:r}=this.state,o=[n,e],s=[i.xMin,i.yMin],a=[r.xOffset,r.yOffset],l=Math.floor(t/o[0]);return[(t-l*o[0])*a[0]+s[0],l*a[1]+s[1]]}getPickingInfo(t){let{info:e,mode:n}=t;const{index:i}=e;let r=null;if(i>=0){const{gpuGridAggregator:t}=this.state,e=this.getPositionForIndex(i),o=V.getAggregationData({pixelIndex:i,...t.getData("color")}),s=V.getAggregationData({pixelIndex:i,...t.getData("elevation")});if(r={colorValue:o.cellWeight,elevationValue:s.cellWeight,count:o.cellCount||s.cellCount,position:e,totalCount:o.totalCount||s.totalCount},"hover"!==n){const{props:t}=this;let{gridHash:e}=this.state;if(!e){const{gridOffset:n,translation:i,boundingBox:r}=this.state,{viewport:o}=this.context;e=Dt(t,{gridOffset:n,attributes:this.getAttributes(),viewport:o,translation:i,boundingBox:r}).gridHash,this.setState({gridHash:e})}const n=e[this.getHashKeyForIndex(i)];Object.assign(r,n)}}return e.picked=Boolean(r),e.object=r,e}renderLayers(){if(!this.state.isSupported)return null;const{elevationScale:t,extruded:e,cellSize:n,coverage:i,material:r,elevationRange:o,colorDomain:s,elevationDomain:a}=this.props,{weights:l,numRow:c,numCol:u,gridOrigin:h,gridOffset:d}=this.state,{color:f,elevation:A}=l,p=K(this.props.colorRange);return new(this.getSubLayerClass("gpu-grid-cell",ln))({gridSize:[u,c],gridOrigin:h,gridOffset:[d.xOffset,d.yOffset],colorRange:p,elevationRange:o,colorDomain:s,elevationDomain:a,cellSize:n,coverage:i,material:r,elevationScale:t,extruded:e},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:{attributes:{colors:f.aggregationBuffer,elevations:A.aggregationBuffer}},colorMaxMinBuffer:f.maxMinBuffer,elevationMaxMinBuffer:A.maxMinBuffer,numInstances:u*c})}finalizeState(t){const{color:e,elevation:n}=this.state.weights;[e,n].forEach((t=>{const{aggregationBuffer:e,maxMinBuffer:n}=t;n.delete(),null===e||void 0===e||e.delete()})),super.finalizeState(t)}updateAggregationState(t){const{props:e,oldProps:n}=t,{cellSize:i,coordinateSystem:r}=e,{viewport:o}=this.context,s=n.cellSize!==i,{dimensions:a}=this.state,l=this.isAttributeChanged(hn),c=l||this.isAttributeChanged();let{boundingBox:u}=this.state;if(l&&(u=St(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:u})),l||s){const{gridOffset:t,translation:e,width:n,height:s,numCol:a,numRow:l}=Pt(u,i,o,r);this.allocateResources(l,a),this.setState({gridOffset:t,translation:e,gridOrigin:[-1*e[0],-1*e[1]],width:n,height:s,numCol:a,numRow:l})}const h=c||this.isAggregationDirty(t,{dimension:a.data,compareAll:!0});h&&this._updateAccessors(t),this.setState({aggregationDataDirty:h})}_updateAccessors(t){const{colorAggregation:e,elevationAggregation:n}=t.props,{color:i,elevation:r}=this.state.weights;i.operation=y[e],r.operation=y[n]}}(0,i.Z)(dn,"layerName","GPUGridLayer"),(0,i.Z)(dn,"defaultProps",cn);const fn={...dn.defaultProps,...Jt.defaultProps,gpuAggregation:!1};class An extends et.Z{constructor(){super(...arguments),(0,i.Z)(this,"state",void 0)}initializeState(){this.state={useGPUAggregation:!0}}updateState(t){let{props:e}=t;this.setState({useGPUAggregation:this.canUseGPUAggregation(e)})}renderLayers(){const{data:t,updateTriggers:e}=this.props,n=this.state.useGPUAggregation?"GPU":"CPU";return new(this.state.useGPUAggregation?this.getSubLayerClass("GPU",dn):this.getSubLayerClass("CPU",Jt))(this.props,this.getSubLayerProps({id:n,updateTriggers:e}),{data:t})}canUseGPUAggregation(t){const{gpuAggregation:e,lowerPercentile:n,upperPercentile:i,getColorValue:r,getElevationValue:o,colorScaleType:s}=t;return!!e&&(!!V.isSupported(this.context.gl)&&(0===n&&100===i&&(null===r&&null===o&&("quantile"!==s&&"ordinal"!==s))))}}(0,i.Z)(An,"layerName","GridLayer"),(0,i.Z)(An,"defaultProps",fn);const pn=new Float32Array(12);function gn(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=0;for(const i of t)for(let t=0;t<e;t++)pn[n++]=i[t]||0;return pn}class mn extends J.Z{getShaders(){return{vs:"#define SHADER_NAME heatp-map-layer-vertex-shader\n\nuniform sampler2D maxTexture;\nuniform float intensity;\nuniform vec2 colorDomain;\nuniform float threshold;\nuniform float aggregationMode;\n\nattribute vec3 positions;\nattribute vec2 texCoords;\n\nvarying vec2 vTexCoords;\nvarying float vIntensityMin;\nvarying float vIntensityMax;\n\nvoid main(void) {\n  gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));\n  vTexCoords = texCoords;\n  vec4 maxTexture = texture2D(maxTexture, vec2(0.5));\n  float maxValue = aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;\n  float minValue = maxValue * threshold;\n  if (colorDomain[1] > 0.) {\n    maxValue = colorDomain[1];\n    minValue = colorDomain[0];\n  }\n  vIntensityMax = intensity / maxValue;\n  vIntensityMin = intensity / minValue;\n}\n",fs:"#define SHADER_NAME triangle-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D texture;\nuniform sampler2D colorTexture;\nuniform float aggregationMode;\n\nvarying vec2 vTexCoords;\nvarying float vIntensityMin;\nvarying float vIntensityMax;\n\nvec4 getLinearColor(float value) {\n  float factor = clamp(value * vIntensityMax, 0., 1.);\n  vec4 color = texture2D(colorTexture, vec2(factor, 0.5));\n  color.a *= min(value * vIntensityMin, 1.0);\n  return color;\n}\n\nvoid main(void) {\n  vec4 weights = texture2D(texture, vTexCoords);\n  float weight = weights.r;\n\n  if (aggregationMode > 0.5) {\n    weight /= max(1.0, weights.a);\n  }\n  if (weight <= 0.) {\n     discard;\n  }\n\n  vec4 linearColor = getLinearColor(weight);\n  linearColor.a *= opacity;\n  gl_FragColor =linearColor;\n}\n",modules:[m.Z]}}initializeState(t){let{gl:e}=t;this.getAttributeManager().add({positions:{size:3,noAlloc:!0},texCoords:{size:2,noAlloc:!0}}),this.setState({model:this._getModel(e)})}_getModel(t){const{vertexCount:e}=this.props;return new c.Z(t,{...this.getShaders(),id:this.props.id,geometry:new H.Z({drawMode:6,vertexCount:e})})}draw(t){let{uniforms:e}=t;const{model:n}=this.state,{texture:i,maxTexture:r,colorTexture:o,intensity:s,threshold:a,aggregationMode:l,colorDomain:c}=this.props;n.setUniforms({...e,texture:i,maxTexture:r,colorTexture:o,intensity:s,threshold:a,aggregationMode:l,colorDomain:c}).draw()}}(0,i.Z)(mn,"layerName","TriangleLayer");const yn={mipmaps:!1,parameters:{10240:9729,10241:9729,10242:33071,10243:33071},dataFormat:6408},vn=[0,0],_n={SUM:0,MEAN:1},bn={getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Q,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},xn=[o.h.BLEND_EQUATION_MINMAX,o.h.TEXTURE_FLOAT],wn=[o.h.COLOR_ATTACHMENT_RGBA32F,o.h.FLOAT_BLEND],Cn={data:{props:["radiusPixels"]}};class Bn extends ot{constructor(){super(...arguments),(0,i.Z)(this,"state",void 0)}initializeState(){const{gl:t}=this.context;if(!(0,s.ag)(t,xn))return this.setState({supported:!1}),void r.Z.error("HeatmapLayer: ".concat(this.id," is not supported on this browser"))();super.initializeAggregationLayer(Cn),this.setState({supported:!0,colorDomain:vn}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState(t){let{changeFlags:e}=t;return e.somethingChanged}updateState(t){this.state.supported&&(super.updateState(t),this._updateHeatmapState(t))}_updateHeatmapState(t){const{props:e,oldProps:n}=t,i=this._getChangeFlags(t);(i.dataChanged||i.viewportChanged)&&(i.boundsChanged=this._updateBounds(i.dataChanged),this._updateTextureRenderingBounds()),i.dataChanged||i.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):i.viewportZoomChanged&&this._debouncedUpdateWeightmap(),e.colorRange!==n.colorRange&&this._updateColorTexture(t),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:t.context.viewport.zoom})}renderLayers(){if(!this.state.supported)return[];const{weightsTexture:t,triPositionBuffer:e,triTexCoordBuffer:n,maxWeightsTexture:i,colorTexture:r,colorDomain:o}=this.state,{updateTriggers:s,intensity:a,threshold:l,aggregation:c}=this.props;return new(this.getSubLayerClass("triangle",mn))(this.getSubLayerProps({id:"triangle-layer",updateTriggers:s}),{coordinateSystem:Bt.Df.DEFAULT,data:{attributes:{positions:e,texCoords:n}},vertexCount:4,maxTexture:i,colorTexture:r,aggregationMode:_n[c]||0,texture:t,intensity:a,threshold:l,colorDomain:o})}finalizeState(t){super.finalizeState(t);const{weightsTransform:e,weightsTexture:n,maxWeightTransform:i,maxWeightsTexture:r,triPositionBuffer:o,triTexCoordBuffer:s,colorTexture:a,updateTimer:l}=this.state;null===e||void 0===e||e.delete(),null===n||void 0===n||n.delete(),null===i||void 0===i||i.delete(),null===r||void 0===r||r.delete(),null===o||void 0===o||o.delete(),null===s||void 0===s||s.delete(),null===a||void 0===a||a.delete(),l&&clearTimeout(l)}_getAttributeManager(){return new it.Z(this.context.gl,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(t){const e={},{dimensions:n}=this.state;e.dataChanged=this.isAttributeChanged()||this.isAggregationDirty(t,{compareAll:!0,dimension:n.data}),e.viewportChanged=t.changeFlags.viewportChanged;const{zoom:i}=this.state;return t.context.viewport&&t.context.viewport.zoom===i||(e.viewportZoomChanged=!0),e}_createTextures(){const{gl:t}=this.context,{textureSize:e,format:n,type:i}=this.state;this.setState({weightsTexture:new R.Z(t,{width:e,height:e,format:n,type:i,...yn}),maxWeightsTexture:new R.Z(t,{format:n,type:i,...yn})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:5130,accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{gl:t}=this.context,{weightsTextureSize:e}=this.props,n=Math.min(e,(0,a.ZS)(t,3379)),i=(0,s.ag)(t,wn),{format:o,type:l}=function(t){let{gl:e,floatTargetSupport:n}=t;return n?{format:(0,a.D0)(e)?34836:6408,type:5126}:{format:6408,type:5121}}({gl:t,floatTargetSupport:i}),c=i?1:1/255;this.setState({textureSize:n,format:o,type:l,weightsScale:c}),i||r.Z.warn("HeatmapLayer: ".concat(this.id," rendering to float texture not supported, fallingback to low precession format"))()}getShaders(t){return super.getShaders("max-weights-transform"===t?{vs:"attribute vec4 inTexture;\nvarying vec4 outTexture;\n\nvoid main()\n{\noutTexture = inTexture;\ngl_Position = vec4(0, 0, 0, 1.);\ngl_PointSize = 1.0;\n}\n",_fs:"varying vec4 outTexture;\nvoid main() {\n  gl_FragColor = outTexture;\n  gl_FragColor.g = outTexture.r / max(1.0, outTexture.a);\n}\n"}:{vs:"attribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float weights;\nvarying vec4 weightsTexture;\nuniform float radiusPixels;\nuniform float textureWidth;\nuniform vec4 commonBounds;\nuniform float weightsScale;\nvoid main()\n{\n  weightsTexture = vec4(weights * weightsScale, 0., 0., 1.);\n\n  float radiusTexels  = project_pixel_size(radiusPixels) * textureWidth / (commonBounds.z - commonBounds.x);\n  gl_PointSize = radiusTexels * 2.;\n\n  vec3 commonPosition = project_position(positions, positions64Low);\n  gl_Position.xy = (commonPosition.xy - commonBounds.xy) / (commonBounds.zw - commonBounds.xy) ;\n  gl_Position.xy = (gl_Position.xy * 2.) - (1.);\n}\n",_fs:"varying vec4 weightsTexture;\nfloat gaussianKDE(float u){\n  return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);\n}\nvoid main()\n{\n  float dist = length(gl_PointCoord - vec2(0.5, 0.5));\n  if (dist > 0.5) {\n    discard;\n  }\n  gl_FragColor = weightsTexture * gaussianKDE(2. * dist);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"})}_createWeightsTransform(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e;const{gl:n}=this.context;let{weightsTransform:i}=this.state;const{weightsTexture:r}=this.state;null===(e=i)||void 0===e||e.delete(),i=new u.Z(n,{id:"".concat(this.id,"-weights-transform"),elementCount:1,_targetTexture:r,_targetTextureVarying:"weightsTexture",...t}),this.setState({weightsTransform:i})}_setupResources(){const{gl:t}=this.context;this._createTextures();const{textureSize:e,weightsTexture:n,maxWeightsTexture:i}=this.state,r=this.getShaders("weights-transform");this._createWeightsTransform(r);const o=this.getShaders("max-weights-transform"),s=new u.Z(t,{id:"".concat(this.id,"-max-weights-transform"),_sourceTextures:{inTexture:n},_targetTexture:i,_targetTextureVarying:"outTexture",...o,elementCount:e*e});this.setState({weightsTexture:n,maxWeightsTexture:i,maxWeightTransform:s,zoom:null,triPositionBuffer:new st.Z(t,{byteLength:48,accessor:{size:3}}),triTexCoordBuffer:new st.Z(t,{byteLength:48,accessor:{size:2}})})}updateShaders(t){this._createWeightsTransform(t)}_updateMaxWeightValue(){const{maxWeightTransform:t}=this.state;t.run({parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32776}})}_updateBounds(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{viewport:e}=this.context,n=[e.unproject([0,0]),e.unproject([e.width,0]),e.unproject([e.width,e.height]),e.unproject([0,e.height])].map((t=>t.map(Math.fround))),i=function(t){const e=t.map((t=>t[0])),n=t.map((t=>t[1])),i=Math.min.apply(null,e),r=Math.max.apply(null,e);return[i,Math.min.apply(null,n),r,Math.max.apply(null,n)]}(n),r={visibleWorldBounds:i,viewportCorners:n};let o=!1;if(t||!this.state.worldBounds||(s=this.state.worldBounds,!((a=i)[0]>=s[0]&&a[2]<=s[2]&&a[1]>=s[1]&&a[3]<=s[3]))){const t=this._worldToCommonBounds(i),e=this._commonToWorldBounds(t);this.props.coordinateSystem===Bt.Df.LNGLAT&&(e[1]=Math.max(e[1],-85.051129),e[3]=Math.min(e[3],85.051129),e[0]=Math.max(e[0],-360),e[2]=Math.min(e[2],360));const n=this._worldToCommonBounds(e);r.worldBounds=e,r.normalizedCommonBounds=n,o=!0}var s,a;return this.setState(r),o}_updateTextureRenderingBounds(){const{triPositionBuffer:t,triTexCoordBuffer:e,normalizedCommonBounds:n,viewportCorners:i}=this.state,{viewport:r}=this.context;t.subData(gn(i,3));const o=i.map((t=>function(t,e){const[n,i,r,o]=e;return[(t[0]-n)/(r-n),(t[1]-i)/(o-i)]}(r.projectPosition(t),n)));e.subData(gn(o,2))}_updateColorTexture(t){const{colorRange:e}=t.props;let{colorTexture:n}=this.state;const i=K(e,!1,Uint8Array);n?n.setImageData({data:i,width:e.length}):n=new R.Z(this.context.gl,{data:i,width:e.length,height:1,...yn}),this.setState({colorTexture:n})}_updateWeightmap(){const{radiusPixels:t,colorDomain:e,aggregation:n}=this.props,{weightsTransform:i,worldBounds:r,textureSize:o,weightsTexture:s,weightsScale:l}=this.state;this.state.isWeightMapDirty=!1;const c=this._worldToCommonBounds(r,{useLayerCoordinateSystem:!0});if(e&&"SUM"===n){const{viewport:t}=this.context,n=t.distanceScales.metersPerUnit[2]*(c[2]-c[0])/o;this.state.colorDomain=e.map((t=>t*n*l))}else this.state.colorDomain=e||vn;const u={radiusPixels:t,commonBounds:c,textureWidth:o,weightsScale:l};i.update({elementCount:this.getNumInstances()}),(0,a.s8)(this.context.gl,{clearColor:[0,0,0,0]},(()=>{i.run({uniforms:u,parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32774},clearRenderTarget:!0,attributes:this.getAttributes(),moduleSettings:this.getModuleSettings()})})),this._updateMaxWeightValue(),s.setParameters({10240:9729,10241:9729})}_debouncedUpdateWeightmap(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{updateTimer:e}=this.state;const{debounceTimeout:n}=this.props;t?(e=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(e),e=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:e})}_worldToCommonBounds(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{useLayerCoordinateSystem:n=!1}=e,[i,r,o,s]=t,{viewport:a}=this.context,{textureSize:l}=this.state,{coordinateSystem:c}=this.props,u=n&&(c===Bt.Df.LNGLAT_OFFSETS||c===Bt.Df.METER_OFFSETS),h=u?a.projectPosition(this.props.coordinateOrigin):[0,0],d=2*l/a.scale;let f,A;return n&&!u?(f=this.projectPosition([i,r,0]),A=this.projectPosition([o,s,0])):(f=a.projectPosition([i,r,0]),A=a.projectPosition([o,s,0])),function(t,e,n){const[i,r,o,s]=t,a=o-i,l=s-r;let c=a,u=l;a/l<e/n?c=e/n*l:u=n/e*a,c<e&&(c=e,u=n);const h=(o+i)/2,d=(s+r)/2;return[h-c/2,d-u/2,h+c/2,d+u/2]}([f[0]-h[0],f[1]-h[1],A[0]-h[0],A[1]-h[1]],d,d)}_commonToWorldBounds(t){const[e,n,i,r]=t,{viewport:o}=this.context,s=o.unprojectPosition([e,n]),a=o.unprojectPosition([i,r]);return s.slice(0,2).concat(a.slice(0,2))}}(0,i.Z)(Bn,"layerName","HeatmapLayer"),(0,i.Z)(Bn,"defaultProps",bn)},88766:(t,e,n)=>{"use strict";n.d(e,{Z:()=>Ge});var i=n(64649),r=n(79366),o=n(21970),s=n(97018);const a="{user}",l="{region}",c={V1:"v1",V2:"v2",V3:"v3"},u={[c.V1]:"https://".concat(a,".carto.com/api/v1/map"),[c.V2]:"https://maps-api-v2.".concat(l,".carto.com/user/").concat(a)},h={QUERY:"query",TABLE:"table",TILESET:"tileset",RASTER:"raster"},d=[h.QUERY,h.TABLE],f=[h.QUERY,h.TABLE],A={GEOJSON:"geojson",NDJSON:"ndjson",TILEJSON:"tilejson",JSON:"json"},p={MVT:"mvt",JSON:"json",GEOJSON:"geojson",BINARY:"binary"};let g;!function(t){t.Number="number",t.Bigint="bigint",t.String="string",t.Geometry="geometry",t.Timestamp="timestamp",t.Object="object",t.Boolean="boolean",t.Variant="variant",t.Unknown="unknown"}(g||(g={}));const m={DATA:"Map data",INSTANTIATION:"Map instantiation",PUBLIC_MAP:"Public map",TILE_STATS:"Tile stats"};function y(t,e){return"".concat(t,"=").concat(encodeURIComponent(e))}let v;!function(t){t.In="in",t.Between="between",t.ClosedOpen="closed_open",t.Time="time",t.StringSearch="stringSearch"}(v||(v={}));const _={apiKey:"default_public",region:"us",username:"public"},b={apiBaseUrl:"https://gcp-us-east1.api.carto.com"};let x={};function w(){return x}function C(t,e){let n="/v3/".concat(e);return t.endsWith("/")&&(n=n.substring(1)),"".concat(t).concat(n)}!function(t){let{apiVersion:e,...n}=t;switch(e=e||c.V3,e){case c.V1:case c.V2:x={apiVersion:e,..._,...n};break;case c.V3:x={apiVersion:e,...b,...n};break;default:throw new Error("Invalid API version ".concat(e,". Use API_VERSIONS enum."))}}({});const B="bigquery",E="carto",T=16,S=4096;async function M(t){let{type:e,source:n,credentials:i}=t;const r=w(),o=(null===i||void 0===i?void 0:i.apiVersion)||r.apiVersion,s={...o===c.V3?b:_,mapsUrl:u[o],...r.apiVersion===o&&r,...i};let a;const l=e===h.TILESET?B:E;switch(o){case c.V1:a=function(t){let{mapConfig:e,credentials:n}=t;const i=P(n),r=JSON.stringify(e);return"".concat(D(n),"?").concat(i.join("&"),"&").concat(y("config",r))}({mapConfig:{version:"1.3.1",buffersize:{mvt:T},layers:[{type:"mapnik",options:{sql:n,vector_extent:S}}]},credentials:s});return(await I({url:a,credentials:s})).metadata.tilejson.vector;case c.V2:return a=function(t){let{connection:e,type:n,source:i,credentials:r}=t;const o=P(r),s=n===h.QUERY?"sql":n;let a="".concat(D(r),"/").concat(e,"/").concat(s,"?");return a+="".concat(y("source",i),"&format=tilejson&").concat(o.join("&")),a}({connection:l,type:e,source:n,credentials:s}),await I({url:a,credentials:s});default:throw new Error("Invalid maps API version. It should be ".concat(c.V1," or ").concat(c.V2))}}async function I(t){let e,{url:n,credentials:i}=t;try{e=await fetch(n,{headers:{Accept:"application/json"}})}catch(o){throw new Error("Failed to connect to Maps API: ".concat(o))}const r=await e.json();return e.ok||function(t){let{response:e,json:n,credentials:i}=t;switch(e.status){case 401:throw new Error("Unauthorized access to Maps API: invalid combination of user ('".concat(i.username,"') and apiKey ('").concat(i.apiKey,"')"));case 403:throw new Error("Unauthorized access to dataset: the provided apiKey('".concat(i.apiKey,"') doesn't provide access to the requested data"));default:const t=i.apiVersion===c.V1?JSON.stringify(n.errors):n.error;throw new Error(t)}}({response:e,json:r,credentials:i}),r}function P(t){return[y("api_key",t.apiKey),y("client","deck-gl-carto")]}function D(t){return t.mapsUrl.replace(a,t.username).replace(l,t.region)}class F extends Error{constructor(t,e,n){let r="Failed to connect";n&&(r="Server returned: ",400===n.status?r+="Bad request":401===n.status||403===n.status?r+="Unauthorized access":404===n.status?r+="Not found":r+="Error",r+=" (".concat(n.status,"):")),r+=" ".concat(t.message||t);let o="".concat(e.requestType," API request failed");o+="\n".concat(r);for(const i of Object.keys(e))"requestType"!==i&&(o+="\n".concat(L(i),": ").concat(e[i]));o+="\n",super(o),(0,i.Z)(this,"error",void 0),(0,i.Z)(this,"errorContext",void 0),(0,i.Z)(this,"response",void 0),this.name="CartoAPIError",this.response=n,this.error=t,this.errorContext=e}}function L(t){return t.replace(/([A-Z])/g," $1").replace(/^./,(t=>t.toUpperCase()))}function O(t,e){o.Z.assert(t,e)}function R(t,e){return"https://unpkg.com/@deck.gl/carto@".concat(e,"/dist/").concat(t,"-worker.js")}const k=8192,U="deck-gl-carto",z="3.2";async function G(t){let{method:e,url:n,headers:i,accessToken:r,body:o,errorContext:s}=t;const a={...i,Accept:"application/json"};r&&(a.Authorization="Bearer ".concat(r)),"POST"===e&&(a["Content-Type"]="application/json");try{return await fetch(n,{method:e,headers:a,body:o})}catch(l){throw new F(l,s)}}async function N(t){let{method:e,url:n,headers:i,accessToken:r,body:o,errorContext:s}=t;const a=await G({method:e,url:n,headers:i,accessToken:r,body:o,errorContext:s});let l;try{l=await a.json()}catch(c){l={error:""}}if(!a.ok)throw new F(l.error,s,a);return l}async function Z(t){let{method:e,url:n,accessToken:i,format:r,body:o,errorContext:s}=t;if(r===A.NDJSON)return G({method:e,url:n,accessToken:i,body:o,errorContext:s});const a=await N({method:e,url:n,accessToken:i,body:o,errorContext:s});return a.rows?a.rows:a}async function j(t){let{type:e,source:n,connection:i,credentials:r,geoColumn:o,columns:s,clientId:a,headers:l,aggregationExp:c,aggregationResLevel:u,queryParameters:d,filters:f}=t;const A="".concat(r.mapsUrl,"/").concat(i,"/").concat(e),p=function(t){let{type:e,source:n,geoColumn:i,columns:r,clientId:o,aggregationExp:s,aggregationResLevel:a,queryParameters:l,filters:c}=t;const u={client:o||U,v:z};return u[e===h.QUERY?"q":"name"]=n,l&&(u.queryParameters=l),i&&(u.geo_column=i),r&&(u.columns=r.join(",")),s?u.aggregationExp=s:function(t){const e=null===t||void 0===t?void 0:t.split(":")[0];return"h3"===e||"quadbin"===e}(i)&&(u.aggregationExp="1 AS value"),a&&(u.aggregationResLevel=a),c&&(u.filters=c),u}({type:e,source:n,geoColumn:o,columns:s,clientId:a,aggregationResLevel:u,aggregationExp:c,queryParameters:d,filters:f}),g=Object.entries(p).map((t=>{let[e,n]=t;return"string"!==typeof n&&(n=JSON.stringify(n)),y(e,n)})),v="".concat(A,"?").concat(g.join("&")),{accessToken:_}=r,b={requestType:m.INSTANTIATION,connection:i,type:e,source:n};return v.length>k&&e===h.QUERY?await N({method:"POST",url:A,headers:l,accessToken:_,body:JSON.stringify(p),errorContext:b}):await N({url:v,headers:l,accessToken:_,errorContext:b})}function V(t,e){const n=t[e];return n&&!n.error&&n.url?n.url[0]:null}async function H(t){let{type:e,source:n,connection:i,credentials:r,geoColumn:s,columns:a,format:l,formatTiles:u,clientId:g,headers:m,aggregationExp:v,aggregationResLevel:_,queryParameters:b,filters:x}=t;const B=w(),E={...B.apiVersion===c.V3&&B,...r};!function(t){let{type:e,source:n,connection:i,credentials:r,geoColumn:o,columns:s,aggregationExp:a,aggregationResLevel:l,filters:u}=t;O(i,"Must define connection"),O(e,"Must define a type"),O(n,"Must define a source"),O(r.apiVersion===c.V3,"Method only available for v3"),O(r.apiBaseUrl,"Must define apiBaseUrl"),O(r.accessToken,"Must define an accessToken"),s&&O(d.includes(e),"The columns parameter is not supported by type ".concat(e)),o?O(f.includes(e),"The geoColumn parameter is not supported by type ".concat(e)):(O(!a,"Have aggregationExp, but geoColumn parameter is missing"),O(!l,"Have aggregationResLevel, but geoColumn parameter is missing")),u&&O(e===h.TABLE||e===h.QUERY,"The filters parameter is only supported by type table and query")}({type:e,source:n,connection:i,credentials:E,geoColumn:s,columns:a,aggregationExp:v,aggregationResLevel:_,filters:x}),E.mapsUrl||(E.mapsUrl=C(E.apiBaseUrl,"maps"));const T=await j({type:e,source:n,connection:i,credentials:E,geoColumn:s,columns:a,clientId:g,headers:m,aggregationExp:v,aggregationResLevel:_,queryParameters:b,filters:x});let S,M=null;if(l)S=l,M=V(T,l),O(M,"Format ".concat(l," not available"));else{const t=[A.GEOJSON,A.JSON,A.NDJSON,A.TILEJSON];for(const e of t)if(M=V(T,e),M){S=e;break}O(M&&S,"Unsupported data formats received from backend.")}l===A.TILEJSON&&u&&(o.Z.assert(Object.values(p).includes(u),"Invalid value for formatTiles: ".concat(u,". Use value from TILE_FORMATS")),M+="&".concat(y("formatTiles",u)));const{accessToken:I}=E;return{url:M,accessToken:I,mapFormat:S,metadata:T}}var J=n(94319),W=n(20905);function Q(t){return t}function K(t,e,n,i){return function t(r,o){if(o>=i.length)return n(r);const s=new W.L,a=i[o++];let l=-1;for(const e of r){const t=a(e,++l,r),n=s.get(t);n?n.push(e):s.set(t,[e])}for(const[e,n]of s)s.set(e,t(n,o));return e(s)}(t,0)}var q=n(47833);function X(t,e,n){return(2!==e.length?(0,q.ZP)(function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return K(t,Q,e,i)}(t,e,n),((t,e)=>{let[n,i]=t,[r,o]=e;return(0,J.Z)(i,o)||(0,J.Z)(n,r)})):(0,q.ZP)(function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return K(t,Q,Q,n)}(t,n),((t,n)=>{let[i,r]=t,[o,s]=n;return e(r,s)||(0,J.Z)(i,o)}))).map((t=>{let[e]=t;return e}))}var Y=n(88048),$=n(26379),tt=n(30730),et=(n(52017),n(13629)),nt=n(58458),it=n(95658),rt=n(82601),ot=n(8896);function st(){var t,e,n=(0,nt.Z)().unknown(void 0),i=n.domain,r=n.range,o=0,s=1,a=!1,l=0,c=0,u=.5;function h(){var n=i().length,h=s<o,d=h?s:o,f=h?o:s;t=(f-d)/Math.max(1,n-l+2*c),a&&(t=Math.floor(t)),d+=(f-d-t*(n-l))*u,e=t*(1-l),a&&(d=Math.round(d),e=Math.round(e));var A=(0,rt.Z)(n).map((function(e){return d+t*e}));return r(h?A.reverse():A)}return delete n.unknown,n.domain=function(t){return arguments.length?(i(t),h()):i()},n.range=function(t){return arguments.length?([o,s]=t,o=+o,s=+s,h()):[o,s]},n.rangeRound=function(t){return[o,s]=t,o=+o,s=+s,a=!0,h()},n.bandwidth=function(){return e},n.step=function(){return t},n.round=function(t){return arguments.length?(a=!!t,h()):a},n.padding=function(t){return arguments.length?(l=Math.min(1,c=+t),h()):l},n.paddingInner=function(t){return arguments.length?(l=Math.min(1,t),h()):l},n.paddingOuter=function(t){return arguments.length?(c=+t,h()):c},n.align=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),h()):u},n.copy=function(){return st(i(),[o,s]).round(a).paddingInner(l).paddingOuter(c).align(u)},ot.o.apply(h(),arguments)}function at(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return at(e())},t}var lt=n(79978),ct=n(90983),ut=n(66042),ht=n(87758),dt=n(86425),ft=n(55842),At=n.n(ft),pt=n(19754),gt=n(25880),mt=n.n(gt);function yt(t,e,n){const i=2===e.type?e.readVarint()+e.pos:e.pos+1;return n.value=new t(e.buf.buffer.slice(e.pos,i)),e.pos=i,n.value}class vt{static read(t,e){return t.readFields(vt._readField,{key:"",value:null},e)}static _readField(t,e,n){1===t?e.key=n.readString():2===t&&(e.value=n.readString())}}class _t{static read(t,e){return t.readFields(_t._readField,{},e)}static _readField(t,e,n){if(1===t){const{key:t,value:i}=vt.read(n,n.readVarint()+n.pos);e[t]=i}}}class bt{static read(t,e){const{value:n,size:i}=t.readFields(bt._readField,{value:[],size:0},e);return{value:new Float32Array(n),size:i}}static _readField(t,e,n){1===t?yt(Float64Array,n,e):2===t&&(e.size=n.readVarint(!0))}}class xt{static read(t,e){const{value:n,size:i}=t.readFields(xt._readField,{value:[],size:0},e);return{value:new Uint32Array(n),size:i}}static _readField(t,e,n){1===t?n.readPackedVarint(e.value):2===t&&(e.size=n.readVarint(!0))}}class wt{static read(t,e){return t.readFields(wt._readField,{id:0},e)}static _readField(t,e,n){1===t&&(e.id=n.readVarint())}}class Ct{static read(t,e){return t.readFields(Ct._readField,{value:[]},e)}static _readField(t,e,n){1===t&&yt(Float64Array,n,e)}}class Bt{static read(t,e){return t.readFields(Bt._readField,{key:"",value:null},e)}static _readField(t,e,n){1===t?e.key=n.readString():2===t&&(e.value=Ct.read(n,n.readVarint()+n.pos))}}class Et{static read(t,e){return t.readFields(Et._readField,{positions:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},e)}static _readField(t,e,n){if(1===t)e.positions=bt.read(n,n.readVarint()+n.pos);else if(2===t)e.globalFeatureIds=xt.read(n,n.readVarint()+n.pos);else if(3===t)e.featureIds=xt.read(n,n.readVarint()+n.pos);else if(4===t)e.properties.push(_t.read(n,n.readVarint()+n.pos));else if(5===t){const t=Bt.read(n,n.readVarint()+n.pos);e.numericProps[t.key]=t.value}else 6===t&&e.fields.push(wt.read(n,n.readVarint()+n.pos))}}class Tt{static read(t,e){return t.readFields(Tt._readField,{positions:null,pathIndices:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},e)}static _readField(t,e,n){if(1===t)e.positions=bt.read(n,n.readVarint()+n.pos);else if(2===t)e.pathIndices=xt.read(n,n.readVarint()+n.pos);else if(3===t)e.globalFeatureIds=xt.read(n,n.readVarint()+n.pos);else if(4===t)e.featureIds=xt.read(n,n.readVarint()+n.pos);else if(5===t)e.properties.push(_t.read(n,n.readVarint()+n.pos));else if(6===t){const t=Bt.read(n,n.readVarint()+n.pos);e.numericProps[t.key]=t.value}else 7===t&&e.fields.push(wt.read(n,n.readVarint()+n.pos))}}class St{static read(t,e){return t.readFields(St._readField,{positions:null,polygonIndices:null,globalFeatureIds:null,featureIds:null,primitivePolygonIndices:null,triangles:null,properties:[],numericProps:{},fields:[]},e)}static _readField(t,e,n){if(1===t)e.positions=bt.read(n,n.readVarint()+n.pos);else if(2===t)e.polygonIndices=xt.read(n,n.readVarint()+n.pos);else if(3===t)e.globalFeatureIds=xt.read(n,n.readVarint()+n.pos);else if(4===t)e.featureIds=xt.read(n,n.readVarint()+n.pos);else if(5===t)e.primitivePolygonIndices=xt.read(n,n.readVarint()+n.pos);else if(6===t)e.triangles=xt.read(n,n.readVarint()+n.pos);else if(7===t)e.properties.push(_t.read(n,n.readVarint()+n.pos));else if(8===t){const t=Bt.read(n,n.readVarint()+n.pos);e.numericProps[t.key]=t.value}else 9===t&&e.fields.push(wt.read(n,n.readVarint()+n.pos))}}class Mt{static read(t,e){return t.readFields(Mt._readField,{points:null,lines:null,polygons:null},e)}static _readField(t,e,n){1===t?e.points=Et.read(n,n.readVarint()+n.pos):2===t?e.lines=Tt.read(n,n.readVarint()+n.pos):3===t&&(e.polygons=St.read(n,n.readVarint()+n.pos))}}var It=n(32408),Pt=n.n(It);function Dt(t,e){const n=new(Pt())(t);return e.read(n)}const Ft="8.9.36",Lt="cartoVectorTile";function Ot(t,e,n){let{startPosition:i,endPosition:r,indices:o}=n;const s=t.positions.size,a=i*s,l=r*s,c=t.positions.value.subarray(a,l),u=o.slice(1).map((t=>t-i)),h=mt()(c,u,s);for(let d=0,f=h.length;d<f;++d)e.push(i+h[d])}function Rt(t,e){if(!t)return null;const n=Dt(t,Mt);return n.polygons&&!n.polygons.triangles&&function(t){const{polygonIndices:e,positions:n,primitivePolygonIndices:i}=t,r=[];let o=0;for(let s=0;s<e.value.length-1;s++){const n=e.value[s],a=e.value[s+1],l=i.value.indexOf(a),c=i.value.subarray(o,l);o=l,Ot(t,r,{startPosition:n,endPosition:a,indices:c})}t.triangles={value:new Uint32Array(r),size:1}}(n.polygons),n}const kt={name:"CARTO Vector Tile",version:Ft,id:Lt,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-vector-tile"],category:"geometry",parse:async(t,e)=>Rt(t,e),parseSync:Rt,worker:!0,options:{cartoVectorTile:{workerUrl:R(Lt,Ft)}}};var Ut=n(46257),zt=n(7623),Gt=n(43610),Nt=n(10625);(0,pt.fh)([kt]);const Zt=p.BINARY,jt={...s.Z.defaultProps,formatTiles:Zt};class Vt extends s.Z{initializeState(){super.initializeState();const t=this.props.formatTiles===p.BINARY;this.setState({binary:t})}getTileData(t){const e=(0,zt.z0)(this.state.data,t);if(!e)return Promise.reject("Invalid URL");const n=this.getLoadOptions(),{fetch:i}=this.props,{signal:r}=t;return i(e,{propName:"data",layer:this,loadOptions:n,signal:r})}renderSubLayers(t){if(null===t.data)return null;const e=t.tile.bbox,{west:n,south:i,east:r,north:o}=e,s={...t,autoHighlight:!1,extensions:[new Ut.Z,...t.extensions||[]],clipBounds:[n,i,r,o]};return new Gt.Z(s)}getPickingInfo(t){const e=super.getPickingInfo(t);if(this.state.binary&&-1!==e.index){const{data:n}=t.sourceLayer.props;e.object=(0,Nt.F_)(n,{globalFeatureId:e.index})}return e}}(0,i.Z)(Vt,"layerName","CartoTileLayer"),(0,i.Z)(Vt,"defaultProps",jt);var Ht=n(9839),Jt=n(95512),Wt=n(73356);function Qt(t,e){let{west:n,north:i,east:r,south:o}=t;const s=Math.abs(r-n);if(s>180){const t=Math.ceil(s/180);let a=[];for(let s=0;s<t;s++){const t=r+180*s,l=Math.min(t+179.9999999,n);a=a.concat(Qt({west:l,north:i,east:t,south:o},e))}return[...new Set(a)]}const a=(0,Wt.OK)([[[n,i],[n,o],[r,o],[r,i],[n,i]]],e+2,!0);return[...new Set(a.map((t=>(0,Wt.jV)(t,e))))]}function Kt(t){const e=(0,Wt.Lg)(t),n=e.map((t=>t[0])),i=e.map((t=>t[1]));return{west:Math.min(...i),south:Math.min(...n),east:Math.max(...i),north:Math.max(...n)}}function qt(t){const e=2/3*t.zoom,n=Math.log(1/Math.cos(Math.PI*t.latitude/180));return Math.max(0,Math.floor(e+n-2))}class Xt extends Jt.Be{getTileIndices(t){let{viewport:e,minZoom:n,maxZoom:i}=t;if(void 0===e.latitude)return[];const[r,o,s,a]=e.getBounds();let l,c=qt(e);if("number"===typeof n&&Number.isFinite(n)&&c<n)return[];if("number"===typeof i&&Number.isFinite(i)&&c>i){c=i;const t=(0,Wt.Cx)(e.latitude,e.longitude,i);l=(0,Wt.b3)(t,1)}else l=Qt({west:s,north:a,east:r,south:o},c);return l.map((t=>({i:t})))}getTileId(t){let{i:e}=t;return e}getTileMetadata(t){let{i:e}=t;return{bbox:Kt(e)}}getTileZoom(t){let{i:e}=t;return(0,Wt.AI)(e)}getParentIndex(t){const e=(0,Wt.AI)(t.i);return{i:(0,Wt.jV)(t.i,e-1)}}}const Yt={uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:BigUint64Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class $t{static read(t,e){return t.readFields($t._readField,{name:"",type:"",data:null},e)}static _readField(t,e,n){if(1===t)e.name=n.readString();else if(2===t)e.type=n.readString();else if(3===t){const t=Yt[e.type];if(!t)throw Error("Invalid data type: ".concat(e.type));e.data={},yt(t,n,e.data)}}}class te{static read(t,e){return t.readFields(te._readField,{blockWidth:0,blockHeight:0,bands:[]},e)}static _readField(t,e,n){1===t?e.blockWidth=n.readVarint():2===t?e.blockHeight=n.readVarint():3===t&&e.bands.push($t.read(n,n.readVarint()+n.pos))}}const ee="8.9.36",ne="cartoRasterTile";function ie(t,e){if(!t)return null;const n=Dt(t,te),{bands:i,blockHeight:r,blockWidth:o}=n,s={};for(let a=0;a<i.length;a++){const{name:t,data:e}=i[a];s[t]=e}return{blockWidth:o,blockHeight:r,cells:{numericProps:s,properties:[]}}}const re={name:"CARTO Raster Tile",version:ee,id:ne,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-raster-tile"],category:"geometry",parse:async(t,e)=>ie(t,e),parseSync:ie,worker:!0,options:{cartoRasterTile:{workerUrl:R(ne,ee)}}};class oe{static read(t,e){return t.readFields(oe._readField,{value:[]},e)}static _readField(t,e,n){1===t&&yt(BigUint64Array,n,e)}}class se{static read(t,e){return t.readFields(se._readField,{indices:null,properties:[],numericProps:{}},e)}static _readField(t,e,n){if(1===t)e.indices=oe.read(n,n.readVarint()+n.pos);else if(2===t)e.properties.push(_t.read(n,n.readVarint()+n.pos));else if(3===t){const t=Bt.read(n,n.readVarint()+n.pos);e.numericProps[t.key]=t.value}}}class ae{static read(t,e){return t.readFields(ae._readField,{scheme:0,cells:null},e)}static _readField(t,e,n){1===t?e.scheme=n.readVarint():2===t&&(e.cells=se.read(n,n.readVarint()+n.pos))}}n(80097);const le=[0x5555555555555555n,0x3333333333333333n,0x0f0f0f0f0f0f0f0fn,0x00ff00ff00ff00ffn,0x0000ffff0000ffffn,0x00000000ffffffffn],ce=[0n,1n,2n,4n,8n,16n];function ue(t){return t.toString(16)}function he(t){if(t.z<0||t.z>26)throw new Error("Wrong zoom");const e=BigInt(t.z);let n=BigInt(t.x)<<32n-e,i=BigInt(t.y)<<32n-e;for(let r=0;r<5;r++){const t=ce[5-r],e=le[4-r];n=(n|n<<t)&e,i=(i|i<<t)&e}return 5188146770730811392n|e<<52n|(n|i<<1n)>>12n|0xfffffffffffffn>>2n*e}function de(t){const e=t>>52n&0x1fn,n=(0xfffffffffffffn&t)<<12n;if(1n!==(t>>59n&7n)&&0n!==(t>>57n&3n))throw new Error("Wrong mode");let i=n,r=n>>1n;for(let o=0;o<6;o++){const t=ce[o],e=le[o];i=(i|i>>t)&e,r=(r|r>>t)&e}return i>>=32n-e,r>>=32n-e,{z:Number(e),x:Number(i),y:Number(r)}}function fe(t){return t>>52n&0x1fn}function Ae(t){const e=fe(t)-1n;return t&~(0x1fn<<52n)|e<<52n|0xfffffffffffffn>>2n*e}const pe="8.9.36",ge="cartoSpatialTile";function me(t,e){var n;if(!t)return null;const i=Dt(t,ae),{cells:r}=i;return function(t){const{cells:e,scheme:n}=t,i=e.indices.value.length,r=[];for(let o=0;o<i;o++){const t="h3"===n?ue(e.indices.value[o]):e.indices.value[o],i={...e.properties[o]};for(const n of Object.keys(e.numericProps))i[n]=e.numericProps[n].value[o];r.push({id:t,properties:i})}return r}({cells:r,scheme:null===e||void 0===e||null===(n=e.cartoSpatialTile)||void 0===n?void 0:n.scheme})}const ye={name:"CARTO Spatial Tile",version:pe,id:ge,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-spatial-tile"],category:"geometry",parse:async(t,e)=>me(t,e),parseSync:me,worker:!0,options:{cartoSpatialTile:{scheme:"quadbin",workerUrl:R(ge,pe)}}};var ve=n(58062);(0,pt.fh)([re,ye]);class _e extends ve.Z{constructor(){super(...arguments),(0,i.Z)(this,"state",void 0)}updateState(t){const{props:e,oldProps:n}=t;e.aggregationResLevel!==n.aggregationResLevel&&this.setState({tileset:null}),super.updateState(t)}_updateAutoHighlight(t){const{hoveredFeatureId:e}=this.state,n=t.object;let i=null;if(n&&(i=n.id),e!==i){let{highlightColor:e}=this.props;"function"===typeof e&&(e=e(t)),this.setState({highlightColor:e,hoveredFeatureId:i})}}getSubLayerPropsByTile(t){return{highlightedObjectIndex:this.getHighlightedObjectIndex(t),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(t){const{hoveredFeatureId:e}=this.state,n=t.content;var i;return void 0!==(i=e)&&null!==i&&""!==i&&Array.isArray(n)&&this._featureInTile(t,e)?n.findIndex((t=>t.id===e)):-1}_featureInTile(t,e){const n=this.state.tileset,i=n.getTileZoom(t.index),r=t.index.q?"q":"i";let o={[r]:e},s=n.getTileZoom(o);for(;!(s<=i);)o=n.getParentIndex(o),s=n.getTileZoom(o);return o[r]===t.index[r]}}(0,i.Z)(_e,"layerName","SpatialIndexTileLayer"),(0,i.Z)(_e,"defaultProps",{aggregationResLevel:4});const be=t=>{const{data:e}=t,{index:n}=t.tile;return e&&e.length?new Ht.ZP(t,{getHexagon:t=>t.id,centerHexagon:n,highPrecision:!0}):null};class xe extends r.Z{constructor(){super(...arguments),(0,i.Z)(this,"state",void 0)}initializeState(){Ht.ZP._checkH3Lib(),this.setState({data:null,tileJSON:null})}updateState(t){let{changeFlags:e}=t;if(e.dataChanged){let{data:t}=this.props;const e=t;t=e.tiles,this.setState({data:t,tileJSON:e})}}renderLayers(){const{data:t,tileJSON:e}=this.state;let n=parseInt(e.minresolution),i=parseInt(e.maxresolution);return this.props.minZoom&&(n=Math.max(n,qt({zoom:this.props.minZoom,latitude:0}))),this.props.maxZoom&&(i=Math.min(i,qt({zoom:this.props.maxZoom,latitude:0}))),[new _e(this.props,{id:"h3-tile-layer-".concat(this.props.id),data:t,TilesetClass:Xt,renderSubLayers:be,minZoom:n,maxZoom:i,loadOptions:{...this.getLoadOptions(),cartoSpatialTile:{scheme:"h3"}}})]}}(0,i.Z)(xe,"layerName","H3TileLayer"),(0,i.Z)(xe,"defaultProps",{aggregationResLevel:4});var we=n(17634),Ce=n(75818);const Be=512;function Ee(t){const{x:e,y:n,z:i}=de(t),r=Be/(1<<i);return[e*r,Be-n*r,r]}function Te(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const[n,i]=function(t,e){const[n,i,r]=Ee(t);return[[n,i],[n+e*r,i-e*r]]}(t,e),[r,o]=(0,Ce.es)(n),[s,a]=(0,Ce.es)(i);return[s,o,s,a,r,a,r,o,s,o]}class Se extends we.Z{indexToBounds(){const{data:t,extruded:e,getQuadbin:n}=this.props,i=e?.99:1;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(t,e)=>Te(n(t,e),i),updateTriggers:{getPolygon:i}}}}(0,i.Z)(Se,"layerName","QuadbinLayer"),(0,i.Z)(Se,"defaultProps",{getQuadbin:{type:"accessor",value:t=>t.quadbin}});class Me extends Jt.Be{getTileIndices(t){return super.getTileIndices(t).map(he).map((t=>({q:t,i:ue(t)})))}getTileId(t){let{q:e,i:n}=t;return n||ue(e)}getTileMetadata(t){let{q:e}=t;return super.getTileMetadata(de(e))}getTileZoom(t){let{q:e}=t;return Number(fe(e))}getParentIndex(t){let{q:e}=t;return{q:Ae(e)}}}const Ie=t=>{const{data:e}=t;if(!e||!e.length)return null;const n="bigint"===typeof e[0].id;return new Se(t,{getQuadbin:n?t=>t.id:t=>{return e=t.id,BigInt("0x".concat(e));var e}})};class Pe extends r.Z{constructor(){super(...arguments),(0,i.Z)(this,"state",void 0)}initializeState(){this.setState({data:null,tileJSON:null})}updateState(t){let{changeFlags:e}=t;if(e.dataChanged){let{data:t}=this.props;const e=t;t=e.tiles,this.setState({data:t,tileJSON:e})}}renderLayers(){const{data:t,tileJSON:e}=this.state,n=parseInt(null===e||void 0===e?void 0:e.maxresolution);return[new _e(this.props,{id:"quadbin-tile-layer-".concat(this.props.id),data:t,TilesetClass:Me,renderSubLayers:Ie,maxZoom:n,loadOptions:{...this.getLoadOptions(),cartoSpatialTile:{scheme:"quadbin"}}})]}}(0,i.Z)(Pe,"layerName","QuadbinTileLayer"),(0,i.Z)(Pe,"defaultProps",{aggregationResLevel:6});var De=n(35387);const Fe={...De.Z.defaultProps,extruded:!1,diskResolution:4,vertices:[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]};class Le extends De.Z{getShaders(){return{...super.getShaders(),vs:"#version 300 es\n#define SHADER_NAME raster-layer-vertex-shader\n\nin vec3 positions;\nin vec3 normals;\n\nin float instanceElevations;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\n\nin vec3 instancePickingColors;\nuniform float opacity;\nuniform bool extruded;\nuniform bool stroked;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float widthScale;\nuniform vec3 offset;\nout vec4 vColor;\n#ifdef FLAT_SHADING\nout vec4 position_commonspace;\n#endif\n\nvoid main(void) {\n  vec2 common_position = offset.xy;\n  float scale = offset.z;\n\n  int yIndex = - (gl_InstanceID / 256);\n  int xIndex = gl_InstanceID + (yIndex * 256);\n  common_position += scale * vec2(float(xIndex), float(yIndex));\n\n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float cellWidth = coverage * scale;\n  geometry.position = vec4(common_position, 0.0, 1.0);\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    geometry.position.xyz -= project_uCommonOrigin;\n  }\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (stroked) {\n    float halfOffset = project_pixel_size(widthScale) / cellWidth;\n    if (isStroke) {\n      strokeOffsetRatio -= sign(positions.z) * halfOffset;\n    } else {\n      strokeOffsetRatio -= halfOffset;\n    }\n  }\n\n  geometry.pickingColor = instancePickingColors;\n  vec2 offset = (vec2(0.5) + positions.xy * strokeOffsetRatio) * cellWidth * shouldRender;\n  vec3 pos = vec3(offset, project_size(elevation));\n  DECKGL_FILTER_SIZE(pos, geometry);\n\n  geometry.position.xyz += pos;\n  gl_Position = project_common_position_to_clipspace(geometry.position);\n\n  geometry.normal = project_normal(normals);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  if (extruded && !isStroke) {\n#ifdef FLAT_SHADING\n    position_commonspace = geometry.position;\n    vColor = vec4(color.rgb, color.a * opacity);\n#else\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n    vColor = vec4(lightColor, color.a * opacity);\n#endif\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity);\n  }\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n"}}initializeState(){this.getAttributeManager().addInstanced({instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:[255,255,255,255]}})}}(0,i.Z)(Le,"layerName","RasterColumnLayer");class Oe extends r.Z{renderLayers(){const{data:t,getElevation:e,getFillColor:n,getLineColor:i,getLineWidth:r,tileIndex:o,updateTriggers:s}=this.props;if(!t||!o)return null;const{blockWidth:a,blockHeight:l}=t;O(a===l,"blockWidth (".concat(a,") must equal blockHeight (").concat(l,")"));const[c,u,h]=Ee(o),d=[c,u,h/a];return new(this.getSubLayerClass("column",Le))(this.props,this.getSubLayerProps({id:"cell",updateTriggers:s,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(n),getLineColor:this.getSubLayerAccessor(i),getLineWidth:this.getSubLayerAccessor(r)}),{data:{data:t,length:a*l},offset:d})}getSubLayerAccessor(t){return"function"!==typeof t?super.getSubLayerAccessor(t):(e,n)=>{const{data:i,index:r}=n,o=function(t,e){const{properties:n,numericProps:i}=t;return new Proxy(n[e]||{},{get:(t,n,r)=>n in i?i[n].value[e]:t[n],has:(t,e)=>e in i||e in t})}(i.data.cells,r);return t({properties:o},n)}}}(0,i.Z)(Oe,"layerName","RasterLayer"),(0,i.Z)(Oe,"defaultProps",Fe);const Re=t=>{var e,n;const i=null===(e=t.tile)||void 0===e||null===(n=e.index)||void 0===n?void 0:n.q;return i?new Oe(t,{tileIndex:i}):null};class ke extends r.Z{constructor(){super(...arguments),(0,i.Z)(this,"state",void 0)}initializeState(){this.setState({data:null,tileJSON:null})}updateState(t){let{changeFlags:e}=t;if(e.dataChanged){let{data:t}=this.props;const e=t;t=e.tiles,this.setState({data:t,tileJSON:e})}}renderLayers(){const{data:t,tileJSON:e}=this.state,n=parseInt(null===e||void 0===e?void 0:e.minzoom),i=parseInt(null===e||void 0===e?void 0:e.maxzoom);return[new _e(this.props,{id:"raster-tile-layer-".concat(this.props.id),data:t,TilesetClass:Me,renderSubLayers:Re,minZoom:n,maxZoom:i})]}}(0,i.Z)(ke,"layerName","RasterTileLayer"),(0,i.Z)(ke,"defaultProps",{});et.Z,nt.Z,it.Z,lt.Z,ct.Z,ut._b,ht.Z;Y.Z,$.Z,tt.Z;function Ue(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.MVT,e=arguments.length>1?arguments[1]:void 0;return"raster"===(arguments.length>2?arguments[2]:void 0)?ke:"h3"===e?xe:"quadbin"===e?Pe:"mvt"===t?s.Z:Vt}(0,dt.WU)("i"),(0,dt.WU)(".5f");const ze={data:null,type:null,onDataLoad:{type:"function",value:t=>{}},onDataError:{type:"function",value:null,optional:!0},uniqueIdProperty:"cartodb_id",credentials:null,connection:null,format:null,formatTiles:null,clientId:null,geoColumn:null,columns:{type:"array",value:null},headers:{type:"object",value:{},optional:!0},aggregationExp:null,aggregationResLevel:null,queryParameters:null};class Ge extends r.Z{initializeState(){this.state={data:null,apiVersion:null}}get isLoaded(){return this.getSubLayers().length>0&&super.isLoaded}_checkProps(t){const{type:e,credentials:n,connection:i,geoColumn:r,columns:s}=t,a={...w(),...n},{apiVersion:l}=a;o.Z.assert(Object.values(c).includes(l),"Invalid apiVersion ".concat(l,". Use API_VERSIONS enum.")),l===c.V1||l===c.V2?(o.Z.assert(e===h.QUERY||e===h.TILESET,"Invalid type ".concat(e,". Use type MAP_TYPES.QUERY or MAP_TYPES.TILESET for apiVersion ").concat(l)),o.Z.assert(!i,"Connection prop is not supported for apiVersion ".concat(l)),o.Z.assert(!r,"geoColumn prop is not supported for apiVersion ".concat(l)),o.Z.assert(!s,"columns prop is not supported for apiVersion ".concat(l))):l===c.V3&&(o.Z.assert(i,"Missing mandatory connection parameter"),o.Z.assert(Object.values(h).includes(e),"Invalid type ".concat(e,". Use MAP_TYPES enum.")),d.includes(e)||o.Z.assert(!s,"columns prop is only supported for types: ".concat(d.join())),f.includes(e)||o.Z.assert(!r,"geoColumn prop is only supported for types: ".concat(f.join())),s&&o.Z.assert(Array.isArray(s),"columns prop must be an Array"))}updateState(t){let{props:e,oldProps:n,changeFlags:i}=t;this._checkProps(e);(i.dataChanged||e.aggregationExp!==n.aggregationExp||e.aggregationResLevel!==n.aggregationResLevel||e.connection!==n.connection||e.geoColumn!==n.geoColumn||e.formatTiles!==n.formatTiles||e.type!==n.type||JSON.stringify(e.columns)!==JSON.stringify(n.columns)||JSON.stringify(e.credentials)!==JSON.stringify(n.credentials)||JSON.stringify(e.queryParameters)!==JSON.stringify(n.queryParameters))&&(this.setState({data:null,apiVersion:null}),this._updateData())}async _updateData(){try{var t,e;const{type:n,data:i,credentials:r,connection:o,...s}=this.props,a={...w(),...r},{apiVersion:l}=a;let u;u=l===c.V1||l===c.V2?{data:await M({type:n,source:i,credentials:r})}:await async function(t){let{type:e,source:n,connection:i,credentials:r,geoColumn:o,columns:s,format:a,formatTiles:l,clientId:c,headers:u,aggregationExp:h,aggregationResLevel:d,queryParameters:f,filters:A}=t;const{url:p,accessToken:g,mapFormat:y,metadata:v}=await H({type:e,source:n,connection:i,credentials:r,geoColumn:o,columns:s,format:a,formatTiles:l,clientId:c,headers:u,aggregationExp:h,aggregationResLevel:d,queryParameters:f,filters:A}),_={requestType:m.DATA,connection:i,type:e,source:n};return{data:await Z({url:p,format:y,accessToken:g,errorContext:_}),format:y,schema:v.schema}}({type:n,source:i,credentials:r,connection:o,...s,format:A.TILEJSON}),this.setState({...u,apiVersion:l}),null===(t=(e=this.props).onDataLoad)||void 0===t||t.call(e,u.data,{propName:"data",layer:this})}catch(n){if(!this.props.onDataError)throw n;this.props.onDataError(n)}}_getSubLayerAndProps(){O(this.state);const{data:t,apiVersion:e}=this.state,{uniqueIdProperty:n}=ze,{data:i,...r}=this.props,o={uniqueIdProperty:n,...r};if(e===c.V1||e===c.V2)return[s.Z,o];const a=new URL(t.tiles[0]);return o.formatTiles=o.formatTiles||a.searchParams.get("formatTiles"),[Ue(o.formatTiles,t.scheme,o.type),o]}renderLayers(){O(this.state);const{apiVersion:t,data:e}=this.state;if(!e)return null;const{credentials:n,updateTriggers:i}=this.props,r=this.getLoadOptions()||{};if(t===c.V3){var o;const t={...w(),...n},{accessToken:e}=t;r.fetch={...r.fetch,headers:{...null===(o=r.fetch)||void 0===o?void 0:o.headers,Authorization:"Bearer ".concat(e)}}}const[s,a]=this._getSubLayerAndProps();return new s(a,this.getSubLayerProps({id:"carto-".concat(s.layerName),data:e,loadOptions:r,updateTriggers:i}))}}(0,i.Z)(Ge,"layerName","CartoLayer"),(0,i.Z)(Ge,"defaultProps",ze)},699:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var i=n(87758),r=n(77481),o=n(83380);function s(t){let{attr:e,domain:n,colors:s=r.LD,nullColor:a=r.PX}=t;(0,o.h)(Array.isArray(n),'Expected "domain" to be an array of numbers');const l="string"===typeof s?(0,r.ZP)(s,n.length+1):s,c=(0,i.Z)().domain(n).range(l);return t=>{const n=(0,o.g)(e,t);return"number"===typeof n&&Number.isFinite(n)?c(n):a}}},96260:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var i=n(77481),r=n(83380);function o(t){let{attr:e,domain:n,colors:o=i.LD,nullColor:s=i.PX,othersColor:a=i.LW}=t;(0,r.h)(Array.isArray(n),'Expected "domain" to be an array of numbers or strings');const l={},c="string"===typeof o?(0,i.ZP)(o,n.length):o;for(const[i,r]of n.entries())l[r]=c[i];return t=>{const n=(0,r.g)(e,t);return"number"===typeof n&&Number.isFinite(n)||"string"===typeof n?l[n]||a:s}}},24002:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var i=n(13629),r=n(77481),o=n(83380);function s(t){let{attr:e,domain:n,colors:s=r.LD,nullColor:a=r.PX}=t;(0,o.h)(Array.isArray(n),'Expected "domain" to be an array of numbers');const l="string"===typeof s?(0,r.ZP)(s,n.length):s,c=(0,i.Z)().domain(n).range(l);return t=>{const n=(0,o.g)(e,t);return"number"===typeof n&&Number.isFinite(n)?c(n):a}}},77481:(t,e,n)=>{"use strict";n.d(e,{LD:()=>o,LW:()=>a,PX:()=>s,ZP:()=>l});var i=n(79354),r=n(83380);const o="PurpOr",s=[204,204,204],a=[119,119,119];function l(t,e){const n=i[t];let o=e;(0,r.h)(n,'Palette "'.concat(t,'" not found. Expected a CARTOColors string'));const s=Object.keys(n).filter((t=>"tags"!==t)).map(Number),a=Math.max(...s),l=Math.min(...s);!Number.isInteger(e)||e>a?o=a:e<l&&(o=l);let c=n[o];return n.tags&&n.tags.includes("qualitative")&&(c=c.slice(0,-1)),c.map((t=>function(t){let e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(t);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),255];if(e=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(t),e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),parseInt(e[4]+e[4],16)];if(e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),e)return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),255];return e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),(0,r.h)(e,'Hexadecimal color "'.concat(t,'" was not parsed correctly')),[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),parseInt(e[4],16)]}(t)))}},83380:(t,e,n)=>{"use strict";n.d(e,{g:()=>r,h:()=>o});const i=Object.freeze(["function","string"]);function r(t,e){var n;return o("object"===typeof e,'Expected "data" to be an object'),o(i.includes(typeof t),'Expected "attr" to be a function or string'),"function"===typeof t?t(e):null===e||void 0===e||null===(n=e.properties)||void 0===n?void 0:n[t]}function o(t){if(!t)throw new Error("CARTO style error: ".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:""))}},23427:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s,z:()=>o});var i=n(21970);let r={};function o(t){r=t}function s(t,e,n,o){i.Z.level>0&&r[t]&&r[t].call(null,e,n,o)}},96684:(t,e,n)=>{"use strict";n.d(e,{Z:()=>D});var i=n(64649),r=n(12308),o=n(70353),s=n(33839);class a{constructor(t,e){(0,i.Z)(this,"opts",void 0),(0,i.Z)(this,"source",void 0),this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:n}=this.source,{size:i}=e;let r=n;if(n&&n.length!==i){r=new Float32Array(i);const t=e.elementOffset||0;for(let e=0;e<i;++e)r[e]=n[t+e]}return r}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}var l=n(28321),c=n(64441),u=n(21970);function h(t){return t.stride||t.size*t.bytesPerElement}function d(t,e){e.offset&&u.Z.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=h(t),i=(void 0!==e.vertexOffset?e.vertexOffset:t.vertexOffset||0)*n+(e.elementOffset||0)*t.bytesPerElement+(t.offset||0);return{...e,offset:i,stride:n}}class f{constructor(t,e,n){(0,i.Z)(this,"gl",void 0),(0,i.Z)(this,"id",void 0),(0,i.Z)(this,"size",void 0),(0,i.Z)(this,"settings",void 0),(0,i.Z)(this,"value",void 0),(0,i.Z)(this,"doublePrecision",void 0),(0,i.Z)(this,"_buffer",void 0),(0,i.Z)(this,"state",void 0),this.gl=t,this.id=e.id||"",this.size=e.size||1;const s=e.logicalType||e.type,a=5130===s;let l,{defaultValue:c}=e;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0),l=a?5126:!s&&e.isIndexed?t&&(0,r.U6)(t,o.h.ELEMENT_INDEX_UINT32)?5125:5123:s||5126;let u=function(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}(s||l||5126);this.doublePrecision=a,a&&!1===e.fp64&&(u=Float32Array),this.value=null,this.settings={...e,defaultType:u,defaultValue:c,logicalType:s,type:l,size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new s.Z(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*h(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),l.Z.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const n={},i=this.value instanceof Float64Array,r=function(t,e){const n=d(t,e);return{high:n,low:{...n,offset:n.offset+4*t.size}}}(this.getAccessor(),e||{});return n[t]=new a(this,r.high),n["".concat(t,"64Low")]=i?new a(this,r.low):new Float32Array(this.size),n}if(e){const n=d(this.getAccessor(),e);return{[t]:new a(this,n)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:n,size:i}=this,r=n*i;if(e&&r&&e.length>=r){const n=new Array(i).fill(1/0),o=new Array(i).fill(-1/0);for(let t=0;t<r;)for(let r=0;r<i;r++){const i=e[t++];i<n[r]&&(n[r]=i),i>o[r]&&(o[r]=i)}t=[n,o]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let n;n=ArrayBuffer.isView(t)?{value:t}:t instanceof s.Z?{buffer:t}:t;const i={...this.settings,...n};if(e.bufferAccessor=i,e.bounds=null,n.constant){let t=n.value;t=this._normalizeValue(t,[],0),this.settings.normalized&&(t=this.normalizeConstant(t));if(!(!e.constant||!this._areValuesEqual(t,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=t}else if(n.buffer){const t=n.buffer;e.externalBuffer=t,e.constant=!1,this.value=n.value||null;const r=n.value instanceof Float64Array;i.type=n.type||t.accessor.type,i.bytesPerElement=t.accessor.BYTES_PER_ELEMENT*(r?2:1),i.stride=h(i)}else if(n.value){this._checkExternalBuffer(n);let t=n.value;e.externalBuffer=null,e.constant=!1,this.value=t,i.bytesPerElement=t.BYTES_PER_ELEMENT,i.stride=h(i);const{buffer:r,byteOffset:o}=this;this.doublePrecision&&t instanceof Float64Array&&(t=(0,c.TK)(t,i));const s=t.byteLength+o+2*i.stride;r.byteLength<s&&r.reallocate(s),r.setAccessor(null),r.subData({data:t,offset:o}),i.type=n.type||r.accessor.type}return!0}updateSubBuffer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.state.bounds=null;const e=this.value,{startOffset:n=0,endOffset:i}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?(0,c.TK)(e,{size:this.size,startIndex:n,endIndex:i}):e.subarray(n,i),offset:n*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{state:n}=this,i=n.allocatedValue,r=l.Z.allocate(i,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=r;const{buffer:o,byteOffset:s}=this;return o.byteLength<r.byteLength+s&&(o.reallocate(r.byteLength+s),e&&i&&o.subData({data:i instanceof Float64Array?(0,c.TK)(i,this):i,offset:s})),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,n.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=e.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));e instanceof n||!this.settings.normalized||"normalized"in t||u.Z.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map((t=>(t+128)/255*2-1));case 5122:return new Float32Array(t).map((t=>(t+32768)/65535*2-1));case 5121:return new Float32Array(t).map((t=>t/255));case 5123:return new Float32Array(t).map((t=>t/65535));default:return t}}_normalizeValue(t,e,n){const{defaultValue:i,size:r}=this.settings;if(Number.isFinite(t))return e[n]=t,e;if(!t){let t=r;for(;--t>=0;)e[n+t]=i[t];return e}switch(r){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:let o=r;for(;--o>=0;)e[n+o]=Number.isFinite(t[o])?t[o]:i[o]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}}var A=n(12997),p=n(73115),g=n(18757);const m=[],y=[[0,1/0]];var v=n(41894);class _ extends f{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:y}),(0,i.Z)(this,"constant",!1),this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat("function"!==typeof t&&t||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,n=this.settings.transition,i=Array.isArray(e)?t[e.find((e=>t[e]))]:t[e];return(0,v.M0)(i,n)}setNeedsUpdate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:t=0,endRow:n=1/0}=e;this.state.updateRanges=function(t,e){if(t===y)return t;if(e[0]<0&&(e[0]=0),e[0]>=e[1])return t;const n=[],i=t.length;let r=0;for(let o=0;o<i;o++){const i=t[o];i[1]<e[0]?(n.push(i),r=o+1):i[0]>e[1]?n.push(i):e=[Math.min(i[0],e[0]),Math.max(i[1],e[1])]}return n.splice(r,0,e),n}(this.state.updateRanges,[t,n])}else this.state.updateRanges=y}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=m}setNeedsRedraw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:n}=this;return!n.noAlloc&&(!!n.update&&(super.allocate(t,e.updateRanges!==y),!0))}updateBuffer(t){let{numInstances:e,data:n,props:i,context:r}=t;if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:s,noAlloc:a}}=this;let l=!0;if(s){for(const[t,a]of o)s.call(r,this,{data:n,startRow:t,endRow:a,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[t,n]of o){const i=Number.isFinite(t)?this.getVertexOffset(t):0,r=Number.isFinite(n)?this.getVertexOffset(n):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:i,endOffset:r})}else;this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(t){if(void 0===t||"function"===typeof t)return!1;return this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const{state:n,settings:i}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;n.binaryValue=t,this.setNeedsRedraw();if(i.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const r=t;(0,A.Z)(ArrayBuffer.isView(r.value),"invalid ".concat(i.accessor));const o=Boolean(r.size)&&r.size!==this.size;return n.binaryAccessor=(0,p.jr)(r.value,{size:r.size||this.size,stride:r.stride,offset:r.offset,startIndices:e,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const n in t)Object.assign(e,super.getShaderAttributes(n,t[n]));return e}_autoUpdater(t,e){let{data:n,startRow:i,endRow:r,props:o,numInstances:s}=e;if(t.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:h}=t,{accessor:d,transform:f}=a,m=l.binaryAccessor||("function"===typeof d?d:o[d]);(0,A.Z)("function"===typeof m,'accessor "'.concat(d,'" is not a function'));let y=t.getVertexOffset(i);const{iterable:v,objectInfo:_}=(0,p.jB)(n,i,r);for(const A of v){_.index++;let e=m(A,_);if(f&&(e=f.call(this,e)),h){const n=(_.index<h.length-1?h[_.index+1]:s)-h[_.index];if(e&&Array.isArray(e[0])){let n=y;for(const i of e)t._normalizeValue(i,c,n),n+=u}else e&&e.length>u?c.set(e,y):(t._normalizeValue(e,_.target,0),(0,g.k)({target:c,source:_.target,start:y,count:n}));y+=n*u}else t._normalizeValue(e,c,y),y+=u}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||"function"===typeof t.update))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let n=!0;switch(e){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error("Illegal attribute generated for ".concat(this.id))}}}var b=n(18188),x=n(23427),w=n(17225),C=n(99188);const B="\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n";var E=n(56474),T=n(58300),S=n(79078);const M={interpolation:class{constructor(t){let{gl:e,attribute:n,timeline:r}=t;(0,i.Z)(this,"gl",void 0),(0,i.Z)(this,"type","interpolation"),(0,i.Z)(this,"attributeInTransition",void 0),(0,i.Z)(this,"settings",void 0),(0,i.Z)(this,"attribute",void 0),(0,i.Z)(this,"transition",void 0),(0,i.Z)(this,"currentStartIndices",void 0),(0,i.Z)(this,"currentLength",void 0),(0,i.Z)(this,"transform",void 0),(0,i.Z)(this,"buffers",void 0),this.gl=e,this.transition=new C.Z(r),this.attribute=n,this.attributeInTransition=new _(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=function(t,e){const n=(0,v.w)(e.size);return new w.Z(t,{vs:B,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}(e,n);const o={byteLength:0,usage:35050};this.buffers=[new s.Z(e,o),new s.Z(e,o)]}get inProgress(){return this.transition.inProgress}start(t,e){if(t.duration<=0)return void this.transition.cancel();this.settings=t;const{gl:n,buffers:i,attribute:r}=this;(0,v.DY)(i);const o={numInstances:e,attribute:r,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const s of i)(0,v.IV)({buffer:s,...o});this.currentStartIndices=r.startIndices,this.currentLength=(0,v.pi)(r,e),this.attributeInTransition.setData({buffer:i[1],value:r.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aFrom:i[0],aTo:(0,v.AQ)(n,r)},feedbackBuffers:{vCurrent:i[1]}})}update(){const t=this.transition.update();if(t){const{duration:t,easing:e}=this.settings,{time:n}=this.transition;let i=n/t;e&&(i=e(i)),this.transform.run({uniforms:{time:i}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}},spring:class{constructor(t){let{gl:e,attribute:n,timeline:r}=t;(0,i.Z)(this,"gl",void 0),(0,i.Z)(this,"type","spring"),(0,i.Z)(this,"attributeInTransition",void 0),(0,i.Z)(this,"settings",void 0),(0,i.Z)(this,"attribute",void 0),(0,i.Z)(this,"transition",void 0),(0,i.Z)(this,"currentStartIndices",void 0),(0,i.Z)(this,"currentLength",void 0),(0,i.Z)(this,"texture",void 0),(0,i.Z)(this,"framebuffer",void 0),(0,i.Z)(this,"transform",void 0),(0,i.Z)(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new C.Z(r),this.attribute=n,this.attributeInTransition=new _(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=function(t){return new T.Z(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}(e),this.framebuffer=function(t,e){return new S.Z(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}(e,this.texture),this.transform=function(t,e,n){const i=(0,v.w)(e.size);return new w.Z(t,{framebuffer:n,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}(e,n,this.framebuffer);const o={byteLength:0,usage:35050};this.buffers=[new s.Z(e,o),new s.Z(e,o),new s.Z(e,o)]}get inProgress(){return this.transition.inProgress}start(t,e){const{gl:n,buffers:i,attribute:r}=this,o={numInstances:e,attribute:r,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const s of i)(0,v.IV)({buffer:s,...o});this.settings=t,this.currentStartIndices=r.startIndices,this.currentLength=(0,v.pi)(r,e),this.attributeInTransition.setData({buffer:i[1],value:r.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aTo:(0,v.AQ)(n,r)}})}update(){const{buffers:t,transform:e,framebuffer:n,transition:i}=this;if(!i.update())return!1;const r=this.settings;e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:n,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:r.stiffness,damping:r.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),(0,v.DY)(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value});return(0,E.z6)(n)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}};class I{constructor(t,e){let{id:n,timeline:r}=e;(0,i.Z)(this,"id",void 0),(0,i.Z)(this,"isSupported",void 0),(0,i.Z)(this,"gl",void 0),(0,i.Z)(this,"timeline",void 0),(0,i.Z)(this,"transitions",void 0),(0,i.Z)(this,"needsRedraw",void 0),(0,i.Z)(this,"numInstances",void 0),this.id=n,this.gl=t,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=w.Z.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update(t){let{attributes:e,transitions:n,numInstances:i}=t;this.numInstances=i||1;for(const r in e){const t=e[r],i=t.getTransitionSetting(n);i&&this._updateAttribute(r,t,i)}for(const r in this.transitions){const t=e[r];t&&t.getTransitionSetting(n)||this._removeTransition(r)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const n=this.transitions[e];n.inProgress&&(t[e]=n.attributeInTransition)}return t}run(){if(!this.isSupported||0===this.numInstances)return!1;for(const e in this.transitions){this.transitions[e].update()&&(this.needsRedraw=!0)}const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,n){const i=this.transitions[t];let r=!i||i.type!==n.type;if(r){if(!this.isSupported)return void u.Z.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();i&&this._removeTransition(t);const o=M[n.type];o?this.transitions[t]=new o({attribute:e,timeline:this.timeline,gl:this.gl}):(u.Z.error("unsupported transition type '".concat(n.type,"'"))(),r=!1)}(r||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}const P="attributeManager.invalidate";class D{constructor(t){let{id:e="attribute-manager",stats:n,timeline:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,i.Z)(this,"id",void 0),(0,i.Z)(this,"gl",void 0),(0,i.Z)(this,"attributes",void 0),(0,i.Z)(this,"updateTriggers",void 0),(0,i.Z)(this,"needsRedraw",void 0),(0,i.Z)(this,"userData",void 0),(0,i.Z)(this,"stats",void 0),(0,i.Z)(this,"attributeTransitionManager",void 0),(0,i.Z)(this,"mergeBoundsMemoized",(0,b.Z)(c.cc)),this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new I(t,{id:"".concat(e,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const e of t)void 0!==this.attributes[e]&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const n=this._invalidateTrigger(t,e);(0,x.Z)(P,this,t,n)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);(0,x.Z)(P,this,"all")}update(t){let{data:e,numInstances:n,startIndices:i=null,transitions:r,props:o={},buffers:s={},context:a={}}=t,l=!1;(0,x.Z)("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const t=this.attributes[c],r=t.settings.accessor;t.startIndices=i,t.numInstances=n,o[c]&&u.Z.removed("props.".concat(c),"data.attributes.".concat(c))(),t.setExternalBuffer(s[c])||t.setBinaryValue("string"===typeof r?s[r]:void 0,e.startIndices)||"string"===typeof r&&!s[r]&&t.setConstantValue(o[r])||t.needsUpdate()&&(l=!0,this._updateAttribute({attribute:t,numInstances:n,data:e,props:o,context:a})),this.needsRedraw=this.needsRedraw||t.needsRedraw()}l&&(0,x.Z)("attributeManager.updateEnd",this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getBounds(t){const e=t.map((t=>{var e;return null===(e=this.attributes[t])||void 0===e?void 0:e.getBounds()}));return this.mergeBoundsMemoized(e)}getChangedAttributes(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearChangedFlags:!1};const{attributes:e,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const r in e){const o=e[r];o.needsRedraw(t)&&!n.hasAttribute(r)&&(i[r]=o)}return i}getShaderAttributes(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t||(t=this.getAttributes());const n={};for(const i in t)e[i]||Object.assign(n,t[i].getShaderAttributes());return n}_add(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(const n in t){const i=t[n];this.attributes[n]=this._createAttribute(n,i,e)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,n){const i={...e,id:t,size:(e.isIndexed?1:e.size)||1,divisor:n.instanced?1:e.divisor||0};return new _(this.gl,i)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes){this.attributes[e].getUpdateTriggers().forEach((n=>{t[n]||(t[n]=[]),t[n].push(e)}))}this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:n,updateTriggers:i}=this,r=i[t];return r&&r.forEach((t=>{const i=n[t];i&&i.setNeedsUpdate(i.id,e)})),r}_updateAttribute(t){const{attribute:e,numInstances:n}=t;if((0,x.Z)("attribute.updateStart",e),e.constant)return void e.setConstantValue(e.value);e.allocate(n)&&(0,x.Z)("attribute.allocate",e,n);e.updateBuffer(t)&&(this.needsRedraw=!0,(0,x.Z)("attribute.updateEnd",e,n))}}},41894:(t,e,n)=>{"use strict";function i(t){const{source:e,target:n,start:i=0,size:r,getData:o}=t,s=t.end||n.length,a=e.length,l=s-i;if(a>l)return void n.set(e.subarray(0,l),i);if(n.set(e,i),!o)return;let c=a;for(;c<l;){const t=o(c,e);for(let e=0;e<r;e++)n[i+c]=t[e]||0,c++}}n.d(e,{DY:()=>l,pi:()=>c,w:()=>a,AQ:()=>s,M0:()=>o,IV:()=>u});const r={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function o(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...r[n],...e,...t,type:n}}function s(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function a(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function l(t){t.push(t.shift())}function c(t,e){const{doublePrecision:n,settings:i,value:r,size:o}=t,s=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*o)*s}function u(t){let{buffer:e,numInstances:n,attribute:r,fromLength:o,fromStartIndices:s,getData:a=(t=>t)}=t;const l=r.doublePrecision&&r.value instanceof Float64Array?2:1,u=r.size*l,h=r.byteOffset,d=r.startIndices,f=s&&d,A=c(r,n),p=r.isConstant;if(!f&&o>=A)return;const g=p?r.value:r.getBuffer().getData({srcByteOffset:h});if(r.settings.normalized&&!p){const t=a;a=(e,n)=>r.normalizeConstant(t(e,n))}const m=p?(t,e)=>a(g,e):(t,e)=>a(g.subarray(t,t+u),e),y=e.getData({length:o}),v=new Float32Array(A);!function(t){let{source:e,target:n,size:r,getData:o,sourceStartIndices:s,targetStartIndices:a}=t;if(!Array.isArray(a))return i({source:e,target:n,size:r,getData:o}),n;let l=0,c=0;const u=o&&((t,e)=>o(t+c,e)),h=Math.min(s.length,a.length);for(let d=1;d<h;d++){const t=s[d]*r,o=a[d]*r;i({source:e.subarray(l,t),target:n,start:c,end:o,size:r,getData:u}),l=t,c=o}c<n.length&&i({source:[],target:n,start:c,size:r,getData:u})}({source:y,target:v,sourceStartIndices:s,targetStartIndices:d,size:u,getData:m}),e.byteLength<v.byteLength+h&&e.reallocate(v.byteLength+h),e.subData({data:v,offset:h})}},79366:(t,e,n)=>{"use strict";n.d(e,{Z:()=>l});var i=n(64649),r=n(90031),o=n(23427),s=n(18757),a=n(48915);class l extends r.Z{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((t=>t.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo(t){let{info:e}=t;const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id?(e.object=n.__source.object,e.index=n.__source.index,e):e}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||e}getSubLayerRow(t,e,n){return t.__source={parent:this,object:e,index:n},t}getSubLayerAccessor(t){if("function"===typeof t){const e={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(e.index=n.__source.index,t(n.__source.object,e)):t(n,i)}return t}getSubLayerProps(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e;const{opacity:n,pickable:i,visible:r,parameters:o,getPolygonOffset:s,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:h,coordinateOrigin:d,wrapLongitude:f,positionFormat:A,modelMatrix:p,extensions:g,fetch:m,operation:y,_subLayerProps:v}=this.props,_={id:"",updateTriggers:{},opacity:n,pickable:i,visible:r,parameters:o,getPolygonOffset:s,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:h,coordinateOrigin:d,wrapLongitude:f,positionFormat:A,modelMatrix:p,extensions:g,fetch:m,operation:y},b=v&&t.id&&v[t.id],x=b&&b.updateTriggers,w=t.id||"sublayer";if(b){const e=this.props[a.Wb],n=t.type?t.type._propTypes:{};for(const t in b){const i=n[t]||e[t];i&&"accessor"===i.type&&(b[t]=this.getSubLayerAccessor(b[t]))}}Object.assign(_,t,b),_.id="".concat(this.props.id,"-").concat(w),_.updateTriggers={all:null===(e=this.props.updateTriggers)||void 0===e?void 0:e.all,...t.updateTriggers,...x};for(const a of g){const t=a.getSubLayerProps.call(this,a);t&&Object.assign(_,t,{updateTriggers:Object.assign(_.updateTriggers,t.updateTriggers)})}return _}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const t=this.renderLayers();n=(0,s.x)(t,Boolean),this.internalState.subLayers=n}(0,o.Z)("compositeLayer.renderLayers",this,i,n);for(const r of n)r.parent=this}}(0,i.Z)(l,"layerName","CompositeLayer")},18252:(t,e,n)=>{"use strict";n.d(e,{Df:()=>r,FP:()=>a,iI:()=>s,zG:()=>o});var i=n(21970);const r={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(r,"IDENTITY",{get:()=>(i.Z.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const o={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},s={common:0,meters:1,pixels:2},a={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}}},90031:(t,e,n)=>{"use strict";n.d(e,{Z:()=>at});var i=n(64649),r=n(18252),o=n(96684),s=n(41894),a=n(47410),l=n(99188);class c extends l.Z{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:n,duration:i,easing:r}}=this,o=r(t/i);this._value=(0,a.t7)(e,n,o)}}const u=1e-5;function h(t,e,n,i,r){const o=e-t;return(n-e)*r+-o*i+o+e}function d(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class f extends l.Z{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:n,stiffness:i}=this.settings,{_prevValue:r=t,_currValue:o=t}=this;let s=function(t,e,n,i,r){if(Array.isArray(n)){const o=[];for(let s=0;s<n.length;s++)o[s]=h(t[s],e[s],n[s],i,r);return o}return h(t,e,n,i,r)}(r,o,e,n,i);const a=d(s,e),l=d(s,o);a<u&&l<u&&(s=e,this.end()),this._prevValue=o,this._currValue=s}}var A=n(21970);const p={interpolation:c,spring:f};class g{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,n,i){const{transitions:r}=this;if(r.has(t)){const n=r.get(t),{value:i=n.settings.fromValue}=n;e=i,this.remove(t)}if(!(i=(0,s.M0)(i)))return;const o=p[i.type];if(!o)return void A.Z.error("unsupported transition type '".concat(i.type,"'"))();const a=new o(this.timeline);a.start({...i,fromValue:e,toValue:n}),r.set(t,a)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,n]of this.transitions)n.update(),t[e]=n.value,n.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}var m=n(49473),y=n(48915);function v(t){if(null===(e=t)||"object"!==typeof e)throw new Error("count(): argument not an object");var e;if("function"===typeof t.count)return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(function(t){return null!==t&&"object"===typeof t&&t.constructor===Object}(t))return Object.keys(t).length;throw new Error("count(): argument not a container")}var _=n(23427),b=n(28007),x=n(12997),w=n(18188),C=n(46802),B=n(70487),E=n(52310),T=n(62220),S=n(99007),M=n(75818);const I=[0,0,0];function P(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=e.projectPosition(t);if(n&&e instanceof E.Z){const[n,r,o=0]=t,s=e.getDistanceScales([n,r]);i[2]=o*s.unitsPerMeter[2]}return i}function D(t,e){let{viewport:n,modelMatrix:i,coordinateSystem:o,coordinateOrigin:s,offsetMode:a}=e,[l,c,u=0]=t;switch(i&&([l,c,u]=T.fF([],[l,c,u,1],i)),o){case r.Df.LNGLAT:return P([l,c,u],n,a);case r.Df.LNGLAT_OFFSETS:return P([l+s[0],c+s[1],u+(s[2]||0)],n,a);case r.Df.METER_OFFSETS:return P((0,M.eG)(s,[l,c,u]),n,a);case r.Df.CARTESIAN:default:return n.isGeospatial?[l+s[0],c+s[1],u+s[2]]:n.projectPosition([l,c,u])}}function F(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:o,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:l}=function(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:o,fromCoordinateSystem:s,fromCoordinateOrigin:a}=t;return o===r.Df.DEFAULT&&(o=e.isGeospatial?r.Df.LNGLAT:r.Df.CARTESIAN),void 0===s&&(s=o),void 0===a&&(a=i),{viewport:e,coordinateSystem:o,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:a}}(e),{autoOffset:c=!0}=e,{geospatialOrigin:u=I,shaderCoordinateOrigin:h=I,offsetMode:d=!1}=c?(0,B.v)(n,i,o):{},f=D(t,{viewport:n,modelMatrix:s,coordinateSystem:a,coordinateOrigin:l,offsetMode:d});if(d){const t=n.projectPosition(u||h);S.lu(f,f,t)}return f}var L=n(28321),O=n(73115),R=n(58300);const k={10241:9987,10240:9729,10242:33071,10243:33071},U={};var z=n(98949);const G={boolean:{validate:(t,e)=>!0,equal:(t,e,n)=>Boolean(t)===Boolean(e)},number:{validate:(t,e)=>Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)},color:{validate:(t,e)=>e.optional&&!t||j(t)&&(3===t.length||4===t.length),equal:(t,e,n)=>(0,z.v)(t,e,1)},accessor:{validate(t,e){const n=V(t);return"function"===n||n===V(e.value)},equal:(t,e,n)=>"function"===typeof e||(0,z.v)(t,e,1)},array:{validate:(t,e)=>e.optional&&!t||j(t),equal(t,e,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?(0,z.v)(t,e,r):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?(0,z.v)(t,e,r):t===e}},function:{validate:(t,e)=>e.optional&&!t||"function"===typeof t,equal:(t,e,n)=>!n.compare&&!1!==n.ignore||t===e},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>{const i=n.context;return i&&i.gl?function(t,e,n,i){if(n instanceof R.Z)return n;n.constructor&&"Object"!==n.constructor.name&&(n={data:n});let r=null;n.compressed&&(r={10241:n.data.length>1?9985:9729});const o=new R.Z(e,{...n,parameters:{...k,...r,...i}});return U[o.id]=t,o}(n.id,i.gl,t,{...e.parameters,...n.props.textureParameters}):null},release:(t,e,n)=>{var i,r;i=n.id,(r=t)&&r instanceof R.Z&&U[r.id]===i&&(r.delete(),delete U[r.id])}}};function N(t,e){switch(V(e)){case"object":return Z(t,e);case"array":return Z(t,{type:"array",value:e,compare:!1});case"boolean":return Z(t,{type:"boolean",value:e});case"number":return Z(t,{type:"number",value:e});case"function":return Z(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Z(t,e){return"type"in e?{name:t,...G[e.type],...e}:"value"in e?{name:t,type:V(e.value),...e}:{name:t,type:"object",value:e}}function j(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function V(t){return j(t)?"array":null===t?"null":typeof t}const H="_mergedDefaultProps";function J(t,e){let n=H;if(e)for(const r of e){const t=r.constructor;t&&(n+=":".concat(t.extensionName||t.name))}const i=K(t,n);return i||(t[n]=function(t,e){const n=t.prototype;if(!n)return null;const i=Object.getPrototypeOf(t),r=J(i),o=K(t,"defaultProps")||{},s=function(t){const e={},n={},i={};for(const[r,o]of Object.entries(t)){const t=null===o||void 0===o?void 0:o.deprecatedFor;if(t)i[r]=Array.isArray(t)?t:[t];else{const t=N(r,o);e[r]=t,n[r]=t.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}(o),a=Object.assign(Object.create(null),r,s.defaultProps),l=Object.assign(Object.create(null),null===r||void 0===r?void 0:r[y.Wb],s.propTypes),c=Object.assign(Object.create(null),null===r||void 0===r?void 0:r[y.E7],s.deprecatedProps);for(const u of e){const t=J(u.constructor);t&&(Object.assign(a,t),Object.assign(l,t[y.Wb]),Object.assign(c,t[y.E7]))}(function(t,e){const n=function(t){const e=t.componentName;e||A.Z.warn("".concat(t.name,".componentName not specified"))();return e||t.name}(e);Object.defineProperties(t,{id:{writable:!0,value:n}})})(a,t),function(t,e){const n={},i={};for(const r in e){const t=e[r],{name:o,value:s}=t;t.async&&(n[o]=s,i[o]=W(o))}t[y.lY]=n,t[y.fO]={},Object.defineProperties(t,i)}(a,l),function(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(t){const i="".concat(this.id,": ").concat(n);for(const r of e[n])Q(this,r)||(this[r]=t);A.Z.deprecated(i,e[n].join("/"))()}})}(a,c),a[y.Wb]=l,a[y.E7]=c,0!==e.length||Q(t,"_propTypes")||(t._propTypes=l);return a}(t,e||[]))}function W(t){return{enumerable:!0,set(e){"string"===typeof e||e instanceof Promise||(0,O.D0)(e)?this[y.fO][t]=e:this[y.bN][t]=e},get(){if(this[y.bN]){if(t in this[y.bN]){return this[y.bN][t]||this[y.lY][t]}if(t in this[y.fO]){const e=this[y.fm]&&this[y.fm].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[y.lY][t]}}return this[y.lY][t]}}}function Q(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function K(t,e){return Q(t,e)&&t[e]}let q=0;class X{constructor(){(0,i.Z)(this,"id",void 0),(0,i.Z)(this,"props",void 0),(0,i.Z)(this,"count",void 0);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.props=function(t,e){let n;for(let o=e.length-1;o>=0;o--){const t=e[o];"extensions"in t&&(n=t.extensions)}const i=J(t.constructor,n),r=Object.create(i);r[y.fm]=t,r[y.fO]={},r[y.bN]={};for(let o=0;o<e.length;++o){const t=e[o];for(const e in t)r[e]=t[e]}return Object.freeze(r),r}(this,e),this.id=this.props.id,this.count=q++}clone(t){const{props:e}=this,n={};for(const i in e[y.lY])i in e[y.bN]?n[i]=e[y.bN][i]:i in e[y.fO]&&(n[i]=e[y.fO][i]);return new this.constructor({...e,...n,...t})}}(0,i.Z)(X,"componentName","Component"),(0,i.Z)(X,"defaultProps",{});const Y=Object.freeze({});class ${constructor(t){(0,i.Z)(this,"component",void 0),(0,i.Z)(this,"onAsyncPropUpdated",void 0),(0,i.Z)(this,"asyncProps",void 0),(0,i.Z)(this,"oldProps",void 0),(0,i.Z)(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Y}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[y.fm]||this.component;const e=t[y.bN]||{},n=t[y.fO]||t,i=t[y.lY]||{};for(const r in e){const t=e[r];this._createAsyncPropData(r,i[r]),this._updateAsyncProp(r,t),e[r]=this.getAsyncProp(r)}for(const r in n){const t=n[r];this._createAsyncPropData(r,i[r]),this._updateAsyncProp(r,t)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){this._didAsyncInputValueChange(t,e)&&("string"===typeof e&&(e=this._fetch(t,e)),e instanceof Promise?this._watchPromise(t,e):(0,O.D0)(e)?this._resolveAsyncIterable(t,e):this._setPropValue(t,e))}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const n=this.asyncProps[t];return e!==n.resolvedValue&&e!==n.lastValue&&(n.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const n=this.asyncProps[t];n&&(e=this._postProcessValue(n,e),n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,e,n){const i=this.asyncProps[t];i&&n>=i.resolvedLoadCount&&void 0!==e&&(this._freezeAsyncOldProps(),i.resolvedValue=e,i.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const n=this.asyncProps[t];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;e.then((e=>{this.component&&(e=this._postProcessValue(n,e),this._setAsyncPropValue(t,e,i),this._onResolve(t,e))})).catch((e=>{this._onError(t,e)}))}}async _resolveAsyncIterable(t,e){if("data"!==t)return void this._setPropValue(t,e);const n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let r=[],o=0;for await(const s of e){if(!this.component)return;const{dataTransform:e}=this.component.props;r=e?e(s,r):r.concat(s),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:o,endRow:r.length}]}),o=r.length,this._setAsyncPropValue(t,r,i)}this._onResolve(t,r)}_postProcessValue(t,e){const n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(e,n,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const n=this.component&&this.component.props[y.Wb];this.asyncProps[t]={type:n&&n[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class tt extends ${constructor(t){let{attributeManager:e,layer:n}=t;super(n),(0,i.Z)(this,"attributeManager",void 0),(0,i.Z)(this,"needsRedraw",void 0),(0,i.Z)(this,"needsUpdate",void 0),(0,i.Z)(this,"subLayers",void 0),(0,i.Z)(this,"usesPickingColorCache",void 0),(0,i.Z)(this,"hasPickingBuffer",void 0),(0,i.Z)(this,"changeFlags",void 0),(0,i.Z)(this,"viewport",void 0),(0,i.Z)(this,"uniformTransitions",void 0),(0,i.Z)(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const n=this.layer,i=null===n||void 0===n?void 0:n.props.fetch;return i?i(e,{propName:t,layer:n}):super._fetch(t,e)}_onResolve(t,e){const n=this.layer;if(n){const i=n.props.onDataLoad;"data"===t&&i&&i(e,{propName:t,layer:n})}}_onError(t,e){const n=this.layer;n&&n.raiseError(e,"loading ".concat(t," of ").concat(this.layer))}}var et=n(49125);const nt=2**24-1,it=Object.freeze([]),rt=(0,w.Z)((t=>{let{oldViewport:e,viewport:n}=t;return e.equals(n)}));let ot=new Uint8ClampedArray(0);const st={data:{type:"data",value:it,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,e)=>{let{propName:n,layer:i,loaders:r,loadOptions:o,signal:s}=e;const{resourceManager:a}=i.context;var l;(o=o||i.getLoadOptions(),r=r||i.props.loaders,s)&&(o={...o,fetch:{...null===(l=o)||void 0===l?void 0:l.fetch,signal:s}});let c=a.contains(t);return c||o||(a.add({resourceId:t,data:(0,et.z)(t,r),persistent:!1}),c=!0),c?a.subscribe({resourceId:t,onChange:t=>{var e;return null===(e=i.internalState)||void 0===e?void 0:e.reloadAsyncProp(n,t)},consumerId:i.id,requestId:n}):(0,et.z)(t,r,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:r.Df.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:t=>{let{layerIndex:e}=t;return[0,100*-e]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class at extends X{constructor(){super(...arguments),(0,i.Z)(this,"internalState",null),(0,i.Z)(this,"lifecycle",y.dt.NO_STATE),(0,i.Z)(this,"context",void 0),(0,i.Z)(this,"state",void 0),(0,i.Z)(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){(0,x.Z)(this.internalState);const e=this.internalState.viewport||this.context.viewport,n=D(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,o]=(0,M.aW)(n,e.pixelProjectionMatrix);return 2===t.length?[i,r]:[i,r,o]}unproject(t){(0,x.Z)(this.internalState);return(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){(0,x.Z)(this.internalState);return F(t,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===r.Df.DEFAULT||t===r.Df.LNGLAT||t===r.Df.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){(0,x.Z)(t instanceof Uint8Array);const[e,n,i]=t;return e+256*n+65536*i-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:v(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return null===(t=this.getAttributeManager())||void 0===t?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){for(const e of this.props.extensions)t=(0,C.l)(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&e)if(Array.isArray(n))for(const i of n)e.invalidateAll(i);else e.invalidateAll();if(e){const{props:n}=t,i=this.internalState.hasPickingBuffer,r=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some((t=>t.getNeedsPickingBuffer.call(this,t)));if(i!==r){this.internalState.hasPickingBuffer=r;const{pickingColors:t,instancePickingColors:n}=e.attributes,i=t||n;i&&(r&&i.constant&&(i.constant=!1,e.invalidate(i.id)),i.value||r||(i.constant=!0,i.value=[0,0,0]))}}}finalizeState(t){for(const n of this.getModels())n.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo(t){let{info:e,mode:n,sourceLayer:i}=t;const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(t,e){var n,i,r,o;(e&&(t=new Error("".concat(e,": ").concat(t.message),{cause:t})),null!==(n=(i=this.props).onError)&&void 0!==n&&n.call(i,t))||(null===(r=this.context)||void 0===r||null===(o=r.onError)||void 0===o||o.call(r,t,this))}getNeedsRedraw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){var t;return(null===(t=this.internalState)||void 0===t?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,e&&rt({oldViewport:e,viewport:t})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";const e=this.getAttributeManager();e&&("all"===t?e.invalidateAll():e.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,n=this.getNumInstances(),i=this.getStartIndices();t.update({data:e.data,numInstances:n,startIndices:i,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const r=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),n=Object.create(this.props);for(const t in e)Object.defineProperty(n,t,{value:e[t]});return n}return this.props}calculateInstancePickingColors(t,e){let{numInstances:n}=e;if(t.constant)return;const i=Math.floor(ot.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>nt&&A.Z.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),ot=L.Z.allocate(ot,n,{size:3,copy:!0,maxCount:Math.max(n,nt)});const t=Math.floor(ot.length/3),e=[];for(let n=i;n<t;n++)this.encodePickingColor(n,e),ot[3*n+0]=e[0],ot[3*n+1]=e[1],ot[3*n+2]=e[2]}t.value=ot.subarray(0,3*n)}_setModelAttributes(t,e){const n=this.getAttributeManager(),i=t.userData.excludeAttributes||{},r=n.getShaderAttributes(e,i);t.setAttributes(r)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e))return void this._disablePickingIndex(t);const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i,o=r&&e.attributes&&e.attributes[r.id];if(o&&o.value){const n=o.value,i=this.encodePickingColor(t);for(let t=0;t<e.length;t++){const e=r.getVertexOffset(t);n[e]===i[0]&&n[e+1]===i[1]&&n[e+2]===i[2]&&this._disablePickingIndex(t)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;if(!i)return;const r=i.getVertexOffset(t),o=i.getVertexOffset(t+1);i.buffer.subData({data:new Uint8Array(o-r),offset:r})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,n=t||e;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==ot.buffer&&(n.value=ot.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){(0,x.Z)(!this.internalState),(0,x.Z)(Number.isFinite(this.props.coordinateSystem)),(0,_.Z)("layer.initialize",this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new tt({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(A.Z.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new g(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){(0,_.Z)("layer.matched",this,this===t);const{state:e,internalState:n}=t;this!==t&&(this.internalState=n,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if((0,_.Z)("layer.update",this,t),!t)return;const e=this.props,n=this.context,i=this.internalState,r=n.viewport,o=this._updateUniformTransition();i.propsInTransition=o,n.viewport=i.viewport||r,this.props=o;try{const t=this._getUpdateParams(),e=this.getModels();if(n.gl)this.updateState(t);else try{this.updateState(t)}catch(s){}for(const n of this.props.extensions)n.updateState.call(this,t,n);const i=this.getModels()[0]!==e[0];this._postUpdate(t,i)}finally{n.viewport=r,this.props=e,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){(0,_.Z)("layer.finalize",this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer(t){let{moduleParameters:e=null,uniforms:n={},parameters:i={}}=t;this._updateAttributeTransition();const r=this.props,o=this.context;this.props=this.internalState.propsInTransition||r;const s=this.props.opacity;n.opacity=Math.pow(s,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:t}=this.props,r=t&&t(n)||[0,0];(0,b.dR)(o.gl,{polygonOffset:r}),(0,b.s8)(o.gl,i,(()=>{const t={moduleParameters:e,uniforms:n,parameters:i,context:o};for(const e of this.props.extensions)e.draw.call(this,t,e);this.draw(t)}))}finally{this.props=r}}getChangeFlags(){var t;return null===(t=this.internalState)||void 0===t?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const i in t)if(t[i]){let n=!1;if("dataChanged"===i){const r=t[i],o=e[i];r&&Array.isArray(o)&&(e.dataChanged=Array.isArray(r)?o.concat(r):r,n=!0)}e[i]||(e[i]=t[i],n=!0),n&&(0,_.Z)("layer.changeFlag",this,i,t)}const n=Boolean(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=n,e.somethingChanged=n||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const n=(0,m.Yt)(t,e);if(n.updateTriggersChanged)for(const r in n.updateTriggersChanged)n.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(n.transitionsChanged)for(const r in n.transitionsChanged){var i;this.internalState.uniformTransitions.add(r,e[r],t[r],null===(i=t.transitions)||void 0===i?void 0:i[r])}return this.setChangeFlags(n)}validateProps(){(0,m.eQ)(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&"function"===typeof n&&(e.pickingHighlightColor=n(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new o.Z(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:n,oldProps:i}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:r}=this.state;null===r||void 0===r||r.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:s,highlightColor:a}=n;if(e||i.autoHighlight!==o||i.highlightedObjectIndex!==s||i.highlightColor!==a){const t={};o||(t.pickingSelectedColor=null),Array.isArray(a)&&(t.pickingHighlightColor=a),(e||s!==i.highlightedObjectIndex)&&(t.pickingSelectedColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setModuleParameters(t)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=!!n&&n.getNeedsRedraw(t);if(e=e||i,e)for(const r of this.props.extensions)r.onNeedsRedraw.call(this,r);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}(0,i.Z)(at,"defaultProps",st),(0,i.Z)(at,"layerName","Layer")},48915:(t,e,n)=>{"use strict";n.d(e,{E7:()=>s,Wb:()=>o,bN:()=>c,dt:()=>i,fO:()=>l,fm:()=>r,lY:()=>a});const i={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},r=Symbol.for("component"),o=Symbol.for("propTypes"),s=Symbol.for("deprecatedProps"),a=Symbol.for("asyncPropDefaults"),l=Symbol.for("asyncPropOriginal"),c=Symbol.for("asyncPropResolved")},49473:(t,e,n)=>{"use strict";n.d(e,{Yt:()=>o,eQ:()=>r,tg:()=>a});var i=n(48915);function r(t){const e=t[i.Wb];for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function o(t,e){const n=a({newProps:t,oldProps:e,propTypes:t[i.Wb],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=function(t,e){if(null===e)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied");n&&r&&(n=r(t.data,e.data)||n);return n}(t,e);let o=!1;return r||(o=function(t,e){if(null===e)return{all:!0};if("all"in t.updateTriggers){if(u(t,e,"all"))return{all:!0}}const n={};let i=!1;for(const r in t.updateTriggers)if("all"!==r){u(t,e,r)&&(n[r]=!0,i=!0)}return!!i&&n}(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:o,extensionsChanged:c(t,e),transitionsChanged:s(t,e)}}function s(t,e){if(!t.transitions)return!1;const n={},r=t[i.Wb];let o=!1;for(const i in t.transitions){const s=r[i],a=s&&s.type;("number"===a||"color"===a||"array"===a)&&l(t[i],e[i],s)&&(n[i]=!0,o=!0)}return!!o&&n}function a(t){let{newProps:e,oldProps:n,ignoreProps:i={},propTypes:r={},triggerName:o="props"}=t;if(n===e)return!1;if("object"!==typeof e||null===e)return"".concat(o," changed shallowly");if("object"!==typeof n||null===n)return"".concat(o," changed shallowly");for(const s of Object.keys(e))if(!(s in i)){if(!(s in n))return"".concat(o,".").concat(s," added");const t=l(e[s],n[s],r[s]);if(t)return"".concat(o,".").concat(s," ").concat(t)}for(const s of Object.keys(n))if(!(s in i)){if(!(s in e))return"".concat(o,".").concat(s," dropped");if(!Object.hasOwnProperty.call(e,s)){const t=l(e[s],n[s],r[s]);if(t)return"".concat(o,".").concat(s," ").concat(t)}}return!1}function l(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)?"changed deeply":i||(i=t&&e&&t.equals,!i||i.call(t,e))?i||e===t?null:"changed shallowly":"changed deeply"}function c(t,e){if(null===e)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i)return!0;if(i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function u(t,e,n){let i=t.updateTriggers[n];i=void 0===i||null===i?{}:i;let r=e.updateTriggers[n];r=void 0===r||null===r?{}:r;return a({oldProps:r,newProps:i,triggerName:n})}},2578:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const i={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};const r={inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:#decl":"\nuniform bool picking_uAttribute;\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}},...{name:"picking",vs:"uniform bool picking_uActive;\nuniform bool picking_uAttribute;\nuniform vec3 picking_uSelectedColor;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Avalid;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.001;\n}\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  if (picking_uActive) {\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!picking_uAttribute) {\n      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;\n    }\n  } else {\n    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\nvoid picking_setPickingAttribute(vec2 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\nvoid picking_setPickingAttribute(vec3 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Avalid;\nvec4 picking_filterHighlightColor(vec4 color) {\n  if (picking_uActive) {\n    return color;\n  }\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    float highLightAlpha = picking_uHighlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  if (picking_uActive) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;const e={};if(void 0!==t.pickingSelectedColor)if(t.pickingSelectedColor){const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}else e.picking_uSelectedColorValid=0;if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,(t=>t/255));Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return void 0!==t.pickingActive&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}}}},66199:(t,e,n)=>{"use strict";n.d(e,{Z:()=>f});const i={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null},r="#define SMOOTH_EDGE_RADIUS 0.5",o={name:"geometry",vs:"\n".concat(r,"\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n"),fs:"\n".concat(r,"\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n")};var s=n(18252);const a=Object.keys(s.Df).map((t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(s.Df[t],";"))).join(""),l=Object.keys(s.zG).map((t=>"const int PROJECTION_MODE_".concat(t," = ").concat(s.zG[t],";"))).join(""),c=Object.keys(s.iI).map((t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(s.iI[t],";"))).join(""),u="".concat(a,"\n").concat(l,"\n").concat(c,"\n\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\nuniform vec3 project_uCommonOrigin;\nuniform bool project_uPseudoMeters;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size_at_latitude(float lat) {\n  float y = clamp(lat, -89.9, 89.9);\n  return 1.0 / cos(radians(y));\n}\n\nfloat project_size() {\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n    project_uPseudoMeters == false) {\n    \n    if (geometry.position.w == 0.0) {\n      return project_size_at_latitude(geometry.worldPosition.y);\n    }\n  \n    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    float y2 = y * y;\n    float y4 = y2 * y2;\n    float y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\n\nfloat project_size_at_latitude(float meters, float lat) {\n  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);\n}\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z * project_size();\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy * project_size();\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter * project_size();\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\n  vec3 uz = normalize(up);\n  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\n  vec3 uy = cross(uz, ux);\n  return mat3(ux, uy, uz);\n}\n\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    transform = project_get_orientation_matrix(commonPosition);\n    return true;\n  }\n  return false;\n}\nvec3 project_normal(vec3 vector) {\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n  mat3 rotation;\n  if (project_needs_rotation(geometry.position.xyz, rotation)) {\n    n = rotation * n;\n  }\n  return n;\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x + 180., 360.0) - 180.;\n  }\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\nvec3 project_globe_(vec3 lnglatz) {\n  float lambda = radians(lnglatz.x);\n  float phi = radians(lnglatz.y);\n  float cosPhi = cos(phi);\n  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n\n  return vec3(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\n  vec4 position_world = project_uModelMatrix * position;\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_mercator_(position_world.xy),\n        project_size_at_latitude(position_world.z, position_world.y),\n        position_world.w\n      );\n    }\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world.xyz += project_uCoordinateOrigin;\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {\n        return vec4(\n          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,\n          project_size(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world.xyz -= project_uCoordinateOrigin;\n  }\n  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_LOW);\n}\n\nvec3 project_position(vec3 position, vec3 position64Low) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  return viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters) * project_uScale;\n}\nfloat project_size_to_pixel(float size, int unit) {\n  if (unit == UNIT_METERS) return project_size_to_pixel(size);\n  if (unit == UNIT_COMMON) return size * project_uScale;\n  return size;\n}\nfloat project_pixel_size(float pixels) {\n  return pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels / project_uScale;\n}\n");var h=n(70487);const d={};const f={name:"project",dependencies:[i,o],vs:u,getUniforms:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;return"viewport"in t?(0,h.C)(t):{}}}},70487:(t,e,n)=>{"use strict";n.d(e,{C:()=>A,v:()=>f});var i=n(83367),r=n(62220),o=n(18252),s=n(18188);const a=[0,0,0,0],l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0,0],h=[0,0,0],d=(0,s.Z)((function(t){let{viewport:e,devicePixelRatio:n,coordinateSystem:s,coordinateOrigin:h}=t;const{projectionCenter:d,viewProjectionMatrix:A,originCommon:p,cameraPosCommon:g,shaderCoordinateOrigin:m,geospatialOrigin:y}=function(t,e,n){const{viewMatrixUncentered:o,projectionMatrix:s}=t;let{viewMatrix:c,viewProjectionMatrix:u}=t,h=a,d=a,A=t.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:g,offsetMode:m}=f(t,e,n);m&&(d=t.projectPosition(p||g),A=[A[0]-d[0],A[1]-d[1],A[2]-d[2]],d[3]=1,h=r.fF([],d,u),c=o||c,u=i.Jp([],s,c),u=i.Jp([],u,l));return{viewMatrix:c,viewProjectionMatrix:u,projectionCenter:h,originCommon:d,cameraPosCommon:A,shaderCoordinateOrigin:g,geospatialOrigin:p}}(e,s,h),v=e.getDistanceScales(),_=[e.width*n,e.height*n],b=r.fF([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,x={project_uCoordinateSystem:s,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:m,project_uCommonOrigin:p.slice(0,3),project_uCenter:d,project_uPseudoMeters:Boolean(e._pseudoMeters),project_uViewportSize:_,project_uDevicePixelRatio:n,project_uFocalDistance:b,project_uCommonUnitsPerMeter:v.unitsPerMeter,project_uCommonUnitsPerWorldUnit:v.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:u,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:A,project_uModelMatrix:c,project_uCameraPosition:g};if(y){const t=e.getDistanceScales(y);switch(s){case o.Df.METER_OFFSETS:x.project_uCommonUnitsPerWorldUnit=t.unitsPerMeter,x.project_uCommonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case o.Df.LNGLAT:case o.Df.LNGLAT_OFFSETS:e._pseudoMeters||(x.project_uCommonUnitsPerMeter=t.unitsPerMeter),x.project_uCommonUnitsPerWorldUnit=t.unitsPerDegree,x.project_uCommonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case o.Df.CARTESIAN:x.project_uCommonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],x.project_uCommonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return x}));function f(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h;n.length<3&&(n=[n[0],n[1],0]);let i,r=n,s=!0;switch(i=e===o.Df.LNGLAT_OFFSETS||e===o.Df.METER_OFFSETS?n:t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case o.zG.WEB_MERCATOR:e!==o.Df.LNGLAT&&e!==o.Df.CARTESIAN||(i=[0,0,0],s=!1);break;case o.zG.WEB_MERCATOR_AUTO_OFFSET:e===o.Df.LNGLAT?r=i:e===o.Df.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case o.zG.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case o.zG.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function A(t){let{viewport:e,devicePixelRatio:n=1,modelMatrix:i=null,coordinateSystem:r=o.Df.DEFAULT,coordinateOrigin:s=h,autoWrapLongitude:a=!1}=t;r===o.Df.DEFAULT&&(r=e.isGeospatial?o.Df.LNGLAT:o.Df.CARTESIAN);const l=d({viewport:e,devicePixelRatio:n,coordinateSystem:r,coordinateOrigin:s});return l.project_uWrapLongitude=a,l.project_uModelMatrix=i||c,l}},2123:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});const i={name:"project32",dependencies:[n(66199).Z],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"}},99188:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});var i=n(64649);class r{constructor(t){(0,i.Z)(this,"_inProgress",void 0),(0,i.Z)(this,"_handle",void 0),(0,i.Z)(this,"_timeline",void 0),(0,i.Z)(this,"time",void 0),(0,i.Z)(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var e,n;this.cancel(),this.settings=t,this._inProgress=!0,null===(e=(n=this.settings).onStart)||void 0===e||e.call(n,this)}end(){var t,e;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,null===(t=(e=this.settings).onEnd)||void 0===t||t.call(e,this))}cancel(){var t,e;this._inProgress&&(null===(t=(e=this.settings).onInterrupt)||void 0===t||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var t,e;if(!this._inProgress)return!1;if(null===this._handle){const{_timeline:t,settings:e}=this;this._handle=t.addChannel({delay:t.getTime(),duration:e.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),null===(t=(e=this.settings).onUpdate)||void 0===t||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}},12997:(t,e,n)=>{"use strict";function i(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}n.d(e,{Z:()=>i})},98949:(t,e,n)=>{"use strict";function i(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!i(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if("object"===typeof t&&"object"===typeof e){const r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(const s of r){if(!e.hasOwnProperty(s))return!1;if(!i(t[s],e[s],n-1))return!1}return!0}return!1}n.d(e,{v:()=>i})},18757:(t,e,n)=>{"use strict";function i(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!0;return Array.isArray(t)?r(t,e,[]):e(t)?[t]:[]}function r(t,e,n){let i=-1;for(;++i<t.length;){const o=t[i];Array.isArray(o)?r(o,e,n):e(o)&&n.push(o)}return n}function o(t){let{target:e,source:n,start:i=0,count:r=1}=t;const o=n.length,s=r*o;let a=0;for(let l=i;a<o;a++)e[l++]=n[a];for(;a<s;)a<s-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+s-a),a=s);return e}n.d(e,{k:()=>o,x:()=>i})},73115:(t,e,n)=>{"use strict";n.d(e,{D0:()=>s,jB:()=>o,jr:()=>a});const i=[],r=[];function o(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,o=i;const s={index:-1,data:t,target:[]};return t?"function"===typeof t[Symbol.iterator]?o=t:t.length>0&&(r.length=t.length,o=r):o=i,(e>0||Number.isFinite(n))&&(o=(Array.isArray(o)?o:Array.from(o)).slice(e,n),s.index=e-1),{iterable:o,objectInfo:s}}function s(t){return t&&t[Symbol.asyncIterator]}function a(t,e){const{size:n,stride:i,offset:r,startIndices:o,nested:s}=e,a=t.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((t.length-c)/l);return(e,i)=>{let{index:r,target:a}=i;if(!o){const e=r*l+c;for(let i=0;i<n;i++)a[i]=t[e+i];return a}const h=o[r],d=o[r+1]||u;let f;if(s){f=new Array(d-h);for(let e=h;e<d;e++){const i=e*l+c;a=new Array(n);for(let e=0;e<n;e++)a[e]=t[i+e];f[e-h]=a}}else if(l===n)f=t.subarray(h*n+c,d*n+c);else{f=new t.constructor((d-h)*n);let e=0;for(let i=h;i<d;i++){const r=i*l+c;for(let i=0;i<n;i++)f[e++]=t[r+i]}}return f}}},21970:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});const i=new(n(87294).Z)({id:"deck"})},64441:(t,e,n)=>{"use strict";n.d(e,{Du:()=>a,Ks:()=>u,TK:()=>d,Xt:()=>s,bS:()=>o,cc:()=>f});var i=n(28321),r=n(431);function o(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function s(t){return[t[12],t[13],t[14]]}function a(t){return{left:c(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:c(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:c(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:c(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:c(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:c(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const l=new r.Z;function c(t,e,n,i){l.set(t,e,n);const o=l.len();return{distance:i/o,normal:new r.Z(-t/o,-e/o,-n/o)}}function u(t){return t-Math.fround(t)}let h;function d(t,e){const{size:n=1,startIndex:r=0}=e,o=void 0!==e.endIndex?e.endIndex:t.length,s=(o-r)/n;h=i.Z.allocate(h,s,{type:Float32Array,size:2*n});let a=r,l=0;for(;a<o;){for(let e=0;e<n;e++){const i=t[a++];h[l+e]=i,h[l+e+n]=u(i)}l+=2*n}return h.subarray(0,s*n*2)}function f(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}},18188:(t,e,n)=>{"use strict";function i(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function r(t){let e,n={};return r=>{for(const o in r)if(!i(r[o],n[o])){e=t(r),n=r;break}return e}}n.d(e,{Z:()=>r})},46802:(t,e,n)=>{"use strict";function i(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some((t=>"project64"===t.name)))){const t=n.modules.findIndex((t=>"project32"===t.name));t>=0&&n.modules.splice(t,1)}if("inject"in e)if(t.inject){const i={...t.inject};for(const t in e.inject)i[t]=(i[t]||"")+e.inject[t];n.inject=i}else n.inject=e.inject;return n}n.d(e,{l:()=>i})},55678:(t,e,n)=>{"use strict";n.d(e,{Z:()=>l});var i=n(64649),r=n(73115),o=n(28321),s=n(12997),a=n(33839);class l{constructor(t){(0,i.Z)(this,"opts",void 0),(0,i.Z)(this,"typedArrayManager",void 0),(0,i.Z)(this,"indexStarts",[0]),(0,i.Z)(this,"vertexStarts",[0]),(0,i.Z)(this,"vertexCount",0),(0,i.Z)(this,"instanceCount",0),(0,i.Z)(this,"attributes",void 0),(0,i.Z)(this,"_attributeDefs",void 0),(0,i.Z)(this,"data",void 0),(0,i.Z)(this,"getGeometry",void 0),(0,i.Z)(this,"geometryBuffer",void 0),(0,i.Z)(this,"buffers",void 0),(0,i.Z)(this,"positionSize",void 0),(0,i.Z)(this,"normalize",void 0);const{attributes:e={}}=t;this.typedArrayManager=o.Z,this.attributes={},this._attributeDefs=e,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);const{data:e,buffers:n={},getGeometry:i,geometryBuffer:r,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=e,this.getGeometry=i,this.positionSize=r&&r.size||("XY"===o?2:3),this.buffers=n,this.normalize=l,r&&((0,s.Z)(e.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),l||(n.positions=r)),this.geometryBuffer=n.positions,Array.isArray(a))for(const s of a)this._rebuildGeometry(s);else this._rebuildGeometry()}updatePartialGeometry(t){let{startRow:e,endRow:n}=t;this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(t){const e=t.value||t;return ArrayBuffer.isView(e)?(0,r.jr)(e,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,e){const{attributes:n,buffers:i,_attributeDefs:r,typedArrayManager:o}=this;for(const s in r)if(s in i)o.release(n[s]),n[s]=null;else{const i=r[s];i.copy=e,n[s]=o.allocate(n[s],t,i)}}_forEachGeometry(t,e,n){const{data:i,getGeometry:o}=this,{iterable:s,objectInfo:a}=(0,r.jB)(i,e,n);for(const r of s){a.index++;t(o?o(r,a):null,a.index)}}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:e,vertexStarts:n,instanceCount:i}=this;const{data:r,geometryBuffer:o}=this,{startRow:s=0,endRow:l=1/0}=t||{},c={};if(t||(e=[0],n=[0]),this.normalize||!o)this._forEachGeometry(((t,e)=>{const i=t&&this.normalizeGeometry(t);c[e]=i,n[e+1]=n[e]+(i?this.getGeometrySize(i):0)}),s,l),i=n[n.length-1];else if(n=r.startIndices,i=n[r.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof a.Z){const t=o.accessor.stride||4*this.positionSize;i=i||o.byteLength/t}else if(o.buffer){const t=o.stride||4*this.positionSize;i=i||o.buffer.byteLength/t}else if(o.value){const t=o.value,e=o.stride/t.BYTES_PER_ELEMENT||this.positionSize;i=i||t.length/e}this._allocate(i,Boolean(t)),this.indexStarts=e,this.vertexStarts=n,this.instanceCount=i;const u={};this._forEachGeometry(((t,r)=>{const o=c[r]||t;u.vertexStart=n[r],u.indexStart=e[r];const s=r<n.length-1?n[r+1]:i;u.geometrySize=s-n[r],u.geometryIndex=r,this.updateGeometryAttributes(o,u)}),s,l),this.vertexCount=e[e.length-1]}}},28321:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});var i=n(64649);const r=new class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.Z)(this,"_pool",[]),(0,i.Z)(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,n){let{size:i=1,type:r,padding:o=0,copy:s=!1,initialize:a=!1,maxCount:l}=n;const c=r||t&&t.constructor||Float32Array,u=e*i+o;if(ArrayBuffer.isView(t)){if(u<=t.length)return t;if(u*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new c(t.buffer,0,u)}let h=1/0;l&&(h=l*i+o);const d=this._allocate(c,u,a,h);return t&&s?d.set(t):a||d.fill(0,0,4),this._release(t),d}release(t){this._release(t)}_allocate(t,e,n,i){let r=Math.max(Math.ceil(e*this.opts.overAlloc),1);r>i&&(r=i);const o=this._pool,s=t.BYTES_PER_ELEMENT*r,a=o.findIndex((t=>t.byteLength>=s));if(a>=0){const e=new t(o.splice(a,1)[0],0,r);return n&&e.fill(0),e}return new t(r)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:n}=t,{byteLength:i}=n,r=e.findIndex((t=>t.byteLength>=i));r<0?e.push(n):(r>0||e.length<this.opts.poolSize)&&e.splice(r,0,n),e.length>this.opts.poolSize&&e.shift()}}},83427:(t,e,n)=>{"use strict";n.d(e,{Z:()=>g});var i=n(64649),r=n(21970),o=n(64441),s=n(12987),a=n(47410),l=n(431),c=n(83367),u=n(75818),h=n(18252);const d=Math.PI/180,f=(0,o.bS)(),A=[0,0,0],p={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class g{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.Z)(this,"id",void 0),(0,i.Z)(this,"x",void 0),(0,i.Z)(this,"y",void 0),(0,i.Z)(this,"width",void 0),(0,i.Z)(this,"height",void 0),(0,i.Z)(this,"padding",void 0),(0,i.Z)(this,"isGeospatial",void 0),(0,i.Z)(this,"zoom",void 0),(0,i.Z)(this,"focalDistance",void 0),(0,i.Z)(this,"position",void 0),(0,i.Z)(this,"modelMatrix",void 0),(0,i.Z)(this,"distanceScales",void 0),(0,i.Z)(this,"scale",void 0),(0,i.Z)(this,"center",void 0),(0,i.Z)(this,"cameraPosition",void 0),(0,i.Z)(this,"projectionMatrix",void 0),(0,i.Z)(this,"viewMatrix",void 0),(0,i.Z)(this,"viewMatrixUncentered",void 0),(0,i.Z)(this,"viewMatrixInverse",void 0),(0,i.Z)(this,"viewProjectionMatrix",void 0),(0,i.Z)(this,"pixelProjectionMatrix",void 0),(0,i.Z)(this,"pixelUnprojectionMatrix",void 0),(0,i.Z)(this,"resolution",void 0),(0,i.Z)(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||p,this.focalDistance=t.focalDistance||1,this.position=t.position||A,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?h.zG.WEB_MERCATOR:h.zG.WEB_MERCATOR_AUTO_OFFSET:h.zG.IDENTITY}equals(t){return t instanceof g&&(this===t||t.width===this.width&&t.height===this.height&&t.scale===this.scale&&(0,a.fS)(t.projectionMatrix,this.projectionMatrix)&&(0,a.fS)(t.viewMatrix,this.viewMatrix))}project(t){let{topLeft:e=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.projectPosition(t),i=(0,u.aW)(n,this.pixelProjectionMatrix),[r,o]=i,s=e?o:this.height-o;return 2===t.length?[r,s]:[r,s,i[2]]}unproject(t){let{topLeft:e=!0,targetZ:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[i,r,o]=t,s=e?r:this.height-r,a=n&&n*this.distanceScales.unitsPerMeter[2],l=(0,u.CT)([i,s,o],this.pixelUnprojectionMatrix,a),[c,h,d]=this.unprojectPosition(l);return Number.isFinite(o)?[c,h,d]:Number.isFinite(n)?[c,h,n]:[c,h]}projectPosition(t){const[e,n]=this.projectFlat(t);return[e,n,(t[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(t){const[e,n]=this.unprojectFlat(t);return[e,n,(t[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(t){if(this.isGeospatial){const e=(0,u.w5)(t);return e[1]=(0,a.uZ)(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?(0,u.es)(t):t}getBounds(){const t={targetZ:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0},e=this.unproject([0,0],t),n=this.unproject([this.width,0],t),i=this.unproject([0,this.height],t),r=this.unproject([this.width,this.height],t);return[Math.min(e[0],n[0],i[0],r[0]),Math.min(e[1],n[1],i[1],r[1]),Math.max(e[0],n[0],i[0],r[0]),Math.max(e[1],n[1],i[1],r[1])]}getDistanceScales(t){return t?(0,u.ro)({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel(t){let{x:e,y:n,width:i=1,height:r=1}=t;return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,(0,o.Du)(this.viewProjectionMatrix)),this._frustumPlanes}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=(0,u.Bf)({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||(0,u.ro)({latitude:n,longitude:e}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:r,modelMatrix:o}=t;let a=A;if(r&&(a=o?new s.Z(o).transformAsVector(r,[]):r),this.isGeospatial){const t=this.projectPosition([e,n,0]);this.center=new l.Z(a).scale(this.distanceScales.unitsPerMeter).add(t)}else this.center=this.projectPosition(a)}_initMatrices(t){const{viewMatrix:e=f,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:u,fovy:h=75,near:A=.1,far:p=1e3,padding:g=null,focalDistance:m=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=(new s.Z).multiplyRight(e).translate(new l.Z(this.center).negate()),this.projectionMatrix=n||function(t){let{width:e,height:n,orthographic:i,fovyRadians:r,focalDistance:o,padding:l,near:c,far:u}=t;const h=e/n,d=i?(new s.Z).orthographic({fovy:r,aspect:h,focalDistance:o,near:c,far:u}):(new s.Z).perspective({fovy:r,aspect:h,near:c,far:u});if(l){const{left:t=0,right:i=0,top:r=0,bottom:o=0}=l,s=(0,a.uZ)((t+e-i)/2,0,e)-e/2,c=(0,a.uZ)((r+n-o)/2,0,n)-n/2;d[8]-=2*s/e,d[9]+=2*c/n}return d}({width:this.width,height:this.height,orthographic:i,fovyRadians:u||h*d,focalDistance:m,padding:g,near:A,far:p});const y=(0,o.bS)();c.Jp(y,y,this.projectionMatrix),c.Jp(y,y,this.viewMatrix),this.viewProjectionMatrix=y,this.viewMatrixInverse=c.U_([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=(0,o.Xt)(this.viewMatrixInverse);const v=(0,o.bS)(),_=(0,o.bS)();c.bA(v,v,[this.width/2,-this.height/2,1]),c.Iu(v,v,[1,-1,0]),c.Jp(_,v,this.viewProjectionMatrix),this.pixelProjectionMatrix=_,this.pixelUnprojectionMatrix=c.U_((0,o.bS)(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||r.Z.warn("Pixel project matrix not invertible")()}}(0,i.Z)(g,"displayName","Viewport")},52310:(t,e,n)=>{"use strict";n.d(e,{Z:()=>c});var i=n(64649),r=n(83427),o=n(75818),s=n(77548),a=n(47410),l=n(12987);class c extends r.Z{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{latitude:e=0,longitude:n=0,zoom:r=0,pitch:s=0,bearing:c=0,nearZMultiplier:u=.1,farZMultiplier:h=1.01,nearZ:d,farZ:f,orthographic:A=!1,projectionMatrix:p,repeat:g=!1,worldOffset:m=0,position:y,padding:v,legacyMeterSizes:_=!1}=t;let{width:b,height:x,altitude:w=1.5}=t;const C=Math.pow(2,r);let B;b=b||1,x=x||1;let E=null;if(p)w=p[5]/2,B=(0,o.Lu)(w);else{let n;if(t.fovy?(B=t.fovy,w=(0,o.sj)(B)):B=(0,o.Lu)(w),v){const{top:t=0,bottom:e=0}=v;n=[0,(0,a.uZ)((t+x-e)/2,0,x)-x/2]}E=(0,o.wl)({width:b,height:x,scale:C,center:y&&[0,0,y[2]*(0,o.NC)(e)],offset:n,pitch:s,fovy:B,nearZMultiplier:u,farZMultiplier:h}),Number.isFinite(d)&&(E.near=d),Number.isFinite(f)&&(E.far=f)}let T=(0,o.lf)({height:x,pitch:s,bearing:c,scale:C,altitude:w});if(m){T=(new l.Z).translate([512*m,0,0]).multiplyLeft(T)}super({...t,width:b,height:x,viewMatrix:T,longitude:n,latitude:e,zoom:r,...E,fovy:B,focalDistance:w}),(0,i.Z)(this,"longitude",void 0),(0,i.Z)(this,"latitude",void 0),(0,i.Z)(this,"pitch",void 0),(0,i.Z)(this,"bearing",void 0),(0,i.Z)(this,"altitude",void 0),(0,i.Z)(this,"fovy",void 0),(0,i.Z)(this,"orthographic",void 0),(0,i.Z)(this,"_subViewports",void 0),(0,i.Z)(this,"_pseudoMeters",void 0),this.latitude=e,this.longitude=n,this.zoom=r,this.pitch=s,this.bearing=c,this.altitude=w,this.fovy=B,this.orthographic=A,this._subViewports=g?[]:null,this._pseudoMeters=_,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let i=e;i<=n;i++){const t=i?new c({...this,worldOffset:i}):this;this._subViewports.push(t)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,n]=this.projectFlat(t);return[e,n,(t[2]||0)*(0,o.NC)(t[1])]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,n]=this.unprojectFlat(t);return[e,n,(t[2]||0)/(0,o.NC)(n)]}addMetersToLngLat(t,e){return(0,o.eG)(t,e)}panByPosition(t,e){const n=(0,o.CT)(e,this.pixelUnprojectionMatrix),i=this.projectFlat(t),r=s.IH([],i,s.tk([],n)),a=s.IH([],this.center,r),[l,c]=this.unprojectFlat(a);return{longitude:l,latitude:c}}getBounds(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=(0,o.zX)(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{width:n,height:i}=this,{longitude:r,latitude:s,zoom:a}=(0,o.Xg)({width:n,height:i,bounds:t,...e});return new c({width:n,height:i,longitude:r,latitude:s,zoom:a})}}(0,i.Z)(c,"displayName","WebMercatorViewport")},75751:(t,e,n)=>{"use strict";n.d(e,{D0:()=>l,Ew:()=>c,Kn:()=>o,Lj:()=>u,Os:()=>d,Ss:()=>s,TW:()=>a,zH:()=>h});const i=t=>"boolean"===typeof t,r=t=>"function"===typeof t,o=t=>null!==t&&"object"===typeof t,s=t=>o(t)&&t.constructor==={}.constructor,a=t=>t&&"function"===typeof t[Symbol.iterator],l=t=>t&&"function"===typeof t[Symbol.asyncIterator],c=t=>"undefined"!==typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,u=t=>"undefined"!==typeof Blob&&t instanceof Blob,h=t=>t&&"object"===typeof t&&t.isBuffer,d=t=>(t=>"undefined"!==typeof ReadableStream&&t instanceof ReadableStream||o(t)&&r(t.tee)&&r(t.cancel)&&r(t.getReader))(t)||(t=>o(t)&&r(t.read)&&r(t.pipe)&&i(t.readable))(t)},49125:(t,e,n)=>{"use strict";n.d(e,{z:()=>ut});var i=n(75751),r=n(56742);let o="";const s={};const a=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,l=/^([-\w.]+\/[-\w.+]+)/;function c(t){const e=a.exec(t);return e?e[1]:""}const u=/\?.*/;function h(t){return t.replace(u,"")}function d(t){if((0,i.Ew)(t)){return t.url}if((0,i.Lj)(t)){return t.name||""}return"string"===typeof t?t:""}function f(t){if((0,i.Ew)(t)){const e=t,n=e.headers.get("content-type")||"",i=h(e.url);return function(t){const e=l.exec(t);return e?e[1]:t}(n)||c(i)}if((0,i.Lj)(t)){return t.type||""}return"string"===typeof t?c(t):""}async function A(t){if((0,i.Ew)(t))return t;const e={},n=function(t){if((0,i.Ew)(t))return t.headers["content-length"]||-1;if((0,i.Lj)(t))return t.size;return"string"===typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}(t);n>=0&&(e["content-length"]=String(n));const r=d(t),o=f(t);o&&(e["content-type"]=o);const s=await async function(t){const e=5;if("string"===typeof t)return"data:,".concat(t.slice(0,e));if(t instanceof Blob){const e=t.slice(0,5);return await new Promise((t=>{const n=new FileReader;n.onload=e=>{var n;return t(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.result)},n.readAsDataURL(e)}))}if(t instanceof ArrayBuffer){const n=function(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}(t.slice(0,e));return"data:base64,".concat(n)}return null}(t);s&&(e["x-first-bytes"]=s),"string"===typeof t&&(t=(new TextEncoder).encode(t));const a=new Response(t,{headers:e});return Object.defineProperty(a,"url",{value:r}),a}async function p(t,e){if("string"===typeof t){t=function(t){for(const e in s)if(t.startsWith(e)){const n=s[e];t=t.replace(e,n)}return t.startsWith("http://")||t.startsWith("https://")||(t="".concat(o).concat(t)),t}(t);let n=e;return null!==e&&void 0!==e&&e.fetch&&"function"!==typeof(null===e||void 0===e?void 0:e.fetch)&&(n=e.fetch),await fetch(t,n)}return await A(t)}var g=n(30136);function m(t,e){const n=(0,g.pm)(),r=t||n;return"function"===typeof r.fetch?r.fetch:(0,i.Kn)(r.fetch)?t=>p(t,r):null!==e&&void 0!==e&&e.fetch?null===e||void 0===e?void 0:e.fetch:p}function y(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const v="3.4.15";"undefined"!==typeof self&&self,"undefined"!==typeof window&&window,"undefined"!==typeof n.g&&n.g,"undefined"!==typeof document&&document;const _="object"!==typeof process||"[object process]"!==String(process)||process.browser,b="undefined"!==typeof window&&"undefined"!==typeof window.orientation,x="undefined"!==typeof process&&process.version&&/v([0-9]*)/.exec(process.version);x&&parseFloat(x[1]);var w=n(64649);class C{terminate(){}}function B(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const E=new Map;function T(t){B(t.source&&!t.url||!t.source&&t.url);let e=E.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return S((e=t,"try {\n  importScripts('".concat(e,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")));var e}(t.url),E.set(t.url,e)),t.source&&(e=S(t.source),E.set(t.source,e))),B(e),e}function S(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function M(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(t){if(I(t))i.add(t);else if(I(t.buffer))i.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"===typeof t)for(const r in t)M(t[r],e,i)}else;return void 0===n?Array.from(i):[]}function I(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!==typeof MessagePort&&t instanceof MessagePort||("undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!==typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}const P=()=>{};class D{static isSupported(){return"undefined"!==typeof Worker&&_||"undefined"!==typeof C&&!_}constructor(t){(0,w.Z)(this,"name",void 0),(0,w.Z)(this,"source",void 0),(0,w.Z)(this,"url",void 0),(0,w.Z)(this,"terminated",!1),(0,w.Z)(this,"worker",void 0),(0,w.Z)(this,"onMessage",void 0),(0,w.Z)(this,"onError",void 0),(0,w.Z)(this,"_loadableURL","");const{name:e,source:n,url:i}=t;B(n||i),this.name=e,this.source=n,this.url=i,this.onMessage=P,this.onError=t=>console.log(t),this.worker=_?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=P,this.onError=P,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,e){e=e||M(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=T({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},t.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},t.onmessageerror=t=>console.error(t),t}_createNodeWorker(){let t;if(this.url){const e=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new C(e,{eval:!1})}else{if(!this.source)throw new Error("no worker");t=new C(this.source,{eval:!0})}return t.on("message",(t=>{this.onMessage(t)})),t.on("error",(t=>{this.onError(t)})),t.on("exit",(t=>{})),t}}class F{constructor(t,e){(0,w.Z)(this,"name",void 0),(0,w.Z)(this,"workerThread",void 0),(0,w.Z)(this,"isRunning",!0),(0,w.Z)(this,"result",void 0),(0,w.Z)(this,"_resolve",(()=>{})),(0,w.Z)(this,"_reject",(()=>{})),this.name=t,this.workerThread=e,this.result=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){B(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){B(this.isRunning),this.isRunning=!1,this._reject(t)}}class L{static isSupported(){return D.isSupported()}constructor(t){(0,w.Z)(this,"name","unnamed"),(0,w.Z)(this,"source",void 0),(0,w.Z)(this,"url",void 0),(0,w.Z)(this,"maxConcurrency",1),(0,w.Z)(this,"maxMobileConcurrency",1),(0,w.Z)(this,"onDebug",(()=>{})),(0,w.Z)(this,"reuseWorkers",!0),(0,w.Z)(this,"props",{}),(0,w.Z)(this,"jobQueue",[]),(0,w.Z)(this,"idleQueue",[]),(0,w.Z)(this,"count",0),(0,w.Z)(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach((t=>t.destroy())),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)}async startJob(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e,n)=>t.done(n),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(t,e)=>t.error(e);const i=new Promise((i=>(this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:i}),this)));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const n=new F(e.name,t);t.onMessage=t=>e.onMessage(n,t.type,t.payload),t.onError=t=>e.onError(n,t),e.onStart(n);try{await n.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new D({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return b?this.maxMobileConcurrency:this.maxConcurrency}}const O={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class R{static isSupported(){return D.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return R._workerFarm=R._workerFarm||new R({}),R._workerFarm.setProps(t),R._workerFarm}constructor(t){(0,w.Z)(this,"props",void 0),(0,w.Z)(this,"workerPools",new Map),this.props={...O},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:n,url:i}=t;let r=this.workerPools.get(e);return r||(r=new L({name:e,source:n,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(0,w.Z)(R,"_workerFarm",void 0);const k="latest";async function U(t,e,n,i,r){const o=t.id,s=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let r=n.workerUrl;if(r||"compression"!==t.id||(r=e.workerUrl),"test"===e._workerType&&(r="modules/".concat(t.module,"/dist/").concat(i)),!r){let e=t.version;"latest"===e&&(e=k);const n=e?"@".concat(e):"";r="https://unpkg.com/@loaders.gl/".concat(t.module).concat(n,"/dist/").concat(i)}return B(r),r}(t,n),a=R.getWorkerFarm(n).getWorkerPool({name:o,url:s});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const l=await a.startJob("process-on-worker",z.bind(null,r));l.postMessage("process",{input:e,options:n,context:i});const c=await l.result;return await c.result}async function z(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:o,input:s,options:a}=i;try{const n=await t(s,a);e.postMessage("done",{id:o,result:n})}catch(r){const t=r instanceof Error?r.message:"unknown error";e.postMessage("error",{id:o,error:t})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}var G=n(52194);const N=262144;const Z=262144;const j=1048576;var V=n(7494);function H(t){if((e=t)&&"object"===typeof e&&e.isBuffer)return t;var e;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return 0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if("string"===typeof t){const e=t;return(new TextEncoder).encode(e).buffer}if(t&&"object"===typeof t&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function J(t,e){return V.jU?async function*(t,e){const n=t.getReader();let i;try{for(;;){const t=i||n.read();null!==e&&void 0!==e&&e._streamReadAhead&&(i=n.read());const{done:r,value:o}=await t;if(r)return;yield H(o)}}catch(r){n.releaseLock()}}(t,e):async function*(t,e){for await(const n of t)yield H(n)}(t)}function W(t,e){if("string"===typeof t)return function*(t,e){const n=(null===e||void 0===e?void 0:e.chunkSize)||N;let i=0;const r=new TextEncoder;for(;i<t.length;){const e=Math.min(t.length-i,n),o=t.slice(i,i+e);i+=e,yield r.encode(o)}}(t,e);if(t instanceof ArrayBuffer)return function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const{chunkSize:n=Z}=e;let i=0;for(;i<t.byteLength;){const e=Math.min(t.byteLength-i,n),r=new ArrayBuffer(e),o=new Uint8Array(t,i,e);new Uint8Array(r).set(o),i+=e,yield r}}()}(t,e);if((0,i.Lj)(t))return async function*(t,e){const n=(null===e||void 0===e?void 0:e.chunkSize)||j;let i=0;for(;i<t.size;){const e=i+n,r=await t.slice(i,e).arrayBuffer();i=e,yield r}}(t,e);if((0,i.Os)(t))return J(t,e);if((0,i.Ew)(t)){return J(t.body,e)}throw new Error("makeIterator")}const Q="Cannot convert supplied data type";async function K(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"===typeof t||r)return function(t,e,n){if(e.text&&"string"===typeof t)return t;if((0,i.zH)(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const i=t.byteLength||t.length;return 0===t.byteOffset&&i===n.byteLength||(n=n.slice(t.byteOffset,t.byteOffset+i)),n}throw new Error(Q)}(t,e);if((0,i.Lj)(t)&&(t=await A(t)),(0,i.Ew)(t)){const n=t;return await async function(t){if(!t.ok){const e=await async function(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch(n){}return e}(t);throw new Error(e)}}(n),e.binary?await n.arrayBuffer():await n.text()}if((0,i.Os)(t)&&(t=W(t,n)),(0,i.TW)(t)||(0,i.D0)(t))return async function(t){const e=[];for await(const n of t)e.push(n);return(0,G.JY)(...e)}(t);throw new Error(Q)}var q=n(17834);function X(t,e,n){if(n)return n;const i={fetch:m(e,t),...t};if(i.url){const t=h(i.url);i.baseUrl=t,i.queryString=function(t){const e=t.match(u);return e&&e[0]}(i.url),i.filename=q.vB(t),i.baseUrl=q.XX(t)}return Array.isArray(i.loaders)||(i.loaders=null),i}const Y=new(n(87294).Z)({id:"loaders.gl"});var $=n(11821);const tt=/\.([^.]+)$/;function et(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!nt(t))return null;if(e&&!Array.isArray(e))return(0,r.T)(e);let o=[];e&&(o=o.concat(e)),null!==n&&void 0!==n&&n.ignoreRegisteredLoaders||o.push(...(0,$.kO)()),function(t){for(const e of t)(0,r.T)(e)}(o);const s=function(t,e,n,i){const r=d(t),o=f(t),s=h(r)||(null===i||void 0===i?void 0:i.url);let a=null,l="";null!==n&&void 0!==n&&n.mimeType&&(a=rt(e,null===n||void 0===n?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(null===n||void 0===n?void 0:n.mimeType));var c;a=a||function(t,e){const n=e&&tt.exec(e),i=n&&n[1];return i?function(t,e){e=e.toLowerCase();for(const n of t)for(const t of n.extensions)if(t.toLowerCase()===e)return n;return null}(t,i):null}(e,s),l=l||(a?"matched url ".concat(s):""),a=a||rt(e,o),l=l||(a?"matched MIME type ".concat(o):""),a=a||function(t,e){if(!e)return null;for(const n of t)if("string"===typeof e){if(ot(e,n))return n}else if(ArrayBuffer.isView(e)){if(st(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer){if(st(e,0,n))return n}return null}(e,t),l=l||(a?"matched initial data ".concat(at(t)):""),a=a||rt(e,null===n||void 0===n?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(o):""),l&&Y.log(1,"selectLoader selected ".concat(null===(c=a)||void 0===c?void 0:c.name,": ").concat(l,"."));return a}(t,o,n,i);if(!s&&(null===n||void 0===n||!n.nothrow))throw new Error(it(t));return s}function nt(t){return!(t instanceof Response&&204===t.status)}function it(t){const e=d(t),n=f(t);let i="No valid loader found (";i+=e?"".concat(q.vB(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=t?at(t):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function rt(t,e){for(const n of t){if(n.mimeTypes&&n.mimeTypes.includes(e))return n;if(e==="application/x.".concat(n.id))return n}return null}function ot(t,e){if(e.testText)return e.testText(t);return(Array.isArray(e.tests)?e.tests:[e.tests]).some((e=>t.startsWith(e)))}function st(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((i=>function(t,e,n,i){if(i instanceof ArrayBuffer)return(0,G.Xq)(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":return i===lt(t,e,i.length);default:return!1}}(t,e,n,i)))}function at(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"===typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return lt(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){return lt(t,0,e)}return""}function lt(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let o=0;o<n;o++)r+=String.fromCharCode(i.getUint8(e+o));return r}async function ct(t,e,n,o){y(!o||"object"===typeof o),!e||Array.isArray(e)||(0,r.C)(e)||(o=void 0,n=e,e=void 0),n=n||{};const s=d(t=await t),a=function(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...t]:t}return n&&n.length?n:null}(e,o),l=await async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!nt(t))return null;let o=et(t,e,{...n,nothrow:!0},r);if(o)return o;if((0,i.Lj)(t)&&(o=et(t=await t.slice(0,10).arrayBuffer(),e,n,r)),!o&&(null===n||void 0===n||!n.nothrow))throw new Error(it(t));return o}(t,a,n);return l?(o=X({url:s,parse:ct,loaders:a},n=(0,g.GR)(n,l,a,s),o||null),await async function(t,e,n,r){if(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;y(t,"no worker provided");const n=t.version}(t),(0,i.Ew)(e)){const t=e,{ok:n,redirected:i,status:o,statusText:s,type:a,url:l}=t,c=Object.fromEntries(t.headers.entries());r.response={headers:c,ok:n,redirected:i,status:o,statusText:s,type:a,url:l}}if(e=await K(e,t,n),t.parseTextSync&&"string"===typeof e)return n.dataType="text",t.parseTextSync(e,n,r,t);if(function(t,e){return!!R.isSupported()&&!!(_||null!==e&&void 0!==e&&e._nodeWorkers)&&t.worker&&(null===e||void 0===e?void 0:e.worker)}(t,n))return await U(t,e,n,r,ct);if(t.parseText&&"string"===typeof e)return await t.parseText(e,n,r,t);if(t.parse)return await t.parse(e,n,r,t);throw y(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}(l,t,n,o)):null}async function ut(t,e,n,o){Array.isArray(e)||(0,r.C)(e)||(void 0,n=e,e=void 0);const s=m(n);let a=t;return"string"===typeof t&&(a=await s(t)),(0,i.Lj)(t)&&(a=await s(t)),await ct(a,e,n)}},11821:(t,e,n)=>{"use strict";n.d(e,{fh:()=>s,kO:()=>a});var i=n(56742),r=n(30136);const o=()=>{const t=(0,r.rx)();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function s(t){const e=o();t=Array.isArray(t)?t:[t];for(const n of t){const t=(0,i.T)(n);e.find((e=>t===e))||e.unshift(t)}}function a(){return o()}},56742:(t,e,n)=>{"use strict";n.d(e,{C:()=>r,T:()=>o});var i=n(57370);function r(t){var e;if(!t)return!1;Array.isArray(t)&&(t=t[0]);return Array.isArray(null===(e=t)||void 0===e?void 0:e.extensions)}function o(t){var e,n;let o;return(0,i.h)(t,"null loader"),(0,i.h)(r(t),"invalid loader"),Array.isArray(t)&&(o=t[1],t=t[0],t={...t,options:{...t.options,...o}}),(null!==(e=t)&&void 0!==e&&e.parseTextSync||null!==(n=t)&&void 0!==n&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}},30136:(t,e,n)=>{"use strict";n.d(e,{pm:()=>h,rx:()=>u,GR:()=>d});var i=n(75751),r=n(64649);const o=new(n(87294).Z)({id:"loaders.gl"});class s{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}var a=n(7494);const l={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){(0,r.Z)(this,"console",void 0),this.console=console}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.error.bind(this.console,...e)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:a.jU,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},c={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function u(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const h=()=>{const t=u();return t.globalOptions=t.globalOptions||{...l},t.globalOptions};function d(t,e,n,i){return n=n||[],function(t,e){f(t,null,l,c,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},o=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};f(i,n.id,r,o,e)}}(t,n=Array.isArray(n)?n:[n]),p(e,t,i)}function f(t,e,n,r,s){const a=e||"Top level",l=e?"".concat(e,"."):"";for(const c in t){const u=!e&&(0,i.Kn)(t[c]);if(!(c in n)&&!("baseUri"===c&&!e)&&!("workerUrl"===c&&e))if(c in r)o.warn("".concat(a," loader option '").concat(l).concat(c,"' no longer supported, use '").concat(r[c],"'"))();else if(!u){const t=A(c,s);o.warn("".concat(a," loader option '").concat(l).concat(c,"' not recognized. ").concat(t))()}}}function A(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const e in r.options){if(t===e)return"Did you mean '".concat(r.id,".").concat(e,"'?");const o=e.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(e,"'?"))}return i}function p(t,e,n){const i={...t.options||{}};return function(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}(i,n),null===i.log&&(i.log=new s),g(i,h()),g(i,e),i}function g(t,e){for(const n in e)if(n in e){const r=e[n];(0,i.Ss)(r)&&(0,i.Ss)(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}},46257:(t,e,n)=>{"use strict";n.d(e,{Z:()=>d});var i=n(64649),r=n(98949);class o{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(t){(0,i.Z)(this,"opts",void 0),t&&(this.opts=t)}equals(t){return this===t||this.constructor===t.constructor&&(0,r.v)(this.opts,t.opts,1)}getShaders(t){return null}getSubLayerProps(t){const{defaultProps:e}=t.constructor,n={updateTriggers:{}};for(const i in e)if(i in this.props){const t=e[i],r=this.props[i];n[i]=r,t&&"accessor"===t.type&&(n.updateTriggers[i]=this.props.updateTriggers[i],"function"===typeof r&&(n[i]=this.getSubLayerAccessor(r)))}return n}initializeState(t,e){}updateState(t,e){}onNeedsRedraw(t){}getNeedsPickingBuffer(t){return!1}draw(t,e){}finalizeState(t,e){}}(0,i.Z)(o,"defaultProps",{}),(0,i.Z)(o,"extensionName","LayerExtension");const s={clipBounds:[0,0,1,1],clipByInstance:void 0},a="\nuniform vec4 clip_bounds;\n\nbool clip_isInBounds(vec2 position) {\n  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];\n}\n",l={name:"clip-vs",vs:a},c={"vs:#decl":"\nvarying float clip_isVisible;\n","vs:DECKGL_FILTER_GL_POSITION":"\n  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));\n","fs:#decl":"\nvarying float clip_isVisible;\n","fs:DECKGL_FILTER_COLOR":"\n  if (clip_isVisible < 0.5) discard;\n"},u={name:"clip-fs",fs:a},h={"vs:#decl":"\nvarying vec2 clip_commonPosition;\n","vs:DECKGL_FILTER_GL_POSITION":"\n  clip_commonPosition = geometry.position.xy;\n","fs:#decl":"\nvarying vec2 clip_commonPosition;\n","fs:DECKGL_FILTER_COLOR":"\n  if (!clip_isInBounds(clip_commonPosition)) discard;\n"};class d extends o{getShaders(){let t="instancePositions"in this.getAttributeManager().attributes;return void 0!==this.props.clipByInstance&&(t=Boolean(this.props.clipByInstance)),this.state.clipByInstance=t,t?{modules:[l],inject:c}:{modules:[u],inject:h}}draw(t){let{uniforms:e}=t;const{clipBounds:n}=this.props;if(this.state.clipByInstance)e.clip_bounds=n;else{const t=this.projectPosition([n[0],n[1],0]),i=this.projectPosition([n[2],n[3],0]);e.clip_bounds=[Math.min(t[0],i[0]),Math.min(t[1],i[1]),Math.max(t[0],i[0]),Math.max(t[1],i[1])]}}}(0,i.Z)(d,"defaultProps",s),(0,i.Z)(d,"extensionName","ClipExtension")},17634:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var i=n(64649),r=n(79366),o=n(94300);const s={...o.Z.defaultProps};class a extends r.Z{indexToBounds(){return null}renderLayers(){const{elevationScale:t,extruded:e,wireframe:n,filled:i,stroked:r,lineWidthUnits:s,lineWidthScale:a,lineWidthMinPixels:l,lineWidthMaxPixels:c,lineJointRounded:u,lineMiterLimit:h,lineDashJustified:d,getElevation:f,getFillColor:A,getLineColor:p,getLineWidth:g}=this.props,{updateTriggers:m,material:y,transitions:v}=this.props,_=this.getSubLayerClass("cell",o.Z),{updateTriggers:b,...x}=this.indexToBounds()||{};return new _({filled:i,wireframe:n,extruded:e,elevationScale:t,stroked:r,lineWidthUnits:s,lineWidthScale:a,lineWidthMinPixels:l,lineWidthMaxPixels:c,lineJointRounded:u,lineMiterLimit:h,lineDashJustified:d,material:y,transitions:v,getElevation:f,getFillColor:A,getLineColor:p,getLineWidth:g},this.getSubLayerProps({id:"cell",updateTriggers:m&&{...b,getElevation:m.getElevation,getFillColor:m.getFillColor,getLineColor:m.getLineColor,getLineWidth:m.getLineWidth}}),x)}}(0,i.Z)(a,"layerName","GeoCellLayer"),(0,i.Z)(a,"defaultProps",s)},9839:(t,e,n)=>{"use strict";n.d(e,{ZP:()=>A});var i=n(64649),r=n(73356),o=n(47410),s=n(79366),a=n(73115),l=n(94300),c=n(35387);function u(t,e){e=void 0===e?t[0][0]:e;for(const n of t){const t=n[0]-e;t>180?n[0]-=360:t<-180&&(n[0]+=360)}}function h(t,e,n){const i=t(e,n),[o,s]=(0,r.VP)(i);return[s,o]}function d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=(0,r.Lg)(t,!0);return 1!==e?function(t,e,n){const[i,s]=(0,r.VP)(t),a=e.length;u(e,s);const l=e[0]===e[a-1]?a-1:a;for(let r=0;r<l;r++)e[r][0]=(0,o.t7)(s,e[r][0],n),e[r][1]=(0,o.t7)(i,e[r][1],n)}(t,n,e):u(n),n}const f={...l.Z.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:t=>t.hexagon},extruded:!0};class A extends s.Z{constructor(){super(...arguments),(0,i.Z)(this,"state",void 0)}initializeState(){A._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState(t){let{changeFlags:e}=t;return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState(t){let{props:e,changeFlags:n}=t;if(!0!==e.highPrecision&&(n.dataChanged||n.updateTriggersChanged&&n.updateTriggersChanged.getHexagon)){const t=this._calculateH3DataProps();this.setState(t)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let t=-1,e=!1,n=!1;const{iterable:i,objectInfo:o}=(0,a.jB)(this.props.data);for(const s of i){o.index++;const i=this.props.getHexagon(s,o),a=(0,r.AI)(i);if(t<0){if(t=a,!this.props.highPrecision)break}else if(t!==a){n=!0;break}if((0,r.v8)(i)){e=!0;break}}return{resolution:t,edgeLengthKM:t>=0?(0,r.U7)(t,"km"):0,hasMultipleRes:n,hasPentagon:e}}_shouldUseHighPrecision(){if("auto"===this.props.highPrecision){const{resolution:t,hasPentagon:e,hasMultipleRes:n}=this.state,{viewport:i}=this.context;return Boolean(null===i||void 0===i?void 0:i.resolution)||n||e||t>=0&&t<=5}return this.props.highPrecision}_updateVertices(t){if(this._shouldUseHighPrecision())return;const{resolution:e,edgeLengthKM:n,centerHex:i}=this.state;if(e<0)return;const o=this.props.centerHexagon||(0,r.Cx)(t.latitude,t.longitude,e);if(i===o)return;if(i){const t=(0,r.Ji)(i,o);if(t>=0&&t*n<10)return}const{unitsPerMeter:s}=t.distanceScales;let a=d(o);const[l,c]=(0,r.VP)(o),[u,h]=t.projectFlat([c,l]);a=a.map((e=>{const n=t.projectFlat(e);return[(n[0]-u)/s[0],(n[1]-h)/s[1]]})),this.setState({centerHex:o,vertices:a})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:t,material:e,coverage:n,extruded:i,wireframe:r,stroked:o,filled:s,lineWidthUnits:a,lineWidthScale:l,lineWidthMinPixels:c,lineWidthMaxPixels:u,getFillColor:h,getElevation:d,getLineColor:f,getLineWidth:A,transitions:p,updateTriggers:g}=this.props;return{elevationScale:t,extruded:i,coverage:n,wireframe:r,stroked:o,filled:s,lineWidthUnits:a,lineWidthScale:l,lineWidthMinPixels:c,lineWidthMaxPixels:u,material:e,getElevation:d,getFillColor:h,getLineColor:f,getLineWidth:A,transitions:p,updateTriggers:{getFillColor:g.getFillColor,getElevation:g.getElevation,getLineColor:g.getLineColor,getLineWidth:g.getLineWidth}}}_renderPolygonLayer(){const{data:t,getHexagon:e,updateTriggers:n,coverage:i}=this.props,r=this.getSubLayerClass("hexagon-cell-hifi",l.Z),o=this._getForwardProps();return o.updateTriggers.getPolygon=function(t,e){let n;return n=void 0===t||null===t?e:"object"===typeof t?{...t,coverage:e}:{getHexagon:t,coverage:e},n}(n.getHexagon,i),new r(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:t,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(t,n)=>function(t){const e=new Float64Array(2*t.length);let n=0;for(const i of t)e[n++]=i[0],e[n++]=i[1];return e}(d(e(t,n),i))})}_renderColumnLayer(){const{data:t,getHexagon:e,updateTriggers:n}=this.props,i=this.getSubLayerClass("hexagon-cell",c.Z),r=this._getForwardProps();return r.updateTriggers.getPosition=n.getHexagon,new i(r,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:r.updateTriggers}),{data:t,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:h.bind(null,e)})}}(0,i.Z)(A,"defaultProps",f),(0,i.Z)(A,"layerName","H3HexagonLayer"),(0,i.Z)(A,"_checkH3Lib",(()=>{}))},87072:(t,e,n)=>{"use strict";n.r(e),n.d(e,{GeohashLayer:()=>Ua,GreatCircleLayer:()=>$,H3ClusterLayer:()=>Bt,H3HexagonLayer:()=>Ct.ZP,MVTLayer:()=>Ia.Z,QuadkeyLayer:()=>yt,S2Layer:()=>pt,TerrainLayer:()=>Ma,Tile3DLayer:()=>xa,TileLayer:()=>vt.Z,TripsLayer:()=>bt,_GeoCellLayer:()=>tt.Z,_Tile2DHeader:()=>Ga.o,_Tileset2D:()=>za.Be,_WMSLayer:()=>X,_getURLFromTemplate:()=>Ba.z0});var i={};n.r(i),n.d(i,{readFileAsArrayBuffer:()=>Bi,readFileAsText:()=>Ei,requireFromFile:()=>Ti,requireFromString:()=>Si});var r={};n.r(r),n.d(r,{decode:()=>Or,name:()=>Lr});var o={};n.r(o),n.d(o,{name:()=>zr,preprocess:()=>Gr});var s={};n.r(s),n.d(s,{name:()=>Zr,preprocess:()=>jr});var a={};n.r(a),n.d(a,{decode:()=>Qr,encode:()=>Kr,name:()=>Jr,preprocess:()=>Wr});var l={};n.r(l),n.d(l,{decode:()=>so,name:()=>no});var c={};n.r(c),n.d(c,{decode:()=>fo,encode:()=>Ao,name:()=>ho});var u={};n.r(u),n.d(u,{decode:()=>mo,encode:()=>yo,name:()=>go});var h={};n.r(h),n.d(h,{decode:()=>bo,encode:()=>xo,name:()=>_o});var d={};n.r(d),n.d(d,{decode:()=>Eo,name:()=>Bo});var f=n(64649),A=n(79366),p=n(98949),g=n(18252),m=n(17377);class y{constructor(t){(0,f.Z)(this,"fetch",void 0),(0,f.Z)(this,"loadOptions",void 0),(0,f.Z)(this,"_needsRefresh",!0),(0,f.Z)(this,"props",void 0),this.props={...t},this.loadOptions={...t.loadOptions},this.fetch=function(t){const e=null===t||void 0===t?void 0:t.fetch;if(e&&"function"===typeof e)return(t,n)=>e(t,n);const n=null===t||void 0===t?void 0:t.fetch;if(n&&"function"!==typeof n)return t=>fetch(t,n);return t=>fetch(t)}(this.loadOptions)}setProps(t){this.props=Object.assign(this.props,t),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=this._needsRefresh;return t&&(this._needsRefresh=!1),e}}class v extends y{}var _=n(29518);class b extends v{constructor(t){super(t)}async getMetadata(){throw new Error("ImageSource.getMetadata not implemented")}async getImage(t){const e=this.getGranularParameters(t),n=this.getURLFromTemplate(e),i=await this.fetch(n),r=await i.arrayBuffer();return await _.S.parse(r)}getGranularParameters(t){const[e,n,i,r]=t.bbox;return{...t,east:e,north:n,south:r,west:i}}getURLFromTemplate(t){let e=this.props.url;for(const[n,i]of Object.entries(t))e=e.replace("${".concat(n,"}"),String(i)),e=e.replace("{".concat(n,"}"),String(i));return e}}(0,f.Z)(b,"type","template"),(0,f.Z)(b,"testURL",(t=>t.toLowerCase().includes("{")));var x=n(83652);function w(t){if(Array.isArray(t))return t.map((t=>w(t)));if(t&&"object"===typeof t){const n={};for(const[i,r]of Object.entries(t))n[(e=i,"string"===typeof e?e.charAt(0).toLowerCase()+e.slice(1):e)]=w(r);return n}var e;return t}const C={name:"XML",id:"xml",module:"xml",version:"3.4.15",worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:function(t){return t.startsWith("<?xml")},options:{xml:{parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(t,e)=>B((new TextDecoder).decode(t),e),parseTextSync:(t,e)=>B(t,e)};function B(t,e){var n;const i={...C.options.xml,...null===e||void 0===e?void 0:e.xml};if("fast-xml-parser"===i.parser){const n={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:i.removeNSPrefix,textNodeName:i.textNodeName,isArray:(t,e,n,r)=>{var o;const s=Boolean(null===i||void 0===i||null===(o=i.arrayPaths)||void 0===o?void 0:o.some((t=>e===t)));return s},...null===e||void 0===e?void 0:e._fastXML},r=function(t,e){return new x.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...e}).parse(t)}(t,n);return i.uncapitalizeKeys?w(r):r}throw new Error(null===e||void 0===e||null===(n=e.xml)||void 0===n?void 0:n.parser)}function E(t){return Array.isArray(t)?t:t?[t]:[]}function T(t){const e=E(t);return e.length>0&&e.every((t=>"string"===typeof t))?e:[]}function S(t){switch(typeof t){case"number":return t;case"string":return parseFloat(t);default:return}}function M(t){switch(typeof t){case"number":return t;case"string":return parseInt(t,10);default:return}}function I(t){switch(t){case"true":case"1":return!0;default:return!1}}function P(t,e){const n=C.parseTextSync(t,e),i=n.WMT_MS_Capabilities||n.WMS_Capabilities||n,r=function(t){var e,n,i,r,o,s,a,l,c,u,h,d,f,A,p,g;const m={version:String(t.version||""),name:String((null===(e=t.Service)||void 0===e?void 0:e.Name)||"unnamed"),title:null!==(n=t.Service)&&void 0!==n&&n.Title?String(null===(i=t.Service)||void 0===i?void 0:i.Title):void 0,abstract:null!==(r=t.Service)&&void 0!==r&&r.Abstract?String(null===(o=t.Service)||void 0===o?void 0:o.Abstract):void 0,keywords:T(null===(s=t.Service)||void 0===s||null===(a=s.KeywordList)||void 0===a?void 0:a.Keyword),fees:null!==(l=t.Service)&&void 0!==l&&l.Fees?JSON.stringify(null===(c=t.Service)||void 0===c?void 0:c.Fees):void 0,accessConstraints:null!==(u=t.Service)&&void 0!==u&&u.AccessConstraints?JSON.stringify(null===(h=t.Service)||void 0===h?void 0:h.AccessConstraints):void 0,layerLimit:M(null===(d=t.Service)||void 0===d?void 0:d.LayerLimit),maxWidth:M(null===(f=t.Service)||void 0===f?void 0:f.maxWidth),maxHeight:M(null===(A=t.Service)||void 0===A?void 0:A.maxHeight),layers:[],requests:D(null===(p=t.Capability)||void 0===p?void 0:p.Request),exceptions:F(t.Exception)},y=E(null===(g=t.Capability)||void 0===g?void 0:g.Layer);for(const v of y)m.layers.push(L(v));for(const[v,_]of Object.entries(m))void 0===_&&delete m[v];return m}(i);if(null!==e&&void 0!==e&&e.inheritedLayerProps)for(const o of r.layers)O(o,null);return(null!==e&&void 0!==e&&e.includeRawData||null!==e&&void 0!==e&&e.raw)&&(r.raw=i),null!==e&&void 0!==e&&e.includeXMLText&&(r.xml=t),r}function D(t){const e={};for(const[n,i]of Object.entries(t||{})){const t=T(null===i||void 0===i?void 0:i.Format);e[n]={mimeTypes:t}}return e}function F(t){if(E(null===t||void 0===t?void 0:t.Format).length>0)return{mimeTypes:T(t)}}function L(t){var e;const n={title:String((null===t||void 0===t?void 0:t.Title)||""),name:(null===t||void 0===t?void 0:t.Name)&&String(null===t||void 0===t?void 0:t.Name),abstract:(null===t||void 0===t?void 0:t.Name)&&String(null===t||void 0===t?void 0:t.Abstract),keywords:T(null===(e=t.KeywordList)||void 0===e?void 0:e.Keyword)},i=(null===t||void 0===t?void 0:t.CRS)||(null===t||void 0===t?void 0:t.SRS);i&&Array.isArray(i)&&i.every((t=>"string"===typeof t))&&(n.crs=i);let r=(null===t||void 0===t?void 0:t.EX_GeographicBoundingBox)&&function(t){const{westBoundLongitude:e,northBoundLatitude:n,eastBoundLongitude:i,southBoundLatitude:r}=t;return[[e,r],[i,n]]}(null===t||void 0===t?void 0:t.EX_GeographicBoundingBox);r&&(n.geographicBoundingBox=r),r=(null===t||void 0===t?void 0:t.LatLonBoundingBox)&&function(t){const{minx:e,miny:n,maxx:i,maxy:r}=t;return[[e,n],[i,r]]}(null===t||void 0===t?void 0:t.LatLonBoundingBox),r&&(n.geographicBoundingBox=r);const o=(null===t||void 0===t?void 0:t.BoundingBox)&&E(null===t||void 0===t?void 0:t.BoundingBox).map((t=>function(t){const{CRS:e,SRS:n,minx:i,miny:r,maxx:o,maxy:s,resx:a,resy:l}=t,c={crs:e||n,boundingBox:[[S(i),S(r)],[S(o),S(s)]]};return a&&(c.xResolution=a),l&&(c.yResolution=l),c}(t)));o&&o.length>0&&(n.boundingBoxes=o);const s=E(null===t||void 0===t?void 0:t.Dimension).map((t=>function(t){const{name:e,units:n,value:i}=t,r={name:e,units:n,extent:i};t.unitSymbol&&(r.unitSymbol=t.unitSymbol);t.default&&(r.defaultValue=t.default);t.multipleValues&&(r.multipleValues=I(t.multipleValues));t.nearestValue&&(r.nearestValue=I(t.nearestValue));t.current&&(r.current=I(t.current));return r}(t)));s.length&&(n.dimensions=s),null!==t&&void 0!==t&&t.opaque&&(n.opaque=I(null===t||void 0===t?void 0:t.opaque)),null!==t&&void 0!==t&&t.cascaded&&(n.cascaded=I(null===t||void 0===t?void 0:t.cascaded)),null!==t&&void 0!==t&&t.queryable&&(n.queryable=I(null===t||void 0===t?void 0:t.queryable));const a=E(null===t||void 0===t?void 0:t.Layer),l=[];for(const c of a)l.push(L(c));l.length>0&&(n.layers=l);for(const[c,u]of Object.entries(n))void 0===u&&delete n[c];return n}function O(t,e){null!==e&&void 0!==e&&e.geographicBoundingBox&&!t.geographicBoundingBox&&(t.geographicBoundingBox=[...e.geographicBoundingBox]),null!==e&&void 0!==e&&e.crs&&!t.crs&&(t.crs=[...e.crs]),null!==e&&void 0!==e&&e.boundingBoxes&&!t.boundingBoxes&&(t.boundingBoxes=[...e.boundingBoxes]),null!==e&&void 0!==e&&e.dimensions&&!t.dimensions&&(t.dimensions=[...e.dimensions]);for(const n of t.layers||[])O(n,t)}const R={id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:"3.4.15",worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:function(t){return t.startsWith("<?xml")},options:{wms:{}},parse:async(t,e)=>P((new TextDecoder).decode(t),null===e||void 0===e?void 0:e.wms),parseTextSync:(t,e)=>P(t,null===e||void 0===e?void 0:e.wms)};function k(t,e){var n;const i=(null===(n=C.parseTextSync(t,e).FeatureInfoResponse)||void 0===n?void 0:n.FIELDS)||[];return{features:(Array.isArray(i)?i:[i]).map((t=>function(t){const e=t||{};return{attributes:e,type:"",bounds:{bottom:0,top:0,left:0,right:0}}}(t)))}}const U={...R,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(t,e)=>k((new TextDecoder).decode(t),e),parseTextSync:(t,e)=>k(t,e)};function z(t,e){var n;return null===(n=C.parseTextSync)||void 0===n?void 0:n.call(C,t,e)}const G={...R,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(t,e)=>z((new TextDecoder).decode(t),e),parseTextSync:(t,e)=>z(t,e)};const N={id:"wms-error",name:"WMS Error",module:"wms",version:"3.4.15",worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:function(t){return t.startsWith("<?xml")},options:{wms:{throwOnError:!1}},parse:async(t,e)=>Z((new TextDecoder).decode(t),e),parseSync:(t,e)=>Z((new TextDecoder).decode(t),e),parseTextSync:(t,e)=>Z(t,e)};function Z(t,e){const n={...N.options.wms,...null===e||void 0===e?void 0:e.wms},i=function(t,e){var n,i,r;const o=null===(n=C.parseTextSync)||void 0===n?void 0:n.call(C,t,e),s=(null===o||void 0===o||null===(i=o.ServiceExceptionReport)||void 0===i?void 0:i.ServiceException)||(null===o||void 0===o||null===(r=o["ogc:ServiceExceptionReport"])||void 0===r?void 0:r["ogc:ServiceException"]);return"string"===typeof s?s:s.value||s.code||"Unknown error"}(t,n),r=n.minimalErrors?i:"WMS Service error: ".concat(i);if(n.throwOnError)throw new Error(r);return r}class j extends v{constructor(t){var e;super(t),(0,f.Z)(this,"url",void 0),(0,f.Z)(this,"substituteCRS84",void 0),(0,f.Z)(this,"flipCRS",void 0),(0,f.Z)(this,"wmsParameters",void 0),(0,f.Z)(this,"vendorParameters",void 0),(0,f.Z)(this,"capabilities",null),this.url=t.url,this.substituteCRS84=null!==(e=t.substituteCRS84)&&void 0!==e&&e,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...t.wmsParameters},this.vendorParameters=t.vendorParameters||{}}async getMetadata(){const t=await this.getCapabilities();return this.normalizeMetadata(t)}async getImage(t){return await this.getMap(t)}normalizeMetadata(t){return t}async getCapabilities(t,e){const n=this.getCapabilitiesURL(t,e),i=await this.fetch(n),r=await i.arrayBuffer();this._checkResponse(i,r);const o=await R.parse(r,this.loadOptions);return this.capabilities=o,o}async getMap(t,e){const n=this.getMapURL(t,e),i=await this.fetch(n),r=await i.arrayBuffer();this._checkResponse(i,r);try{return await _.S.parse(r,this.loadOptions)}catch{throw this._parseError(r)}}async getFeatureInfo(t,e){const n=this.getFeatureInfoURL(t,e),i=await this.fetch(n),r=await i.arrayBuffer();return this._checkResponse(i,r),await U.parse(r,this.loadOptions)}async getFeatureInfoText(t,e){const n=this.getFeatureInfoURL(t,e),i=await this.fetch(n),r=await i.arrayBuffer();return this._checkResponse(